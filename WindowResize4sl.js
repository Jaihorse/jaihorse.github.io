"use strict";
function windowResize(
  W, H, pW, pH, 
  cfg, 
  breakpoints, 
  pixelRatio, 
  theme, 
  elemRegistry, 
  constraints, 
  onLayoutChange, 
  onCriticalReflow, 
  memoCache
) {
  const ASPECT_RATIO = W / H;
  const DELTA_X = W - pW;
  const DELTA_Y = H - pH;
  const IS_LANDSCAPE = W > H;
  const SCALE_V = W / (cfg.baseWidth || 1920);
  const SCALE_H = H / (cfg.baseHeight || 1080);
  
  const _getBP = (w) => {
    const keys = Object.keys(breakpoints);
    for (let i = keys.length - 1; i >= 0; i--) {
      if (w >= breakpoints[keys[i]]) return keys[i];
    }
    return 'xs';
  };

  const _math = {
    clamp: (v, min, max) => Math.min(Math.max(v, min), max),
    lerp: (a, b, t) => a + (b - a) * t,
    precision: (v, p = 2) => parseFloat(v.toFixed(p)),
    getSafeBound: (val, limit) => val > limit ? limit : val
  };

  const curBP = _getBP(W);
  const prevBP = _getBP(pW);

  const computeGrid = (cols, gutter) => {
    const activeGutter = W < 768 ? gutter / 2 : gutter;
    const netWidth = W - (activeGutter * 2);
    const colWidth = (netWidth - (activeGutter * (cols - 1))) / cols;
    return {
      cw: _math.precision(colWidth),
      gt: activeGutter,
      nw: netWidth
    };
  };

  const resolveTypography = () => {
    const base = theme.fontSize || 16;
    const factor = W < 600 ? 0.85 : W > 1600 ? 1.25 : 1;
    return {
      h1: _math.precision(base * 2.5 * factor),
      body: _math.precision(base * factor),
      lineHeight: _math.precision(1.5 * factor)
    };
  };

  const evaluateVisibility = (registry) => {
    return registry.map(item => {
      const isHidden = item.minW > W || item.minH > H;
      const adaptiveSize = item.fluid ? W * item.ratio : item.baseSize;
      return {
        id: item.id,
        visible: !isHidden,
        rect: {
          w: _math.clamp(adaptiveSize, item.min || 0, item.max || W),
          h: item.autoHeight ? 'auto' : H * (item.vRatio || 0.1)
        }
      };
    });
  };

  const calculateSafeZones = (inset) => {
    const horizontal = _math.clamp(W * inset, 10, 100);
    const vertical = _math.clamp(H * inset, 10, 100);
    return {
      top: vertical,
      bottom: vertical,
      left: horizontal,
      right: horizontal
    };
  };

  const processTransformations = () => {
    const perspective = _math.precision(W * 1.5);
    const zTranslate = curBP === 'xl' ? 100 : 0;
    return `perspective(${perspective}px) translateZ(${zTranslate}px)`;
  };

  const getEnginePayload = () => {
    const grid = computeGrid(cfg.columns || 12, cfg.gutter || 20);
    const typo = resolveTypography();
    const views = evaluateVisibility(elemRegistry);
    const safe = calculateSafeZones(constraints.inset || 0.05);

    return {
      meta: {
        bp: curBP,
        pBp: prevBP,
        dpr: pixelRatio,
        orientation: IS_LANDSCAPE ? 'L' : 'P'
      },
      metrics: {
        vw: W,
        vh: H,
        ar: _math.precision(ASPECT_RATIO),
        dx: DELTA_X,
        dy: DELTA_Y
      },
      layout: {
        grid,
        typo,
        views,
        safe,
        transform: processTransformations()
      }
    };
  };

  const payload = getEnginePayload();

  if (curBP !== prevBP) {
    onCriticalReflow(payload);
  } else if (Math.abs(DELTA_X) > 50 || Math.abs(DELTA_Y) > 50) {
    onLayoutChange(payload);
  }

  const syncCache = (key, data) => {
    memoCache[key] = {
      ts: Date.now(),
      data: data,
      hash: `${W}x${H}`
    };
  };

  syncCache('last_render', payload);

  const N4 = "Mzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MQ3NTkyMzg0NzU5jM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OT3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OT";
  const N5 = "IzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjMIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzzODQ3NM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5Mj";
  const N6 = "M4NDc1OTIzODQ3NTkyMzg0NzUPMxsvmIchXya4ev4vPTRkNSY6oIQKuSDjRcoysfgmoOJvOIxr85MjM4NDc1OTIzODQ3NTkyMzgPMxsvmSAYtFecNLcMqVgdCiywDUmW3p4FdFsvo4ujaHS9n8NTO4DXjznIcPMxsvmIchXya4ev4vPTRkNSY6oIQKuSDjRcoysfgmoOJvOIxr8hXya4ev4vPTRkNSY6oIQKuSDjRcoysfgmoOJvOIxr84";
  const N7 = "Mzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMz0Dc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OT";
  const N8 = "IzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjOTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5Mj";
  const N9 = "M4NDc1OTIzODQ3NTkyMzg0NzUPMxsvmIchXya4ev4vPTRkNSY6oIQKuSDjRcoysfgmoOJvOIxr85MjM4NDc1OTIzODQ3NTkyMzgPMxsvmSAYtFecNLcMqVgdCiywDUmW3p4FdFsvo4ujaHS9n8NTO4DXjznIcPMxsvmIchXya4ev4vPTRkNSY6oIQKuSDjRcoysfgmoOJvOIxr8hXya4ev4vPTRkNSY6oIQKuSDjRcoysfgmoOJvOIxr84";
  
  return {
    state: payload,
    next: {
      pW: W,
      pH: H,
      pBP: curBP
    },
    utils: {
      rebase: (val) => val * SCALE_V,
      vRebase: (val) => val * SCALE_H
    }
  };
}

///////////////////////////////

"use strict";let t=1,n=t,e=9;let i=0,a=0,r=0,o="",c="",f=0,l=0;let s=0,u=0,w=0,h=0,d=0,p=0;const g=new Int32Array([5,1,5,1,5,1,5,1,1,5,1,5,1,5,1,5,5,4,5,4,5,4,5,4,4,5,4,5,4,5,4,5,5,4,5,4,5,4,5,4,4,5,4,5,4,5,4,5,5,0,5,0,5,0,5,0,0,5,0,5,0,5,0,5]),y=new Int32Array([5,4,5,4,5,4,5,4,4,5,4,5,4,5,4,5,5,4,5,4,5,4,5,4,4,5,4,5,4,5,4,5,5,4,5,4,5,4,5,4,4,5,4,5,4,5,4,5,5,4,5,4,5,4,5,4,4,5,4,5,4,5,4,5]),m=new Int32Array([0,0,0,0,0,0,0,0,8,0,29,0,29,0,29,0,0,16,0,16,0,16,0,6,4,0,5,0,5,0,5,0,0,2,0,9,0,7,0,6,1,0,6,0,6,0,6,0,0,3,0,3,0,6,0,4,0,0,9,0,7,0,6,0]),v=new Int32Array([0,0,0,0,0,0,0,0,8,0,29,0,29,0,29,0,0,16,0,16,0,16,0,11,15,0,10,0,10,0,10,0,0,6,0,6,0,6,0,7,4,0,3,0,3,0,3,0,0,1,0,1,0,1,0,2,0,0,0,0,0,0,0,0]);let M=new Int32Array(m);const b=new Int32Array([-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,-1,-1,8,9,10,11,12,13,14,15,-1,-1,16,17,18,19,20,21,22,23,-1,-1,24,25,26,27,28,29,30,31,-1,-1,32,33,34,35,36,37,38,39,-1,-1,40,41,42,43,44,45,46,47,-1,-1,48,49,50,51,52,53,54,55,-1,-1,56,57,58,59,60,61,62,63,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1]),x=new Int32Array([21,22,23,24,25,26,27,28,31,32,33,34,35,36,37,38,41,42,43,44,45,46,47,48,51,52,53,54,55,56,57,58,61,62,63,64,65,66,67,68,71,72,73,74,75,76,77,78,81,82,83,84,85,86,87,88,91,92,93,94,95,96,97,98]),k=new Int32Array([-11,-9,11,9]),A=new Int32Array([1,3,5,7,8,10,12,14,17,19,21,23,24,26,28,30,33,35,37,39,40,42,44,46,49,51,53,55,56,58,60,62]),I=new Int32Array([62,60,58,56,55,53,51,49,46,44,42,40,39,37,35,33,30,28,26,24,23,21,19,17,14,12,10,8,7,5,3,1]),_=new Int32Array(64).fill(-1);let C,L,R,S,E=0,B=1,D=0,P=0,N=0,W=!1,H=!1;let T=100,U=190,j=190;let F=new Int32Array(256),Y=new Int32Array(64),X=new Int32Array(64),z=new Int32Array(256),J=new Int32Array(64),$=new Int32Array(64);let q=new Int16Array(4096);const K=(t,n)=>(t<<6)+n;let Z=new Array(64),G=new Array(64);function O(){if(!hn||0===xa||0===Ua)return void setTimeout(O,200);const t="level=SL0302&result="+xa+"&moves="+Ua;fetch(Ji+t),tt(),Q(),En("by Jaroonsak Wangviwat")}async function Q(){var e;if(H=!0,r=performance.now(),a++,ji=-9999,R=!(1&a),o="",E=0,B=1,i=0,D=0,P=0,S=0,N=0,C=0,G[0]=0,Y[0]=0,M.set(m),T=100,U=190,j=190,T+=ot(-5,0,5),j+=ot(-5,0,5),U+=ot(10,20,30),M[30]+=ot(0,1,2),M[33]+=ot(0,1,2),M[39]+=ot(0,1,2),M[40]+=ot(0,1,2),M[35]+=ot(0,-3,-6),M[ot(49,51,53)]+=4,wa.fill(0),ha.fill(0),da.fill(0),pa.fill(0),ga.fill(0),ya.fill(0),fa=la=sa=ua=0,Mn(),jt=!1,Ft=-1,Yt=-1,Ye=Xe=0,Ke=!1,await async function(){if(1===Ut)return;const n=zt,e=ee*n,i=Tt[Ut][Rn(1)],a=(Tt[Ut][Rn(0)],Tt[st][0===t?6:3]),r=Yn[ot(0,1,2)];se(a),await ue(a,ae,re),Nn=3*n,Wn=-re-.2*n,oe=Nn-fe,ce=Wn-le,await we(20,Nn,Wn);const o=[],c=[],f=[],l=[];for(let t=63;t>=0;t--){const n=y[t];1!==n&&3!==n||c.push(t),0!==n&&2!==n||o.push(t)}for(let t=Xn;t>=0;t--)4!==Zn[t]&&f.push(t),4!==Kn[t]&&l.push(t);await Promise.all([(async()=>{for(let t of o){const a=si(t)*n,r=ui(t)*n;await Tn(200,a,r,e/3,i),await Xi(),_n(4,t)}for(let t=0;t<o.length;t++){const a=r[t],o=si(a)*n,c=ui(a)*n;await jn(200,o,c,e/3,i,Ie),await Xi(),_n(1,a)}if(pn&&f.length>0)for(let t of f){const a=$n[t]*n,r=qn[t]*n;await we(20,a,r,e/3,i),Zn[t]=4,await Ln(1)}for(let t=o.length;t<8;t++){const a=r[t],o=si(a)*n,c=ui(a)*n;await jn(200,o,c,e/3,i,Ie),await Xi(),_n(1,a)}await we(200,Nn,Wn,0)})(),(async()=>{await Xi(1e3);for(let t of c)_n(4,t),await Xi();for(let t=0;t<c.length;t++)_n(0,A[31-t]),await Xi();if(pn&&l.length>0)for(let t of l)Kn[t]=4,await Ln(0),await Xi(200);for(let t=c.length;t<8;t++)_n(0,A[31-t]),await Xi(200)})()])}(),function(){let t,n;for(let e=0;e<Xn;e++)$n[e]=Gn+e%3*.7+ct(.3),qn[e]=On+e%3/3+.7*Math.floor(e/3)+ct(.3),Zn[e]=4,t=2-e%3,n=2-Math.floor(e/3),zn[e]=Qn+.7*t+ct(.3),Jn[e]=Vn+t/3+.7*n+ct(.3),Kn[e]=4}(),y.set(g),di(hi),An(),In(),En("Jaihorse makhos.com"),e="x4sl level "+t,It.textContent=e,Bn(!1),xn(),Bt.textContent=" ",Dt.textContent=" ",await nt("Level "+t,500),0===t&&0===n&&(await nt("ต่อให้",250),await async function(){if(1===Ut)return;const t=zt,n=ee*t,e=Tt[st][6];se(e),await ue(e,ae,re);const i=3*zt,a=2*-zt;if(oe=i-fe,ce=a-le,await we(20,i,a),rt(.6)){const e=ot(8,10,12),r=y[e],o=Tt[Ut][Rn(r)];if(4===r)return;let c;do{c=ot(8,10,12)}while(c===e);const f=si(c)*t,l=ui(c)*t,s=si(e)*t,u=ui(e)*t,w=Math.random();w<.3&&(await we(200,s,u,n),await he(300,s,u)),w<.6&&(await we(200,f,l,n),await he(300,f,l)),await we(200,s,u,n),await Xi(),_n(4,e),await Tn(300,i,a,-n,o),y[e]=4}else{const e=ot(58,60,62),r=y[e],o=Tt[Ut][Rn(r)];if(4===r)return;const c=si(e)*t,f=ui(e)*t;await jn(300,c,f,n,o,Ie),_n(2,e),await Xi(),await we(360,i,a),y[e]=2}}(),In(),await V(500)),Zi=Gi=180,na(0===E),Vi(),Pn(!0),await nt(R?"คุณเดินหลัง":"คุณเดินก่อน",250),R){const t=14,n=21,e=t|n<<8;await Hn(e),y[n]=y[t],y[t]=4,In(),o="8-11 "}!function(){s=u=w=h=0;let t=0;for(let n=0;n<32;n++){const e=A[n],i=y[e];if(4!==i)switch(t++,i){case 0:s++;break;case 1:u++;break;case 2:w++;break;case 3:h++}}d=t}(),Xt=window.devicePixelRatio||1,vn(gt,nn,en),vn(mt,an,rn),vn(Mt,an,rn),bt.imageSmoothingEnabled=!1,kt.imageSmoothingEnabled=!1,yn(),H=!1}async function V(t){const n=performance.now();for(let t=0;t<Tt[st].length;t++){const n=Tt[st][t];ue(n,n.width,n.height),kt.clearRect(0,0,n.width,n.height)}for(;performance.now()-n<t;)await de(16,t=>{pe(0,0)});await Xi()}function tt(){y.fill(5);for(let t=0;t<32;t++)y[A[t]]=4;Ln(),In()}async function nt(t,n){it(),await V(n),et(t),await V(2*n),it(),await V(n)}function et(t){Pt.textContent=t,Pt.classList.add("show")}function it(){Pt.classList.remove("show")}function at(){p=1e3*w+100*s+10*h+u}function rt(t){return Math.random()<t}function ot(t,n,e){const i=Math.random();return i<.3?t:i<.7?n:e}function ct(t,n=.25){return t*(1+(2*Math.random()-1)*n)}function ft(t){return(2*Math.random()-1)*t}const lt=[["mLPWN256_128.png","mDPWN256_128.png","mLHRS256_128.png","mDHRS256_128.png","brddrk160.jpg","brdwht160.jpg","mL_ico.png","mD_ico.png","selBlack.png","selWhite.png"],["wLPWN256r_64.png","wDPWN256r_64.png","wLHRS256r_64.png","wDHRS256r_64.png","wEMPTY.png","wNOUSE.png","wL_ico.png","wD_ico.png","selBlack.png","selBlack.png"],["cLPWN256_64.png","cDPWN256_64.png","cLHRS256_64.png","cDHRS256_64.png","cBDRK.jpg","cBWHT.jpg","cL_ico.png","cD_ico.png","selBlack.png","selBlack.png"],["handMov1_64.png","handMov2_64.png","handCap1_64.png","handCap2_64.png","handCapW_64.png","girlMov3_64.png","girlCap3_64.png"]],st=3,ut=lt.length;let wt,ht,dt,pt,gt,yt,mt,vt,Mt,bt,xt,kt,At,It,_t,Ct,Lt,Rt,St,Et,Bt,Dt,Pt,Nt,Wt=document,Ht=!0,Tt={},Ut=0,jt=!1,Ft=-1,Yt=-1,Xt=1,zt=1,Jt=0,$t=0,qt=new Int16Array(64),Kt=new Int16Array(64),Zt=[],Gt=[],Ot=0;function Qt(t){return Wt.getElementById(t)}let Vt,tn,nn,en,an,rn,on,cn,fn,ln,sn,un,wn,hn=!1;function dn(){gn(),gt.addEventListener("pointerdown",t=>{if(t.preventDefault(),H)return;if(3===i)return Ze();if(0!==i)return;const n=ni(t.clientX,t.clientY);n<0||jt&&Ve(n)||function(t){if(!Qe(t))return!1;jt=!0,Ft=t,Ge.length=0;for(let n=0;n<X[0];n++)ri(F[n])===t&&Ge.push(oi(F[n]));return async function(t){const n=y[t],e=zt,i=si(t)*e,a=ui(t)*e;Sn(),0===li(n)&&bt.drawImage(Tt[Ut][9],i,a,e,e),1===li(n)&&bt.drawImage(Tt[Ut][8],i,a,e,e)}(t),!0}(n)&&(function(t,n){je=t,Fe=y[t],ze=n.clientX,Je=n.clientY,$e=si(t)*zt,qe=ui(t)*zt,gt.setPointerCapture(n.pointerId),Sn(),Ee(be)}(n,t),Oe=-1,1===X[0]&&(Oe=oi(F[0])))},{passive:!1}),gt.addEventListener("pointermove",t=>{if(t.preventDefault(),!(je<0)){if(!Ue){if(Math.abs(t.clientX-ze)+Math.abs(t.clientY-Je)<2)return;Ue=!0,_n(4,je)}!function(t){const n=gt.getBoundingClientRect();Ye=(t.clientX-n.left)*(gt.width/n.width),Xe=(t.clientY-n.top)*(gt.height/n.height)}(t),function(){ye&&ve();const t=Math.round(Ye-zt/2)+Jt,n=Math.round(Xe-zt/2)+$t,e=Tt[Ut][Rn(Fe)+0];ge(e,t,n),$e=t,qe=n;const i=ai(Ye,Xe);if(i>=0){const t=si(i)*zt+Jt,n=ui(i)*zt+$t;bt.globalAlpha=.1,ge(e,t,n),bt.globalAlpha=1}}()}}),gt.addEventListener("pointerup",async t=>{if(t.preventDefault(),H)return ii(),void Sn();gt.releasePointerCapture(t.pointerId),Ke=Ue,ii(),Sn();let n=ni(t.clientX,t.clientY);n<0||Ke&&!Ve(n)?In():jt&&Ve(n)?await async function(t){if(!jt)return;let n=-1;for(let e=0;e<X[0];e++)if(ri(F[e])===Ft&&oi(F[e])===t){n=e;break}if(n<0)return Qe(t)&&(Ft=t),In(),void(H=!1);await async function(t){H=!0;const n=F[t],e=(ri(n),oi(n));fi(n),Ke?await Hn(n,$e,qe):await Hn(n),Wi(n),S=n,N=e,ti(n),0===fi(S)&&2===y[e]?P++:P=0,jt=!1,i=2,En("Sunhorse กำลังคิด.."),In(),ta(),await Xi(20),await async function(){for(Dn(!1);;){let t="";D++,C=0,di(hi);let n=0;if(Z[0][0]=0,Ti=0,Ui=0,0===X[0]){$i(1);break}if(1===X[0]&&(n=F[0],await Xi(20)),D<4&&0===n&&(n=zi(),0!==n&&(t+="...",await Xi(20))),D>3&&0===n&&rt(.95)){const e=za();if(e){const i=ri(e),a=oi(e);for(let e=0;e<X[0];e++){const r=F[e];if(ri(r)===i&&oi(r)===a){n=r,Ti=Ui=r,t+="..",await Xi(20);break}}}}if(0===n){if(!1===await Fi()){$i(1);break}n=Z[0][0]}if(524288&F[0]||(H=!0,In(),await Hn(n),H=!1),Wi(n),S=n,ti(n),524288&S||(N=oi(n)),0===fi(S)&&3===y[oi(S)]){if(P++,qi()){$i(0);break}}else P=0;if(In(),t="ตาคุณเดิน"+t,D++,C=0,di(hi),!(524288&F[0])){if(0===X[0]){$i(-1);break}if(X[0]>=1){let n=ri(F[0]);for(let t=1;t<X[0];t++)if(ri(F[t])!==n){n=-1;break}if(n>=0){Ft=n,jt=!0,i=0,En(t),In();break}}i=0,jt=!1,En(t);break}Wi(524288),S=524288,C=0,di(hi)}0===i&&(Dn(!0),na(!0),Vi(),Oi&&clearInterval(Oi),Oi=setInterval(()=>{Zi>0&&Zi--,Vi()},1e3))}(),In(),H=!1}(n)}(n):In()}),gt.addEventListener("pointercancel",ei),gt.addEventListener("pointerleave",ei),Rt.addEventListener("click",Te),St.addEventListener("click",kn),Ct.addEventListener("click",bn),Et.addEventListener("click",()=>{H||($i(-1),Ze())}),window.addEventListener("resize",gn)}let pn=!0;function gn(){Xt=window.devicePixelRatio||1,Vt=innerWidth,tn=innerHeight;const t=Math.min(8*Vt/8.25,8*tn/9.5);fn=Math.floor(t/8),zt=fn*Xt,nn=8*fn,en=8*fn,on=Math.floor(.8*fn),cn=Math.floor(.65*fn),an=Math.min(Vt,18*fn),rn=Math.min(tn,en+on),mn(wt,nn,en),mn(ht,an,rn),mn(dt,nn,on),mn(pt,nn,cn),vn(gt,nn,en),vn(mt,an,rn),vn(Mt,an,rn),ln=(Vt-nn)/2|0,sn=on,un=(Vt-an)/2|0,wn=0,Jt=(an-nn)/2*Xt,$t=sn*Xt,pn=Vt-nn>fn,Nt.style.fontSize=.5*fn+"px",At.style.fontSize=.3*fn+"px",Mn(),yn()}function yn(){An(),In(),xn(),gt.style.boxShadow="0 0 2px 2px #333"}function mn(t,n,e){t.style.width=n+"px",t.style.height=e+"px"}function vn(t,n,e){t.width=n*Xt,t.style.width=n+"px",t.height=e*Xt,t.style.height=e+"px"}function Mn(){let n=.05;0===t&&(n=.08),a<2&&(n=0);for(let t=0;t<64;t++)Zt[t]=ft(n),Gt[t]=ft(n);!function(){const t=zt;for(let n=0;n<64;n++)qt[n]=Math.round((si(n)+Zt[n])*t),Kt[n]=Math.round((ui(n)+Gt[n])*t)}()}function bn(){Ut=(Ut+1)%3,xn(),An()}function xn(){Ct.src=lt[Ut%3][R?6:7],Lt.src=lt[Ut%3][R?7:6],In()}function kn(){Ht=!Ht,cellNumSwitch.classList.toggle("off",!Ht),An()}function An(){const t=zt,n=.03*t;yt.font=(.15*t|0)+"px Arial",yt.fillStyle="#A98",yt.textAlign="right",yt.textBaseline="top";for(let e=0;e<64;e++){const i=si(e),a=ui(e),r=i+a&1,o=Tt[Ut][r?4:5];if(yt.drawImage(o,i*t,a*t,t,t),r&&Ht&&fn>36){const r=_[R?63-e:e];yt.fillText(r,i*t+t-n,a*t+n)}}}function In(t=!0){vt.clearRect(0,0,mt.width,mt.height),Sn();for(let t=0;t<64;t++){const n=y[t];n<0||n>3||_n(n,t)}if(Ln(),t&&jt){const t=zt,n=Ft,e=Rn(y[n]),i=Tt[Ut][0===li(e)?9:8];bt.drawImage(i,si(n)*t+Jt,ui(n)*t+$t,t,t)}}function _n(t,n){if(4===t)!function(t){const n=zt,e=si(t)*n+Jt,i=ui(t)*n+$t,a=.2*n;vt.clearRect(e,i-a,n,n+2*a),vt.clearRect(e-a,i,n+2*a,n)}(n);else{Cn(Tt[Ut][Rn(t)],qt[n]+Jt,Kt[n]+$t)}}function Cn(t,n,e){t&&vt.drawImage(t,n,e,zt,zt)}function Ln(t=null){if(1!==Ut&&pn){!function(t=null){const n=3*zt,e=3.5*zt,i=Jt+Gn*zt,a=$t+On*zt,r=Jt+Qn*zt,o=$t+Vn*zt;null!==t&&1!==t||vt.clearRect(i,a,n,e);null!==t&&0!==t||vt.clearRect(r,o,n,e);!function(t=null){const n=zt;vt.save(),vt.lineWidth=.03*n,vt.strokeStyle="rgba(200,200,200,0.1)",(null===t||1===t)&&vt.strokeRect(Jt-3*n,$t+0*n,2*n,2*n);null!==t&&0!==t||vt.strokeRect(Jt+9*n,$t+6*n,2*n,2*n);vt.restore()}(t)}(t);for(let n=0;n<Xn;n++){const e=Zn[n],i=Kn[n];null!==t&&1!==t||4===e||Cn(Tt[Ut][e],$n[n]*zt+Jt,qn[n]*zt+$t),null!==t&&0!==t||4===i||Cn(Tt[Ut][i],zn[n]*zt+Jt,Jn[n]*zt+$t)}}}function Rn(t){return R||4===t||5===t?t:1^t}function Sn(){bt.clearRect(0,0,Mt.width,Mt.height)}function En(t){At.textContent=t}function Bn(t){Et.style.visibility=t?"visible":"hidden"}function Dn(t){Et.classList.toggle("disabled",!t)}function Pn(t){St.style.display=t?"inline":"none",Rt.style.display=t?"inline":"none"}let Nn,Wn;async function Hn(n,e=null,i=null){const a=ri(n),r=oi(n),o=fi(n),c=y[a],f=1===li(c)&&1!=Ut,l=zt;ye=null;const s=0!=(131072&o),u=0!=(262144&o),w=qt[a],h=Kt[a],d=qt[r],p=Kt[r],g=Tt[Ut][Rn(c)+0];Tt[Ut][4];if(!f){_n(4,a);const t=e??w+Jt,f=i??h+$t,l=d+Jt,u=p+$t;if(await async function(t,n,e,i,a,r){await de(t,t=>{const o=Math.round(n+(i-n)*t),c=Math.round(e+(a-e)*t);ge(r,o,c)})}(1===E?200:60,t,f,l,u,g),Ee(0===o?Ie:Ae),_n(c,r),s){const t=Fn(n),e=y[t];si(t),ui(t),Tt[Ut][Rn(e)+0];await Xi(),_n(4,t);const i=te(0);if(null!=i&&null!=i.idx){const{idx:t,x:n,y:a}=i;ne(E,t,Rn(e)),await Xi(200),Ln()}}return}const m=!s&&!u&&1===c,v=t>1||ji>150,M=t>0&&rt(Math.min((ji-150)/450,.5)),b=Ti>0?ri(Ti):-1,x=Ti>0?oi(Ti):-1,k=a>=24;let A,I=1;0===t?(I=1.2,A=m?5:6):A=u?3:3===c&&0===Ut?4:s?k?3:2:M?3:k?0:1;const _=m&&!v&&D>6,C=m&&v,L=_&&b===a&&x!==r,R=_&&b!==a,S=Tt[st][A];se(S);const B=ee*l,P=w,N=h,W=d,H=p;await ue(S,ae,re),Nn=si(r)/2*l,Wn=-re-.2*l,oe=Nn-fe,ce=Wn-le,await we(20,Nn,Wn);const T=P+Math.round(ft(.05)*l),U=N+Math.round((3===c||s?.1:-.1)*l);if(R){const t=si(b)*l,n=ui(b)*l,e=(t+Nn)/2,i=(n+Wn)/2;await we(300*I,t,n),await he(300,t,n),await we(300*I,e,i,B),await he(300,e,i)}if(s?await we(200,P,N):(await we(300*I,T,U,a<16?-B/2:0),_&&rt(.1)&&await he(300,T,U),await Xi(20),await we(60,P,N),await Xi(60*(1+Math.random()))),_n(4,a),L){const t=si(x)*l,n=ui(x)*l;await async function(t,n,e,i,a){const r=ct(.5),o=e+(t-e)*r,c=i+(n-i)*r;await Un(300,o,c,a),await Xi(),await Un(300,e+.1*zt,i+.1*zt,a),await Xi()}(t,n,w,h,g)}if(s?await jn(300*I,W,H,B,g,Ae):M?await async function(t,n,e){const i=ee*zt,a=ot(.5,1,1.5);await Un(300,t,n-.2*zt,e),await jn(200*a,t,n,i*a,e,Ae),await Xi()}(W,H,g):_&&rt(.1)?await async function(t,n,e,i,a){const r=Math.round(ft(.2*zt)),o=Math.round(ft(.3*zt)),c=i+r,f=a+o,l=t+r,s=n+o,u=(Nn+t)/2,w=(Wn+n)/2;await Un(300,l,s,e),await we(200,u,w,0,e,c,f),await we(200,l,s,0,e,c,f),await Un(200,t,n,e,ke),await Xi()}(W,H,g,d,p):C&&rt(.3)?await async function(t,n,e){await we(200,t,n+.1*zt,0,e,null,null,null,xe),await we(60,t,n,0,e,null,null,null,ke),await Xi()}(W,H,g):C&&rt(.5)?await async function(t,n,e){const i=ee*zt;await Un(200,t,n,e),rt(.5)&&await we(60,t,n-.1*zt,i/2,e,t,n);await we(60,t,n,i/3,e,t,n),await Xi()}(W,H,g):(await Un(300*I,W,H,g),await Xi()),_n(c,r),m&&r>24&&rt(.2)){const t=r-16,n=y[t];if(0===n||1===n){const e=qt[t],i=Kt[t],a=Tt[Ut][Rn(n)+0];_n(4,t),await async function(t,n,e){const i=ee*zt,a=t+Math.round(ft(.3*zt)),r=n-Math.round(.3*Math.random()*zt);await we(60,(a+Nn)/2,(r+Wn)/2,0,e,a,r),await Xi(),await we(200,a,r,i,e,a,r),await Xi(),await Un(200,t,n,e,ke),await Xi()}(e,i,a),_n(n,t)}}if(s){const t=Fn(n),e=y[t],i=si(t)*l,a=ui(t)*l,r=Tt[Ut][Rn(e)+0];await we(200*I,i,a,B),await Xi(),_n(4,t);const o=te(1);if(null!=o&&null!=o.idx){const{idx:t,x:n,y:i}=o;await jn(200,n,i,B/3,r),ne(1,t,Rn(e)),Ln(),await Xi()}await we(200*I,2*-l,Wn)}else await we(200*I,Nn,Wn);if(u){const t=Tt[Ut][Rn(1)];await jn(200*I,W,H,0,t,Ie),await Xi(),_n(3,r),await we(200*I,Nn,Wn)}}async function Tn(t,n,e,i=0,a,r=be){await we(t,n,e,i,a,null,null,r)}async function Un(t,n,e,i,a=xe){await we(t,n,e,0,i,null,null,null,a)}async function jn(t,n,e,i=0,a,r=null){await we(t,n,e,i,a,null,null,null,null,r)}function Fn(t){if(!(131072&t))return-1;const n=ri(t),e=oi(t);return n>e?si(n)>si(e)?e+9:e+7:si(n)>si(e)?e-7:e-9}const Yn=[[1,3,5,7,14,12,10,8],[7,14,5,12,3,10,1,8],[14,12,10,8,1,3,5,7]];const Xn=8;let zn=new Array(Xn),Jn=new Array(Xn),$n=new Array(Xn),qn=new Array(Xn),Kn=new Array(Xn).fill(4),Zn=new Array(Xn).fill(4);const Gn=-3.5,On=-.5,Qn=8.5,Vn=4.5;function te(t){const n=0===t?Kn:Zn,e=0===t?zn:$n,i=0===t?Jn:qn,a=[];for(let t=0;t<Xn;t++)4===n[t]&&a.push(t);if(!a.length)return null;const r=a[Math.random()*a.length|0];return{idx:r,x:e[r]*zt,y:i[r]*zt}}function ne(t,n,e){return n<0?-1:(1===t?Zn[n]=e:Kn[n]=e,n)}const ee=2;let ie=1,ae=0,re=0,oe=0,ce=0,fe=0,le=0;function se(t){ie=11*zt/t.height,ae=t.width*ie,re=11*zt,fe=Math.round(400*ie),le=Math.round(re-150*ie)}async function ue(t,n,e){return xt.width=n,xt.height=e,kt.clearRect(0,0,n,e),kt.drawImage(t,0,0,n,e),xt}async function we(t,n,e,i=0,a=null,r=null,o=null,c=null,f=null,l=null){const s=Math.max(20,200,ct(t));null!==c?Ee(c):null!==f&&Ee(f,s);const u=n-fe,w=e-le,h=oe,d=ce,p=u-h,g=w-d,y=.5*(h+u),m=.5*(d+w)-i,v=0!==i;await de(s,t=>{let n,e;v?(n=Me(h,y,u,t),e=Me(d,m,w,t)):(n=h+p*t,e=d+g*t),a&&null!=r&&null!=o?(ge(a,r+Jt,o+$t),pe(n,e)):a?pe(n,e,n+fe,e+le,a):pe(n,e)}),null!==l&&Ee(l,s),oe=u,ce=w}async function he(t,n,e,i=zt/50){const a=performance.now();for(;performance.now()-a<t;){const a=ft(i),r=ft(i);await we(t/2,n+a,e+r)}await we(60,n,e)}async function de(n,e){0;return new Promise(i=>{const a=performance.now();requestAnimationFrame((function r(o){const c=Math.min(1,(o-a)/n),f=0===t?function(t){return t*t*(3-2*t)}(c):function(t){if(t<.15)return t*t*2.5;if(t<.75){return.06+.84*((t-.15)/.6)}const n=(t-.75)/.25;return.9+.1*(1-Math.pow(1-n,2))}(c);ye&&ve(),e(f),c<1?requestAnimationFrame(r):i()}))})}function pe(t,n,e,i,a=null){const r=t+Jt,o=n+$t,c=Mt.width,f=Mt.height,l=Math.round(Math.max(0,r)),s=Math.round(Math.max(0,o)),u=Math.round(Math.min(r+xt.width,c)-l),w=Math.round(Math.min(o+xt.height,f)-s);if(u<=0||w<=0)return;const h=Math.round(l-r),d=Math.round(s-o);null!=a&&ge(a,Math.round(e+Jt),Math.round(i+$t)),bt.drawImage(xt,h,d,u,w,l,s,u,w),me(l,s,u,w)}function ge(t,n,e){bt.drawImage(t,n,e,zt,zt),me(n,e,zt,zt)}let ye=null;function me(t,n,e,i){if(ye){const a=Math.min(ye.x,t),r=Math.min(ye.y,n),o=Math.max(ye.x+ye.w,t+e),c=Math.max(ye.y+ye.h,n+i);ye={x:a,y:r,w:o-a,h:c-r}}else ye={x:t,y:n,w:e,h:i}}function ve(t,n,e,i){bt.clearRect(ye.x,ye.y,ye.w,ye.h),ye=null}function Me(t,n,e,i){const a=1-i;return a*a*t+2*a*i*n+i*i*e}const be=0,xe=1,ke=2,Ae=3,Ie=4;let _e,Ce=!1,Le=!1,Re={classic:{},default:{}};async function Se(t,n,e){const i=await fetch(e),a=await i.arrayBuffer();Re[t][n]=await _e.decodeAudioData(a)}function Ee(t,n=null){if(!Ce||!Le||!De)return;if(1===Ut)return;const e=Re[0===Ut?"classic":"default"][t]||Re.default[t];if(!e)return;const i=_e.createBufferSource(),a=_e.createGain();let r=1,o=ct(Ne);t===xe&&n>0&&(r=1e3*e.duration/n),i.buffer=e,i.playbackRate.value=r,a.gain.value=o,i.connect(a).connect(_e.destination),i.start()}function Be(){if(Ce)return;_e=new(window.AudioContext||window.webkitAudioContext),"suspended"===_e.state&&_e.resume();const t=_e.createBufferSource();t.buffer=_e.createBuffer(1,1,_e.sampleRate),t.connect(_e.destination),t.start(0),Ce=!0,async function(){await Promise.all([Se("classic",be,"mPck_40.wav"),Se("classic",xe,"mMov_320.wav"),Se("classic",ke,"mFix_72.wav"),Se("classic",Ae,"mCap_320.wav"),Se("classic",Ie,"mHit_20.wav"),Se("default",be,"cPck_20.wav"),Se("default",xe,"cMov_300.wav"),Se("default",ke,"cFix_60.wav"),Se("default",Ae,"cCap_120.wav"),Se("default",Ie,"cHit_60.wav")]),Le=!0}()}let De=!1,Pe=0,Ne=.5;const We=["speaker0.png","speaker1.png","speaker2.png"],He=[0,.3,.5];async function Te(){Ce||await Be(),Pe=(Pe+1)%3,De=0!==Pe,Ne=He[Pe],Rt.src=We[Pe]}let Ue=!1,je=-1,Fe=4,Ye=0,Xe=0,ze=0,Je=0,$e=null,qe=null,Ke=!1;async function Ze(){H||2!==i&&(await Q(),i=0)}let Ge=[],Oe=-1;function Qe(t){for(let n=0;n<X[0];n++)if(ri(F[n])===t)return!0;return!1}function Ve(t){if(!jt)return!1;for(let n=0;n<X[0];n++)if(ri(F[n])===Ft&&oi(F[n])===t)return!0;return!1}function ti(t){o+=function(t){const n=_[ri(t)],e=_[oi(t)],i=fi(t);let a="-";if(524288&i)return". ";131072&i&&(a="x");return n+a+e+" "}(t)}function ni(t,n){const e=gt.getBoundingClientRect(),i=gt.width/e.width,a=gt.height/e.height,r=Math.floor((t-e.left)*i/zt),o=Math.floor((n-e.top)*a/zt);return r<0||r>7||o<0||o>7?-1:8*o+r}function ei(){Ue&&(ii(),Sn(),In())}function ii(){Ue=!1,je=-1,Fe=4}function ai(t,n){if(Oe>=0)return Oe;let e=-1,i=1.1*zt*(1.1*zt);for(const a of Ge){const r=t-(si(a)*zt+zt/2),o=n-(ui(a)*zt+zt/2),c=r*r+o*o;c<i&&(e=a,i=c)}return e}function ri(t){return 255&t}function oi(t){return t>>8&255}function ci(t){return t<<8}function fi(t){return 16711680&t}function li(t){return 5&t}function si(t){return 7&t}function ui(t){return t>>3}function wi(t){return 2&t?196608:131072}const hi=!0;function di(t){let n=C>0?J[C-1]:S,e=!1;if(X[C]=Y[C],131072&n&&0==(262144&n)&&(qa(),e=pi(C>0?oi(J[C-1]):N),qa(),e))return yi(0,0,524288),void(Y[C+1]=X[C]);if(e=!1,524288&n)gi(C>0?oi(J[C-2]):N),e=!0;else for(let t=0;t<32;t++){const n=A[t],i=y[n];i>=4||(5&i)!=E||gi(n)&&(e=!0)}if(!e&&t===hi)for(let t=0;t<32;t++){const n=A[t],e=y[n];if(!(e>=4||(5&e)!=E))if(0!==e)if(1!==e)if(2!==e&&3!==e);else for(let t=0;t<4;t++)for(let e=n;(e=b[x[e]+k[t]],-1!==e)&&4===y[e];)yi(n,e,0);else{const t=7&n;7!==t&&4===y[n+9]&&yi(n,n+9,0),0!==t&&4===y[n+7]&&yi(n,n+7,0)}else{const t=7&n;0!==t&&4===y[n-9]&&yi(n,n-9,0),7!==t&&4===y[n-7]&&yi(n,n-7,0)}}Y[C+1]=X[C]}function pi(t){const n=y[t];if(0===n){if(t<=15)return!1;const n=7&t;if(n>1&&1==(5&y[t-9])&&4===y[t-18])return!0;if(n<6&&1==(5&y[t-7])&&4===y[t-14])return!0}if(1===n){if(t>=48)return!1;const n=7&t;if(n<6&&0==(5&y[t+9])&&4===y[t+18])return!0;if(n>1&&0==(5&y[t+7])&&4===y[t+14])return!0}if(2===n||3===n)for(let n=0;n<4;n++)for(let e=t;e=b[x[e]+k[n]],-1!==e;)if(4!==y[e]){if((5&y[e])===B){let t=b[x[e]+k[n]];if(-1===t)break;if(4===y[t])return!0}break}return!1}function gi(t){const n=y[t];let e=!1;if(0===n){if(t>15){const n=7&t;n>1&&1==(5&y[t-9])&&4===y[t-18]&&(yi(t,t-18,wi(y[t-9])),e=!0),n<6&&1==(5&y[t-7])&&4===y[t-14]&&(yi(t,t-14,wi(y[t-7])),e=!0)}return e}if(1===n){if(t<48){const n=7&t;n<6&&0==(5&y[t+9])&&4===y[t+18]&&(yi(t,t+18,wi(y[t+9])),e=!0),n>1&&0==(5&y[t+7])&&4===y[t+14]&&(yi(t,t+14,wi(y[t+7])),e=!0)}return e}if(2===n||3===n){for(let n=0;n<4;n++)for(let i=t;i=b[x[i]+k[n]],-1!==i;)if(4!==y[i]){if((5&y[i])===B){let a=b[x[i]+k[n]];if(-1===a)break;4===y[a]&&(yi(t,a,wi(y[i])),e=!0)}break}return e}return e}function yi(t,n,e){let i=X[C];0===y[t]&&n<=7&&(e|=262144),1===y[t]&&n>=56&&(e|=262144),F[i]=t|ci(n)|e,z[i]=((t,n)=>q[K(t,n)])(n,t),131072&e&&(z[i]+=T),196608&e&&(z[i]+=U),262144&e&&(z[i]+=U),X[C]++}function mi(){const n=0===E;let e=0,i=0;if(0==(s|w))return n?-Pi+C:Pi-C;if(0==(u|h))return n?Pi-C:-Pi+C;const a=D<35?M:v;for(let t=0;t<32;t++){const n=A[t],r=y[n];4!==r&&(0===r?e+=a[n]:1===r&&(i+=a[63-n]))}if(d<=4){if(at(),1010==p)return 0;let e=0;for(let t=0;t<32;t++){const n=A[t],i=y[n];4!==i&&(0===i?e+=ui(n)+5:1===i&&(e+=ui(63-n)+5))}e+=6*(4-s-u),0==(s|u)&&(e+=10);const i=function(t){0;La++;const n=Number(0xffffffffn&t),e=Number(t>>32n);let i=2097151&n;const a=Ca[i];if(0===a)return 0;if(Ia[i]===n&&_a[i]===e)return Ra++,a;const r=1|e;i=i+r&2097151;const o=Ca[i];if(0===o)return 0;if(Ia[i]===n&&_a[i]===e)return Ra++,o;for(let t=2;t<=Sa;t++){i=i+r&2097151;const t=Ca[i];if(0===t)return 0;if(Ia[i]===n&&_a[i]===e)return Ra++,t}return 0}(Ea());let a=0;if(0===t||t>=2){const i=s+w-(u+h);let r=0===t?-1:Math.sign(n?i:-i);0===r&&(r=-1),a=r*e}if(0!==i){if(Ra++,i===Ma)return 1e3-e-C;if(i===ba)return-1e3+e+C;if(i===va)return a}const r=Wa(p);if(r===Ma)return n?1e3-e-C:-1e3+e+C;if(r===ba)return n?-1e3+e+C:1e3-e-C;if(r===va)return n?a:-a}return 5===d&&1===w&&1===s&&0===h&&3===u&&(Ci(vi,Mi,bi)||Ci(xi,ki,Ai))?n?500-C:-500+C:5===d&&0===w&&3===s&&1===h&&1===u&&(Ci(vi,Mi,bi,!0)||Ci(xi,ki,Ai,!0))?n?-500+C:500-C:7===d&&1===w&&2===s&&0===h&&4===u&&(Li(vi,Mi,Ii,2)||Li(xi,ki,_i,2))?n?500-C:-500+C:7===d&&0===w&&4===s&&1===h&&2===u&&(Li(vi,Mi,Ii,2,!0)||Li(xi,ki,_i,2,!0))?n?-500+C:500-C:6===d&&1===w&&2===s&&0===h&&3===u&&(Li(vi,Mi,Ii,1)||Li(xi,ki,_i,1))?n?500-C:-500+C:6===d&&0===w&&3===s&&1===h&&2===u&&(Li(vi,Mi,Ii,1,!0)||Li(xi,ki,_i,1,!0))?n?-500+C:500-C:(e+=s*T+w*U,i+=u*T+h*j,e+=2*(s+w),i+=2*(u+h),0===y[8]&&1===y[1]&&(i+=17),1===y[55]&&0===y[62]&&(e+=17),D<35&&(1===y[5]&&1===y[3]&&1===y[21]&&1===y[19]&&(i+=5,1!==y[14]&&1!==y[10]||(i+=8),1===y[17]&&1===y[1]&&(i+=8),1===y[28]&&(i+=5)),0==y[17]&&(4==y[1]&&4==y[8]?e+=17:4==y[1]&&4==y[3]?e+=16:4==y[3]&&(e+=8)),0==y[19]&&(4==y[3]&&4==y[1]||4==y[3]&&4==y[5]?e+=17:(4==y[3]&&1==y[1]&&1==y[5]||4==y[1]&&1==y[3]&&1==y[8]||1==y[1]&&1==y[3])&&(e+=8)),0==y[21]&&(4==y[5]&&4==y[3]||4==y[5]&&4==y[7]?e+=17:(4==y[5]&&1==y[3]&&1==y[7]||4==y[3]&&1==y[5]&&1==y[7])&&(e+=8)),0==y[23]&&4==y[5]&&4==y[7]&&(e+=15),0==y[24]&&4==y[1]&&4==y[3]&&4==y[10]&&1==y[17]&&(e+=17),0==y[62]&&1==y[55]&&(e+=15)),n?e-i:i-e)}const vi=[1,10,19,28,37,46,55],Mi=[3,5,7,12,14,21,23,30,39],bi=[[56,40],[58,40],[58,42],[58,33],[58,24],[51,35],[40,24],[42,24],[42,26],[42,17],[42,8],[24,8],[26,8]],xi=[7,14,21,28,35,42,49,56],ki=[1,3,5,8,10,12,17,19,24,26,33,40],Ai=[[62,55],[53,37],[53,39],[55,39],[37,23],[39,23]],Ii=[[[56,40],[24,8]],[[58,40],[24,8]],[[58,42],[24,8]],[[56,40],[26,8]],[[58,40],[26,8]],[[58,42],[26,8]],[[56,40],[42,24]],[[58,40],[42,24]],[[58,40],[42,26]]],_i=[[[62,55],[39,23]],[[53,39],[37,23]]];function Ci(t,n,e,i=!1){const a=i?3:2,r=i?1:0,o=i?0:1,c=i?63:0;let f=0;for(let n=0;n<t.length;n++){const e=i?c-t[n]:t[n],r=y[e];if(4!==r){if(r!==a)return!1;f++}}if(1!==f)return!1;let l=0;for(let t=0;t<n.length;t++){const e=i?c-n[t]:n[t],a=y[e];if(4!==a){if(a!==o)return!1;l++}}if(2!==l)return!1;for(let t=0;t<e.length;t++){const n=i?c-e[t][0]:e[t][0],a=i?c-e[t][1]:e[t][1];if(y[n]===r&&y[a]===o)return!0}return!1}function Li(t,n,e,i,a=!1){const r=a?3:2,o=a?1:0,c=a?0:1,f=a?63:0;let l=0;for(let n=0;n<t.length;n++){const e=a?f-t[n]:t[n],i=y[e];if(4!==i){if(i!==r)return!1;l++}}if(1!==l)return!1;let s=0;for(let t=0;t<n.length;t++){const e=a?f-n[t]:n[t];y[e]===c&&s++}if(s!==i)return!1;for(let t=0;t<e.length;t++){const n=e[t][0],i=e[t][1],r=a?f-n[0]:n[0],l=a?f-n[1]:n[1],s=a?f-i[0]:i[0],u=a?f-i[1]:i[1];if(y[r]===o&&y[l]===c&&y[s]===o&&y[u]===c)return!0}return!1}let Ri=0,Si=0,Ei=0;function Bi(t){let n=t,e=z[t];for(let i=t+1,a=X[C];i<a;i++)z[i]>e&&(e=z[n=i]);let i=F[t];F[t]=F[n],F[n]=i,i=z[t],z[t]=z[n],z[n]=i}function Di(t){const n=Z[C],e=Z[C+1],i=G[C+1];n[C]=F[t];for(let t=C+1;t<i;t++)n[t]=e[t];G[C]=i}const Pi=1e4;function Ni(t,n,e){if(0===e)return function t(n,e){if(G[C]=C,di(!1),X[C]===Y[C])return mi();for(let i=Y[C];i<X[C];i++){Wi(F[i]);let a=-t(-e,-n);if(Hi(),a>=e)return a;a>n&&(n=a,Di(i))}return n}(t,n);const i=function(){0;const t=ea;let n=0n;for(let e=0;e<32;e++){const i=A[e],a=y[i],r=t[e];a>=4||a<0||(n^=r[a])}1===E&&(n^=ia);return n}(),a=function(t,n,e,i){0;la++;const a=Number(0xffffffffn&t)>>>0,r=Number(t>>32n&0xffffffffn)>>>0,o=4194303&a;if(wa[o]!==a||ha[o]!==r)return{hit:!1,bestMove:0};const c=da[o],f=pa[o],l=ya[o],s=function(t,n){return t>9e3?t-n:t<-9e3?t+n:t}(ga[o],C);if(c>=n){if(fa++,f===ra)return{hit:!0,score:s,bestMove:l};if(f===oa&&s<=e)return{hit:!0,score:s,bestMove:l};if(f===ca&&s>=i)return{hit:!0,score:s,bestMove:l}}return{hit:!1,score:0,bestMove:l}}(i,e,t,n);if(a.bestMove&&0===C&&(Z[0][0]=a.bestMove),a.hit)return a.score;if(G[C]=C,di(hi),X[C]==Y[C]){const t=-1e4+C;return ma(i,e,ra,t,0),t}X[C]-Y[C]==1&&s>1&&u>1&&e++,W&&function(){W=!1;const t=Y[C],n=X[C],e=Z[0][C];for(let i=t;i<n;i++)if(F[i]===e)return W=!0,void(z[i]+=Pi)}();let r=t,o=0,c=-1e4;for(let a=Y[C];a<X[C];a++){Bi(a),Wi(F[a]);let r=-Ni(-n,-t,e-1);if(Hi(),r>c&&(c=r,o=F[a]),r>=n)return ma(i,e,ca,r,F[a]),r;r>t&&(t=r,f=oi(F[a]),l=ri(F[a]),w=e,q[K(f,l)]=q[K(f,l)]+w,Di(a))}var f,l,w;return ma(i,e,c>r?ra:oa,c,o),c}function Wi(t){const n=ri(t),e=oi(t);if(J[C]=t,524288&t)return C++,C>L&&(L=C),qa(),!0;if(131072&t){let t=n>e?si(n)>si(e)?e+9:e+7:si(n)>si(e)?e-7:e-9;switch($[C]=t,y[t]){case 0:s--;break;case 1:u--;break;case 2:w--;break;case 3:h--}d--,y[t]=4}else $[C]=-1;if(262144&t)switch(y[n]){case 0:y[e]=2,w++,s--;break;case 1:y[e]=3,h++,u--}else y[e]=y[n];return y[n]=4,C++,qa(),!0}function Hi(){qa(),C--;const t=J[C],n=ri(t),e=oi(t);if(!(524288&t)){if(262144&t)switch(y[e]){case 2:y[n]=0,w--,s++;break;case 3:y[n]=1,h--,u++}else y[n]=y[e];if(131072&t){let n=$[C];switch(y[n]=(65536&t?2:0)|B,y[n]){case 0:s++;break;case 1:u++;break;case 2:w++;break;case 3:h++}d++}y[e]=4}}let Ti=0,Ui=0,ji=-9999;async function Fi(){const t=performance.now();C=0,L=0,q.fill(0);let n=0,i=1,a=0;const r=Math.min(3,Math.max(0,16-d>>1));for(;i>=10&&await Yi(i,n,a),Ti=Ui,W=!0,n=Ni(-1e4,Pi,i),Ui=Z[0][0],ji=n,a=performance.now()-t,!(a>=5e3);){if(i>=e&&n<-9969)return!1;if(i>=e&&a>=500&&(n<=-300||n>=300||i>=e+r))break;i++}return n>200&&(Pn(!1),Bn(!0)),Ki=performance.now()-t,Ki<1e3&&(Ki=1e3),Gi-=Math.floor(Ki/1e3),Gi<0&&(Gi=0),fa=0,la=0,Ra=0,La=0,Ri=0,Si=0,Ei=0,!0}async function Yi(t,n,e){await Xi(100)}async function Xi(t=60){await new Promise(n=>setTimeout(n,t))}function zi(){let t=0;if(R)switch(D){case 1:t=21|ci(28);break;case 3:t=7|ci(14);break;default:t=0}else switch(D){case 1:t=14|ci(21);break;case 3:t=4===y[35]&&4===y[37]&&rt(.6)?21|ci(28):7|ci(14);break;default:t=0}return t}const Ji="https://chnp.co.th/makhos/visit.php?";function $i(a){const s=a>0?"W":a<0?"L":"D";Math.round((performance.now()-r)/1e3);c+=t+s+" ";let u=Ji+"level="+t+"&result="+encodeURIComponent(c);t>0&&"W"===s&&(u+="&moves="+encodeURIComponent(o)),fetch(u);const w=a>0?"คุณชนะ":a<0?"คุณแพ้":"เสมอกัน";En(w+"!, เริ่มเกมใหม่"),et(w),function(e){n=t,e>0?(f++,l=0):e<0?(f=0,l++):(f=0,l=0);e>0&&0===n?(t=1,f=l=0):(2===f&&(t++,f=0),2===l&&(t--,l=0));t=Math.max(0,Math.min(2,t))}(a),e=t-1+9,t<=0&&(e=9),i=3,ta()}function qi(){return at(),1010==p&&(4===y[7]||4===y[48])||!(P<6)&&(P>25||1111==p)}let Ki=0,Zi=180,Gi=180,Oi=null;function Qi(t){const n=t%60;return Math.floor(t/60)+":"+(n<10?"0"+n:n)}function Vi(){Bt.textContent=Qi(Gi),Dt.textContent=Qi(Zi),Gi<=0&&(Bt.style.color="#fd0"),Zi<=0&&(Dt.style.color="#fd0")}function ta(){na(!1),Oi&&clearInterval(Oi),Oi=null,Vi()}function na(t){Dt.style.color=t?"#eee":"#888",Bt.style.color=t?"#888":"#eee",Ct.style.opacity=t?1:.4,Lt.style.opacity=t?.4:1}let ea=null,ia=0n;function aa(t){return 6364136223846793005n*BigInt(t)+1n&(1n<<64n)-1n}const ra=0,oa=1,ca=2;let fa=0,la=0,sa=0,ua=0;const wa=new Uint32Array(1<<22),ha=new Uint32Array(1<<22),da=new Int16Array(1<<22),pa=new Int8Array(1<<22),ga=new Int32Array(1<<22),ya=new Int32Array(1<<22);function ma(t,n,e,i,a){if(0===n)return;sa++;const r=Number(0xffffffffn&t)>>>0,o=Number(t>>32n&0xffffffffn)>>>0,c=4194303&r;if(i=function(t,n){return t>9e3?t+n:t<-9e3?t-n:t}(i,C),0===ha[c]&&0===wa[c])return wa[c]=r,ha[c]=o,da[c]=n>0?n:1,pa[c]=e,ga[c]=i,void(ya[c]=0|a);const f=wa[c],l=ha[c],s=da[c],u=pa[c];if(l!==o||f!==r)return wa[c]=r,ha[c]=o,da[c]=n,pa[c]=e,ga[c]=i,void(ya[c]=0|a);if(ua++,l===o&&f===r){if(u===ra&&e!==ra)return;if(n<s&&e!==ra)return;if(e===ra&&u===ra&&n<s)return;return da[c]=n,pa[c]=e,ga[c]=i,void(ya[c]=0|a)}}const va=1,Ma=2,ba=3;let xa=0;const ka=new Map,Aa=(1n<<63n)-1n,Ia=new Uint32Array(1<<21),_a=new Uint32Array(1<<21),Ca=new Uint8Array(1<<21);let La=0,Ra=0,Sa=0;function Ea(){const t=0===E,n=ea,e=t?A:I;let i=0n;for(let a=0;a<32;a++){const r=e[a],o=n[a];let c=y[r];c>=4||c<0||(t||4===c||(c^=1),i^=o[c])}return i&Aa}function Ba(t,n){const e=Number(0xffffffffn&t),i=Number(t>>32n);let a=2097151&e;const r=1|i;for(let t=0;t<1<<21;t++){if(0===Ca[a])return Ia[a]=e,_a[a]=i,Ca[a]=n,t>Sa&&(Sa=t),!0;if(Ia[a]===e&&_a[a]===i)return!1;a=a+r&2097151}return!1}function Da(t){let n="",e=0;for(;e<t.length;){let i=t[e];if(i>="0"&&i<="9"){let i=e+1;i<t.length&&t[i]>="0"&&t[i]<="9"&&i++;const a=parseInt(t.slice(e,i),10);n+="y".repeat(a),e=i}else n+=i,e++}return n}function Pa(t){const n=[0,1,2,3,4];for(let t=0;t<32;t++)y[A[t]]=4;let e=0;for(let i=0;i<16;i++){const a=t.charCodeAt(i)-97;let r=Math.floor(a/5),o=a%5;y[A[e++]]=n[r],y[A[e++]]=n[o]}}const Na=new Map([[1001,2],[110,3],[101,1],[1010,1],[2010,2],[1020,3],[1110,2],[1011,3],[210,2],[1002,3],[2001,2],[120,3],[1101,2],[111,3],[201,2],[102,3],[2020,1],[2011,2],[2002,2],[220,3],[211,3],[202,1],[1120,3],[1111,1],[1102,2],[2110,2],[2101,2],[1021,3],[121,3],[1210,2],[1201,2],[1012,3],[112,3],[3010,2],[3001,2],[1030,3],[130,3],[310,2],[301,2],[1003,3],[103,3]]);function Wa(t){return Na.get(t)??0}function Ha(){let t=0,n=0,e=0,i=0;for(let a=0;a<32;a++){const r=y[A[a]];2===r?t++:0===r?n++:3===r?e++:1===r&&i++}return 1e3*t+100*n+10*e+i}const Ta=new Map;let Ua=0;function ja(t){E=0,y.set(g);const n=(t=t.replace(/\b(\d+(?:x\d+)+)\b/g,t=>{const n=t.split("x");return n.map((t,e)=>e?`${n[e-1]}x${t}`:null).filter(Boolean).join(" . ")})).split(/\s+/);for(const t of n){Ja($a(),Fa(t)),Ya(t)}}function Fa(t){const n=t.includes("x");let[e,i]=t.split(n?"x":"-").map(t=>+t);return 0!==E&&(e=33-e,i=33-i),A[e-1]|A[i-1]<<8}function Ya(t){if("."===t)return void(E^=1);let[n,e]=t.split(t.includes("x")?"x":"-").map(t=>+t);t.includes("x")?function(t,n){const e=A[t-1],i=A[n-1];Xa(t,n);const a=e>i?si(e)>si(i)?i+9:i+7:si(e)>si(i)?i-7:i-9;4!==y[a]&&(y[a]=4)}(n,e):Xa(n,e),E^=1}function Xa(t,n){const e=A[t-1],i=A[n-1],a=y[e];4!==a&&(y[i]=a,y[e]=4,0===a&&i<8&&(y[i]=2),1===a&&i>=56&&(y[i]=3))}function za(){const t=$a(),n=Ta.get(t);if(!n)return null;let e=0;for(const t of n.values())e+=t;let i=Math.random()*e,a=null;for(const[t,e]of n)if((i-=e)<0){a=t;break}return a=fi(a)|ci(63-oi(a))|63-ri(a),a}function Ja(t,n){Ta.has(t)||Ta.set(t,new Map);const e=Ta.get(t),i=e.get(n)||0;i<5&&e.set(n,i+1),Ua++}function $a(){const t=0===E,n=t?[4n,5n,6n,7n]:[5n,4n,7n,6n];let e=0n;if(t)for(let t=0;t<32;t++){const i=y[A[t]];e=e*(i>=4?2n:8n)|(i>=4?0n:n[i])}else for(let t=31;t>=0;t--){const i=y[A[t]];e=e*(i>=4?2n:8n)|(i>=4?0n:n[i])}return e}function qa(){E=0===E?1:0,B=0===E?1:0}window.init=function(){!function(){F.fill(0),z.fill(0),Y.fill(0),X.fill(0),J.fill(0),$.fill(0),G.fill(0),q.fill(0);for(let t=0;t<64;t++)Z[t]=new Array(64).fill(0);for(let t=0;t<32;t++)_[A[t]]=t+1;wt=Qt("boardWrapper"),ht=Qt("extendWrapper"),dt=Qt("topBar"),pt=Qt("bottomBar"),gt=Qt("boardCanvas"),yt=gt.getContext("2d"),mt=Qt("pieceCanvas"),vt=mt.getContext("2d"),Mt=Qt("animeCanvas"),bt=Mt.getContext("2d"),xt=Wt.createElement("canvas"),kt=xt.getContext("2d"),At=Qt("message"),Nt=Qt("topCenter"),It=Qt("version"),Et=Qt("newgame"),Ct=Qt("styleSwitch"),Lt=Qt("styleComp"),Rt=Qt("soundSwitch"),St=Qt("cellNumSwitch"),_t=Qt("footer"),Bt=Qt("compTime"),Dt=Qt("playerTime"),Pt=Qt("overlayText"),Bn(!1),Pn(!1),bt.imageSmoothingEnabled=!1,kt.imageSmoothingEnabled=!1,document.addEventListener("touchend",t=>{const n=Date.now();n-Ot<=300&&t.preventDefault(),Ot=n},{passive:!1}),document.addEventListener("touchstart",t=>{t.touches.length>1&&t.preventDefault()},{passive:!1}),document.addEventListener("gesturestart",t=>t.preventDefault()),function(){let t=124987n;ea=[];for(let n=0;n<32;n++){ea[n]=[];for(let e=0;e<10;e++)t=aa(t),ea[n][e]=t}t=aa(t),ia=t}()}(),function(){et("Loading...");let t=0,n=0;for(let n=0;n<ut;n++)t+=lt[n].length;for(let e=0;e<ut;e++){Tt[e]=[];for(let i=0;i<lt[e].length;i++){const a=Tt[e][i]=new Image;a.onload=()=>{++n===t&&(hn=!0,dn())},a.src=lt[e][i]}}}(),async function(t="DB0509.zip",n="DB0509.txt"){try{Ta.clear(),Ua=0;const e=await fetch(t);if(!e.ok)throw new Error("HTTP "+e.status);const i=await e.blob(),a=(await JSZip.loadAsync(i)).file(n);if(!a)throw new Error(`File ${n} not found`);const r=(await a.async("text")).split("\n").map(t=>t.trim()).filter(t=>t.length>=21);for(const t of r){const n=t.substring(0,16),e=t.substring(16,21),i=BigInt("0x"+n),a=Number("0x"+e);Ja(i,a)}await async function(t="newBK.txt"){const n=await fetch(t),e=(await n.text()).split("\n").map(t=>t.trim()).filter(t=>t.length>0&&!/^\s*#/.test(t));for(const t of e)ja(t)}(),tt()}catch(t){}}(),async function(t="background2.jpg",n="description2.txt"){try{0;const e=await fetch(t);if(!e.ok)throw new Error("HTTP "+e.status);const i=await e.blob(),a=(await JSZip.loadAsync(i)).file(n);if(!a)throw new Error(`File ${n} not found`);const r=await a.async("text");Ia.fill(0),_a.fill(0),Ca.fill(0),E=0;let o=0,c=0;const f=r.split("\n").map(t=>t.trim()).filter(t=>t&&!t.startsWith("#"));for(const t of f){const n={".":va,"+":Ma,"-":ba}[t[t.length-1]]||0,e=Da(t.substring(0,t.length-1));if(16!==e.length)continue;Pa(e);const i=Ea(),a=Ha();ka.has(a)||ka.set(a,{win:0,draw:0,loss:0,total:0,def:Wa(a)});const r=ka.get(a);n===va?r.draw++:n===Ma?r.win++:n===ba&&r.loss++,r.total++,Ba(i,n)?o++:c++}for(const[t,n]of ka.entries()){let t=!1;n.def===Ma&&n.win>0&&(t=!0),n.def===va&&n.draw>0&&(t=!0),n.def===ba&&n.loss>0&&(t=!0)}tt(),E=0,xa=o}catch(t){}}(),O()}