"use strict";
function windowResize(
  W, H, pW, pH, 
  cfg, 
  breakpoints, 
  pixelRatio, 
  theme, 
  elemRegistry, 
  constraints, 
  onLayoutChange, 
  onCriticalReflow, 
  memoCache
) {
  const ASPECT_RATIO = W / H;
  const DELTA_X = W - pW;
  const DELTA_Y = H - pH;
  const IS_LANDSCAPE = W > H;
  const SCALE_V = W / (cfg.baseWidth || 1920);
  const SCALE_H = H / (cfg.baseHeight || 1080);
  
  const _getBP = (w) => {
    const keys = Object.keys(breakpoints);
    for (let i = keys.length - 1; i >= 0; i--) {
      if (w >= breakpoints[keys[i]]) return keys[i];
    }
    return 'xs';
  };

  const _math = {
    clamp: (v, min, max) => Math.min(Math.max(v, min), max),
    lerp: (a, b, t) => a + (b - a) * t,
    precision: (v, p = 2) => parseFloat(v.toFixed(p)),
    getSafeBound: (val, limit) => val > limit ? limit : val
  };

  const curBP = _getBP(W);
  const prevBP = _getBP(pW);

  const computeGrid = (cols, gutter) => {
    const activeGutter = W < 768 ? gutter / 2 : gutter;
    const netWidth = W - (activeGutter * 2);
    const colWidth = (netWidth - (activeGutter * (cols - 1))) / cols;
    return {
      cw: _math.precision(colWidth),
      gt: activeGutter,
      nw: netWidth
    };
  };

  const resolveTypography = () => {
    const base = theme.fontSize || 16;
    const factor = W < 600 ? 0.85 : W > 1600 ? 1.25 : 1;
    return {
      h1: _math.precision(base * 2.5 * factor),
      body: _math.precision(base * factor),
      lineHeight: _math.precision(1.5 * factor)
    };
  };

  const evaluateVisibility = (registry) => {
    return registry.map(item => {
      const isHidden = item.minW > W || item.minH > H;
      const adaptiveSize = item.fluid ? W * item.ratio : item.baseSize;
      return {
        id: item.id,
        visible: !isHidden,
        rect: {
          w: _math.clamp(adaptiveSize, item.min || 0, item.max || W),
          h: item.autoHeight ? 'auto' : H * (item.vRatio || 0.1)
        }
      };
    });
  };

  const calculateSafeZones = (inset) => {
    const horizontal = _math.clamp(W * inset, 10, 100);
    const vertical = _math.clamp(H * inset, 10, 100);
    return {
      top: vertical,
      bottom: vertical,
      left: horizontal,
      right: horizontal
    };
  };

  const processTransformations = () => {
    const perspective = _math.precision(W * 1.5);
    const zTranslate = curBP === 'xl' ? 100 : 0;
    return `perspective(${perspective}px) translateZ(${zTranslate}px)`;
  };

  const getEnginePayload = () => {
    const grid = computeGrid(cfg.columns || 12, cfg.gutter || 20);
    const typo = resolveTypography();
    const views = evaluateVisibility(elemRegistry);
    const safe = calculateSafeZones(constraints.inset || 0.05);

    return {
      meta: {
        bp: curBP,
        pBp: prevBP,
        dpr: pixelRatio,
        orientation: IS_LANDSCAPE ? 'L' : 'P'
      },
      metrics: {
        vw: W,
        vh: H,
        ar: _math.precision(ASPECT_RATIO),
        dx: DELTA_X,
        dy: DELTA_Y
      },
      layout: {
        grid,
        typo,
        views,
        safe,
        transform: processTransformations()
      }
    };
  };

  const payload = getEnginePayload();

  if (curBP !== prevBP) {
    onCriticalReflow(payload);
  } else if (Math.abs(DELTA_X) > 50 || Math.abs(DELTA_Y) > 50) {
    onLayoutChange(payload);
  }

  const syncCache = (key, data) => {
    memoCache[key] = {
      ts: Date.now(),
      data: data,
      hash: `${W}x${H}`
    };
  };

  syncCache('last_render', payload);

  const N4 = "Mzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MQ3NTkyMzg0NzU5jM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OT3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OT";
  const N5 = "IzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjMIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzzODQ3NM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5Mj";
  const N6 = "M4NDc1OTIzODQ3NTkyMzg0NzUPMxsvmIchXya4ev4vPTRkNSY6oIQKuSDjRcoysfgmoOJvOIxr85MjM4NDc1OTIzODQ3NTkyMzgPMxsvmSAYtFecNLcMqVgdCiywDUmW3p4FdFsvo4ujaHS9n8NTO4DXjznIcPMxsvmIchXya4ev4vPTRkNSY6oIQKuSDjRcoysfgmoOJvOIxr8hXya4ev4vPTRkNSY6oIQKuSDjRcoysfgmoOJvOIxr84";
  const N7 = "Mzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMz0Dc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OT";
  const N8 = "IzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjOTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5Mj";
  const N9 = "M4NDc1OTIzODQ3NTkyMzg0NzUPMxsvmIchXya4ev4vPTRkNSY6oIQKuSDjRcoysfgmoOJvOIxr85MjM4NDc1OTIzODQ3NTkyMzgPMxsvmSAYtFecNLcMqVgdCiywDUmW3p4FdFsvo4ujaHS9n8NTO4DXjznIcPMxsvmIchXya4ev4vPTRkNSY6oIQKuSDjRcoysfgmoOJvOIxr8hXya4ev4vPTRkNSY6oIQKuSDjRcoysfgmoOJvOIxr84";
  
  return {
    state: payload,
    next: {
      pW: W,
      pH: H,
      pBP: curBP
    },
    utils: {
      rebase: (val) => val * SCALE_V,
      vRebase: (val) => val * SCALE_H
    }
  };
}

///////////////////////////////

"use strict";let t=1,n=t,e=10;let a=0,i=0,r=0,o="",c="",l=0,f=0;let s=0,u=0,w=0,h=0,d=0,p=0;const g=new Int32Array([5,1,5,1,5,1,5,1,1,5,1,5,1,5,1,5,5,4,5,4,5,4,5,4,4,5,4,5,4,5,4,5,5,4,5,4,5,4,5,4,4,5,4,5,4,5,4,5,5,0,5,0,5,0,5,0,0,5,0,5,0,5,0,5]),m=new Int32Array([5,4,5,4,5,4,5,4,4,5,4,5,4,5,4,5,5,4,5,4,5,4,5,4,4,5,4,5,4,5,4,5,5,4,5,4,5,4,5,4,4,5,4,5,4,5,4,5,5,4,5,4,5,4,5,4,4,5,4,5,4,5,4,5]),y=new Int32Array([0,0,0,0,0,0,0,0,8,0,29,0,29,0,29,0,0,16,0,16,0,16,0,6,4,0,5,0,5,0,5,0,0,2,0,9,0,7,0,6,1,0,6,0,6,0,6,0,0,3,0,4,0,4,0,3,0,0,9,0,7,0,6,0]),M=new Int32Array([0,0,0,0,0,0,0,0,8,0,29,0,29,0,29,0,0,16,0,16,0,16,0,11,15,0,10,0,10,0,10,0,0,6,0,6,0,6,0,7,4,0,3,0,3,0,3,0,0,1,0,1,0,1,0,2,0,0,0,0,0,0,0,0]);let v=new Int32Array(y);const b=new Int32Array([-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,-1,-1,8,9,10,11,12,13,14,15,-1,-1,16,17,18,19,20,21,22,23,-1,-1,24,25,26,27,28,29,30,31,-1,-1,32,33,34,35,36,37,38,39,-1,-1,40,41,42,43,44,45,46,47,-1,-1,48,49,50,51,52,53,54,55,-1,-1,56,57,58,59,60,61,62,63,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1]),x=new Int32Array([21,22,23,24,25,26,27,28,31,32,33,34,35,36,37,38,41,42,43,44,45,46,47,48,51,52,53,54,55,56,57,58,61,62,63,64,65,66,67,68,71,72,73,74,75,76,77,78,81,82,83,84,85,86,87,88,91,92,93,94,95,96,97,98]),k=new Int32Array([-11,-9,11,9]),A=new Int32Array([1,3,5,7,8,10,12,14,17,19,21,23,24,26,28,30,33,35,37,39,40,42,44,46,49,51,53,55,56,58,60,62]),I=(new Int32Array([62,60,58,56,55,53,51,49,46,44,42,40,39,37,35,33,30,28,26,24,23,21,19,17,14,12,10,8,7,5,3,1]),new Int32Array(64).fill(-1));let _,C,L,R,S=0,E=1,B=0,D=0,P=0,N=!1,W=!1;let H=100,T=190,U=190;let F=new Int32Array(256),Y=new Int32Array(64),j=new Int32Array(64),X=new Int32Array(256),z=new Int32Array(64),J=new Int32Array(64);let q=new Int16Array(4096);const Z=(t,n)=>(t<<6)+n;let $=new Array(64),G=new Array(64);function K(){sn&&0!==fi&&0!==_i?(fetch(Da+"level=SL0218&result="+fi+"&moves="+_i),V(),O(),Ln("by Jaroonsak Wangviwat")):setTimeout(K,200)}async function O(){var e;if(W=!0,r=performance.now(),i++,La=-9999,L=!(1&i),o="",S=0,E=1,a=0,B=0,D=0,R=0,P=0,_=0,G[0]=0,Y[0]=0,v.set(y),H=100,T=190,U=190,H+=rt(-5,0,5),U+=rt(-5,0,5),T+=rt(10,20,30),v[30]+=rt(0,1,2),v[33]+=rt(0,1,2),v[39]+=rt(0,1,2),v[40]+=rt(0,1,2),v[35]+=rt(0,-3,-6),v[rt(49,51,53)]+=4,function(){for(let t=0;t<4194304;t++)Va[t]=0,ti[t]=0,ni[t]=0,ei[t]=0,ai[t]=0,ii[t]=0;Ga=0,Ka=0,Oa=0,Qa=0}(),mn(),Ht=!1,Tt=-1,Ut=-1,Ue=Fe=0,Je=!1,await async function(){if(1===Wt)return;const n=Yt,e=Qn*n,a=Nt[Wt][_n(3)],i=(Nt[Wt][_n(2)],Nt[ct][0===t?6:3]),r=Tn[rt(0,1,2)];oe(i),await ce(i,te,ne);const o=3*Yt,c=2*-Yt;ee=o-ie,ae=c-re,await le(20,o,c);const l=[],f=[],s=[],u=[];for(let t=63;t>=0;t--){const n=m[t];1!==n&&3!==n||f.push(t),0!==n&&2!==n||l.push(t)}for(let t=Un;t>=0;t--)4!==Jn[t]&&s.push(t),4!==zn[t]&&u.push(t);await Promise.all([(async()=>{for(let t of l){const i=ca(t)*n,r=la(t)*n;await le(200,i,r,e/3,a,null,null,me),await Ea(),kn(4,t)}for(let t=0;t<l.length;t++){const i=r[t],o=ca(i)*n,c=la(i)*n;await le(200,o,c,e/3,a,null,null,null,null,be),await Ea(),kn(1,i)}if(wn&&s.length>0)for(let t of s){const i=jn[t]*n,r=Xn[t]*n;await le(20,i,r,e/3,a),Jn[t]=4,await In(1)}for(let t=l.length;t<8;t++){const i=r[t],o=ca(i)*n,c=la(i)*n;await le(200,o,c,e/3,a,null,null,null,null,be),await Ea(),kn(1,i)}await le(200,o,c,0)})(),(async()=>{await Ea(1e3);for(let t of f)kn(4,t),await Ea();for(let t=0;t<f.length;t++)kn(0,A[31-t]),await Ea();if(wn&&u.length>0)for(let t of u)zn[t]=4,await In(0),await Ea(200);for(let t=f.length;t<8;t++)kn(0,A[31-t]),await Ea(200)})()])}(),function(){let t,n;for(let e=0;e<Un;e++)jn[e]=qn+e%3*.7+Ne(.3),Xn[e]=Zn+e%3/3+.7*Math.floor(e/3)+Ne(.3),Jn[e]=4,t=2-e%3,n=2-Math.floor(e/3),Fn[e]=$n+.7*t+Ne(.3),Yn[e]=Gn+t/3+.7*n+Ne(.3),zn[e]=4}(),m.set(g),ua(sa),bn(),xn(),Ln("Jaihorse makhos.com"),e="x4sl level "+t,xt.textContent=e,Rn(!1),Mn(),Rt.textContent=" ",St.textContent=" ",await tt("Level "+t,500),0===t&&0===n&&(await tt("ต่อให้",250),await async function(){if(1===Wt)return;const t=Yt,n=Qn*t,e=Nt[ct][6];oe(e),await ce(e,te,ne);const a=3*Yt,i=2*-Yt;if(ee=a-ie,ae=i-re,await le(20,a,i),it(.6)){const e=rt(8,10,12),r=m[e],o=Nt[Wt][_n(r)];if(4===r)return;let c;do{c=rt(8,10,12)}while(c===e);const l=ca(c)*t,f=la(c)*t,s=ca(e)*t,u=la(e)*t,w=a,h=i,d=Math.random();d<.3&&(await le(200,s,u,n),await fe(300,s,u)),d<.6&&(await le(200,l,f,n),await fe(300,l,f)),await le(200,s,u,n),await Ea(),kn(4,e),await le(600,w,h,0,o,null,null,me),await Ea(),await le(360,a,i),m[e]=4}else{const e=rt(58,60,62),r=m[e],o=Nt[Wt][_n(r)];if(4===r)return;const c=ca(e)*t,l=la(e)*t;await le(300,c,l,n,o,null,null,null,null,be),kn(2,e),await Ea(),await le(360,a,i),m[e]=2}}(),xn(),await Q(500)),Ha=Ta=180,Rt.style.color="#aaa",St.style.color="#eee",Ya(),En(!0),await tt(L?"คุณเดินหลัง":"คุณเดินก่อน",250),L){const t=14,n=21,e=t|n<<8;await Pn(e),m[n]=m[t],m[t]=4,xn()}!function(){s=u=w=h=0;let t=0;for(let n=0;n<32;n++){const e=A[n],a=m[e];if(4!==a)switch(t++,a){case 0:s++;break;case 1:u++;break;case 2:w++;break;case 3:h++}}d=t}(),Ft=window.devicePixelRatio||1,gn(ht,Qt,Vt),gn(pt,tn,nn),gn(mt,tn,nn),yt.imageSmoothingEnabled=!1,vt.imageSmoothingEnabled=!1,dn(),W=!1}async function Q(t){const n=performance.now();for(let t=0;t<Nt[ct].length;t++){const n=Nt[ct][t];ce(n,n.width,n.height),vt.clearRect(0,0,n.width,n.height)}for(;performance.now()-n<t;)await se(16,t=>{ue(0,0)});await Ea()}function V(){m.fill(5);for(let t=0;t<32;t++)m[A[t]]=4;In(),xn()}async function tt(t,n){et(),await Q(n),nt(t),await Q(2*n),et(),await Q(n)}function nt(t){Et.textContent=t,Et.classList.add("show")}function et(){Et.classList.remove("show")}function at(){p=1e3*w+100*s+10*h+u}function it(t){return Math.random()<t}function rt(t,n,e){const a=Math.random();return a<.3?t:a<.7?n:e}const ot=[["mLPWN256_128.png","mDPWN256_128.png","mLHRS256_128.png","mDHRS256_128.png","brddrk160.jpg","brdwht160.jpg","mL_ico.png","mD_ico.png","selBlack.png","selWhite.png"],["wLPWN256r_64.png","wDPWN256r_64.png","wLHRS256r_64.png","wDHRS256r_64.png","wEMPTY.png","wNOUSE.png","wL_ico.png","wD_ico.png","selBlack.png","selBlack.png"],["cLPWN256_64.png","cDPWN256_64.png","cLHRS256_64.png","cDHRS256_64.png","cBDRK.jpg","cBWHT.jpg","cL_ico.png","cD_ico.png","selBlack.png","selBlack.png"],["handMov1_64.png","handMov2_64.png","handCap1_64.png","handCap2_64.png","handCapW_64.png","girlMov3_64.png","girlCap3_64.png"]],ct=3,lt=ot.length;let ft,st,ut,wt,ht,dt,pt,gt,mt,yt,Mt,vt,bt,xt,kt,At,It,_t,Ct,Lt,Rt,St,Et,Bt,Dt=document,Pt=!0,Nt={},Wt=0,Ht=!1,Tt=-1,Ut=-1,Ft=1,Yt=1,jt=0,Xt=0,zt=new Int16Array(64),Jt=new Int16Array(64),qt=[],Zt=[],$t=0;function Gt(t){return Dt.getElementById(t)}let Kt,Ot,Qt,Vt,tn,nn,en,an,rn,on,cn,ln,fn,sn=!1;function un(){hn(),ht.addEventListener("pointerdown",t=>{if(t.preventDefault(),W)return;if(3===a)return qe();if(0!==a)return;const n=Qe(t.clientX,t.clientY);n<0||Ht&&Ke(n)||function(t){if(!Ge(t))return!1;Ht=!0,Tt=t,Ze.length=0;for(let n=0;n<j[0];n++)ea(F[n])===t&&Ze.push(aa(F[n]));return async function(t){const n=m[t],e=Yt,a=ca(t)*e,i=la(t)*e;Cn(),0===oa(n)&&yt.drawImage(Nt[Wt][9],a,i,e,e),1===oa(n)&&yt.drawImage(Nt[Wt][8],a,i,e,e)}(t),!0}(n)&&(function(t,n){He=t,Te=m[t],Ye=n.clientX,je=n.clientY,Xe=(7&t)*Yt,ze=(t>>3)*Yt,ht.setPointerCapture(n.pointerId),Cn(),Ce(me)}(n,t),$e=-1,1===j[0]&&($e=aa(F[0])))},{passive:!1}),ht.addEventListener("pointermove",t=>{if(t.preventDefault(),!(He<0)){if(!We){if(Math.abs(t.clientX-Ye)+Math.abs(t.clientY-je)<2)return;We=!0,kn(4,He)}!function(t){const n=ht.getBoundingClientRect();Ue=(t.clientX-n.left)*(ht.width/n.width),Fe=(t.clientY-n.top)*(ht.height/n.height)}(t),function(){he&&pe();const t=Math.round(Ue-Yt/2)+jt,n=Math.round(Fe-Yt/2)+Xt,e=Nt[Wt][_n(Te)+0];we(e,t,n),Xe=t,ze=n;const a=na(Ue,Fe);if(a>=0){const t=(7&a)*Yt+jt,n=(a>>3)*Yt+Xt;yt.globalAlpha=.1,we(e,t,n),yt.globalAlpha=1}}()}}),ht.addEventListener("pointerup",async t=>{if(t.preventDefault(),W)return ta(),void Cn();ht.releasePointerCapture(t.pointerId),Je=We,ta(),Cn();let n=Qe(t.clientX,t.clientY);n<0||Je&&!Ke(n)?xn():Ht&&Ke(n)?await async function(t){if(!Ht)return;let n=-1;for(let e=0;e<j[0];e++)if(ea(F[e])===Tt&&aa(F[e])===t){n=e;break}if(n<0)return Ge(t)&&(Tt=t),xn(),void(W=!1);await async function(t){W=!0;const n=F[t],e=(ea(n),aa(n));ra(n),Je?await Pn(n,Xe,ze):await Pn(n),Aa(n),R=n,P=e,Oe(n),0===ra(R)&&2===m[e]?D++:D=0,Ht=!1,a=2,Ln("Sunhorse กำลังคิด.."),xn(),ja(),await Ea(20),await async function(){for(Sn(!1);;){let t="";B++,_=0,ua(sa);let n=0;if($[0][0]=0,_a=0,Ca=0,0===j[0]){Pa(1);break}if(1===j[0]&&(n=F[0],await Ea(20)),B<4&&0===n&&(n=Ba(),0!==n&&(t+="...",await Ea(500))),B>6&&0===n&&it(.8)){const e=Ci();e&&(n=e,t+="..",await Ea(500))}if(0===n){if(!1===await Ra()){Pa(1);break}n=$[0][0]}if(524288&F[0]||(W=!0,xn(),await Pn(n),W=!1),Aa(n),R=n,Oe(n),524288&R||(P=aa(n)),0===ra(R)&&3===m[aa(R)]){if(D++,Na()){Pa(0);break}}else D=0;if(xn(),t="ตาคุณเดิน"+t,B++,_=0,ua(sa),!(524288&F[0])){if(0===j[0]){Pa(-1);break}if(j[0]>=1){let n=ea(F[0]);for(let t=1;t<j[0];t++)if(ea(F[t])!==n){n=-1;break}if(n>=0){Tt=n,Ht=!0,a=0,Ln(t),xn();break}}a=0,Ht=!1,Ln(t);break}Aa(524288),R=524288,_=0,ua(sa)}0===a&&(Sn(!0),Rt.style.color="#aaa",St.style.color="#eee",Ya(),Ua&&clearInterval(Ua),Ua=setInterval(()=>{Ha>0&&Ha--,Ya()},1e3))}(),xn(),W=!1}(n)}(n):xn()}),ht.addEventListener("pointercancel",Ve),ht.addEventListener("pointerleave",Ve),_t.addEventListener("click",Pe),Ct.addEventListener("click",vn),At.addEventListener("click",yn),Lt.addEventListener("click",()=>{W||(Pa(-1),qe())}),window.addEventListener("resize",hn)}let wn=!0;function hn(){Ft=window.devicePixelRatio||1,Kt=innerWidth,Ot=innerHeight;const t=Math.min(8*Kt/8.25,8*Ot/9.5);rn=Math.floor(t/8),Yt=rn*Ft,Qt=8*rn,Vt=8*rn,en=Math.floor(.8*rn),an=Math.floor(.65*rn),tn=Math.min(Kt,18*rn),nn=Math.min(Ot,Vt+en),pn(ft,Qt,Vt),pn(st,tn,nn),pn(ut,Qt,en),pn(wt,Qt,an),gn(ht,Qt,Vt),gn(pt,tn,nn),gn(mt,tn,nn),on=(Kt-Qt)/2|0,cn=en,ln=(Kt-tn)/2|0,fn=0,jt=(tn-Qt)/2*Ft,Xt=cn*Ft,wn=Kt-Qt>rn,Bt.style.fontSize=.5*rn+"px",bt.style.fontSize=.3*rn+"px",mn(),dn()}function dn(){bn(),xn(),Mn(),ht.style.boxShadow="0 0 2px 2px #333"}function pn(t,n,e){t.style.width=n+"px",t.style.height=e+"px"}function gn(t,n,e){t.width=n*Ft,t.style.width=n+"px",t.height=e*Ft,t.style.height=e+"px"}function mn(){let n=.05;0===t&&(n=.08),i<2&&(n=0);for(let t=0;t<64;t++)qt[t]=(2*Math.random()-1)*n,Zt[t]=(2*Math.random()-1)*n;!function(){const t=Yt;for(let n=0;n<64;n++)zt[n]=Math.round(((7&n)+qt[n])*t),Jt[n]=Math.round(((n>>3)+Zt[n])*t)}()}function yn(){Wt=(Wt+1)%3,Mn(),bn()}function Mn(){At.src=ot[Wt%3][L?6:7],It.src=ot[Wt%3][L?7:6],xn()}function vn(){Pt=!Pt,cellNumSwitch.classList.toggle("off",!Pt),bn()}function bn(){const t=Yt,n=.03*t;dt.font=(.15*t|0)+"px Arial",dt.fillStyle="#A98",dt.textAlign="right",dt.textBaseline="top";for(let e=0;e<64;e++){const a=7&e,i=e>>3,r=a+i&1,o=Nt[Wt][r?4:5];if(dt.drawImage(o,a*t,i*t,t,t),r&&Pt&&rn>36){const r=I[L?63-e:e];dt.fillText(r,a*t+t-n,i*t+n)}}}function xn(t=!0){gt.clearRect(0,0,pt.width,pt.height),Cn();for(let t=0;t<64;t++){const n=m[t];n<0||n>3||kn(n,t)}if(In(),t&&Ht){const t=Yt,n=Tt,e=_n(m[n]),a=Nt[Wt][0===oa(e)?9:8];yt.drawImage(a,(7&n)*t+jt,(n>>3)*t+Xt,t,t)}}function kn(t,n){if(4===t)!function(t){const n=Yt,e=(7&t)*n+jt,a=(t>>3)*n+Xt,i=.2*n;gt.clearRect(e,a-i,n,n+2*i),gt.clearRect(e-i,a,n+2*i,n)}(n);else{An(Nt[Wt][_n(t)],zt[n]+jt,Jt[n]+Xt)}}function An(t,n,e){t&&gt.drawImage(t,n,e,Yt,Yt)}function In(t=null){if(1!==Wt&&wn){!function(t=null){const n=3*Yt,e=4*Yt,a=jt+qn*Yt,i=Xt+Zn*Yt,r=jt+$n*Yt,o=Xt+Gn*Yt;null!==t&&1!==t||gt.clearRect(a,i,n,e);null!==t&&0!==t||gt.clearRect(r,o,n,e);!function(t=null){const n=Yt;gt.save(),gt.lineWidth=.03*n,gt.strokeStyle="rgba(200,200,200,0.1)",(null===t||1===t)&&gt.strokeRect(jt-3*n,Xt+0*n,2*n,2*n);null!==t&&0!==t||gt.strokeRect(jt+9*n,Xt+6*n,2*n,2*n);gt.restore()}(t)}(t);for(let n=0;n<Un;n++){const e=Jn[n],a=zn[n];null!==t&&1!==t||4===e||An(Nt[Wt][e],jn[n]*Yt+jt,Xn[n]*Yt+Xt),null!==t&&0!==t||4===a||An(Nt[Wt][a],Fn[n]*Yt+jt,Yn[n]*Yt+Xt)}}}function _n(t){return L||4===t||5===t?t:1^t}function Cn(){yt.clearRect(0,0,mt.width,mt.height)}function Ln(t){bt.textContent=t}function Rn(t){Lt.style.visibility=t?"visible":"hidden"}function Sn(t){Lt.classList.toggle("disabled",!t)}function En(t){Ct.style.display=t?"inline":"none",_t.style.display=t?"inline":"none"}let Bn,Dn;async function Pn(n,e=null,a=null){const i=ea(n),r=aa(n),o=ra(n),c=m[i],l=1===oa(c)&&1!=Wt,f=Yt;he=null;const s=0!=(131072&o),u=0!=(262144&o),w=zt[i],h=Jt[i],d=zt[r],p=Jt[r],g=Nt[Wt][_n(c)+0];Nt[Wt][4];if(!l){kn(4,i);const t=e??w+jt,l=a??h+Xt,f=d+jt,u=p+Xt;if(await async function(t,n,e,a,i,r){await se(t,t=>{const o=Math.round(n+(a-n)*t),c=Math.round(e+(i-e)*t);we(r,o,c)})}(1===S?200:60,t,l,f,u,g),Ce(0===o?be:ve),kn(c,r),s){const t=Hn(n),e=m[t];ca(t),la(t),Nt[Wt][_n(e)+0];await Ea(),kn(4,t);const a=Kn(0);if(null!=a&&null!=a.idx){const{idx:t,x:n,y:i}=a;On(S,t,_n(e)),await Ea(200),In()}}return}const y=!s&&!u&&1===c,M=t>1||La>150,v=t>0&&it(Math.min((La-150)/450,.5)),b=_a>0?ea(_a):-1,x=_a>0?aa(_a):-1,k=i>=24;let A,I=1;0===t?(I=1.2,A=y?5:6):A=u?3:3===c&&0===Wt?4:s?k?3:2:v?3:k?0:1;const _=y&&!M&&B>6,C=y&&M,L=_&&b===i&&x!==r,R=_&&b!==i,E=Nt[ct][A];oe(E);const D=Qn*f,P=w,N=h,W=d,H=p;await ce(E,te,ne),Bn=ca(r)/2*Yt,Dn=-ne,ee=Bn-ie,ae=Dn-re,await le(20,Bn,Dn);const T=P+Math.round((.1*Math.random()-.05)*f),U=N+Math.round((3===c||s?.1:-.1)*f);if(R){const t=ca(b)*f,n=la(b)*f,e=(t+Bn)/2,a=(n+Dn)/2;await le(300*I,t,n),await fe(300,t,n),await le(300*I,e,a,D),await fe(300,e,a)}if(s?await le(200,P,N):(await le(300*I,T,U,i<16?-D/2:0),_&&it(.1)&&await fe(300,T,U),await Ea(20),await le(60,P,N),await Ea(60*(1+Math.random()))),kn(4,i),L){const t=ca(x)*f,n=la(x)*f;await async function(t,n,e,a,i){const r=.25+.5*Math.random(),o=e+(t-e)*r,c=a+(n-a)*r;await Nn(300,o,c,i),await Ea(),await Nn(300,e+.1*Yt,a+.1*Yt,i),await Ea()}(t,n,w,h,g)}if(s?await Wn(300*I,W,H,D,g,ve):v?await async function(t,n,e){const a=Qn*Yt;await Nn(300,t,n-.2*Yt,e),await Wn(60,t,n,a/2,e,ve),await Ea()}(W,H,g):_&&it(.1)?await async function(t,n,e,a,i){const r=Math.round(.2*(2*Math.random()-1)*Yt),o=Math.round(.3*(2*Math.random()-1)*Yt),c=a+r,l=i+o,f=t+r,s=n+o,u=(Bn+t)/2,w=(Dn+n)/2;await Nn(300,f,s,e),await le(200,u,w,0,e,c,l),await le(200,f,s,0,e,c,l),await Nn(200,t,n,e,Me),await Ea()}(W,H,g,d,p):C&&it(.3)?await async function(t,n,e){await le(200,t,n+.1*Yt,0,e,null,null,null,ye),await le(60,t,n,0,e,null,null,null,Me),await Ea()}(W,H,g):C&&it(.5)?await async function(t,n,e){const a=Qn*Yt;await Nn(200,t,n,e),it(.5)&&await le(60,t,n-.1*Yt,a/2,e,t,n);await le(60,t,n,a/3,e,t,n),await Ea()}(W,H,g):(await Nn(300*I,W,H,g),await Ea()),kn(c,r),y&&r>24&&it(.2)){const t=r-16,n=m[t];if(0===n||1===n){const e=zt[t],a=Jt[t],i=Nt[Wt][_n(n)+0];kn(4,t),await async function(t,n,e){const a=Qn*Yt,i=t+Math.round(.3*(2*Math.random()-1)*Yt),r=n-Math.round(.3*Math.random()*Yt);await le(60,(i+Bn)/2,(r+Dn)/2,0,e,i,r),await Ea(),await le(200,i,r,a,e,i,r),await Ea(),await Nn(200,t,n,e,Me),await Ea()}(e,a,i),kn(n,t)}}if(s){const t=Hn(n),e=m[t],a=ca(t)*f,i=la(t)*f,r=Nt[Wt][_n(e)+0];await le(200*I,a,i,D),await Ea(),kn(4,t);const o=Kn(1);if(null!=o&&null!=o.idx){const{idx:t,x:n,y:a}=o;await Wn(200,n,a,D/3,r),On(1,t,_n(e)),In(),await Ea()}await le(200*I,2*-f,Dn)}else await le(200*I,Bn,Dn);if(u){const t=Nt[Wt][_n(1)];await Wn(200*I,W,H,0,t,be),await Ea(),kn(3,r),await le(200*I,Bn,Dn)}}async function Nn(t,n,e,a,i=ye){await le(t,n,e,0,a,null,null,null,i)}async function Wn(t,n,e,a=0,i,r=null){await le(t,n,e,a,i,null,null,null,null,r)}function Hn(t){if(!(131072&t))return-1;const n=ea(t),e=aa(t);return n>e?ca(n)>ca(e)?e+9:e+7:ca(n)>ca(e)?e-7:e-9}const Tn=[[1,3,5,7,14,12,10,8],[7,14,5,12,3,10,1,8],[14,12,10,8,1,3,5,7]];const Un=8;let Fn=new Array(Un),Yn=new Array(Un),jn=new Array(Un),Xn=new Array(Un),zn=new Array(Un).fill(4),Jn=new Array(Un).fill(4);const qn=-3.5,Zn=-.5,$n=8.5,Gn=4.5;function Kn(t){const n=0===t?zn:Jn,e=0===t?Fn:jn,a=0===t?Yn:Xn,i=[];for(let t=0;t<Un;t++)4===n[t]&&i.push(t);if(!i.length)return null;const r=i[Math.random()*i.length|0];return{idx:r,x:e[r]*Yt,y:a[r]*Yt}}function On(t,n,e){return n<0?-1:(1===t?Jn[n]=e:zn[n]=e,n)}const Qn=2;let Vn=1,te=0,ne=0,ee=0,ae=0,ie=0,re=0;function oe(t){Vn=11*Yt/t.height,te=t.width*Vn,ne=11*Yt,ie=Math.round(400*Vn),re=Math.round(ne-150*Vn)}async function ce(t,n,e){return Mt.width=n,Mt.height=e,vt.clearRect(0,0,n,e),vt.drawImage(t,0,0,n,e),Mt}async function le(t,n,e,a=0,i=null,r=null,o=null,c=null,l=null,f=null){const s=Math.max(20,200,Ne(t));null!==c?Ce(c):null!==l&&Ce(l,s);const u=n-ie,w=e-re,h=ee,d=ae,p=u-h,g=w-d,m=.5*(h+u),y=.5*(d+w)-a,M=0!==a;await se(s,t=>{let n,e;M?(n=ge(h,m,u,t),e=ge(d,y,w,t)):(n=h+p*t,e=d+g*t),i&&null!=r&&null!=o?(we(i,r+jt,o+Xt),ue(n,e)):i?ue(n,e,n+ie,e+re,i):ue(n,e)}),null!==f&&Ce(f,s),ee=u,ae=w}async function fe(t,n,e,a=Yt/50){const i=performance.now();for(;performance.now()-i<t;){const i=(2*Math.random()-1)*a,r=(2*Math.random()-1)*a;await le(t/2,n+i,e+r)}await le(60,n,e)}async function se(t,n){0;return new Promise(e=>{const a=performance.now();requestAnimationFrame((function i(r){const o=Math.min(1,(r-a)/t),c=function(t){return t*t*(3-2*t)}(o);he&&pe(),n(c),o<1?requestAnimationFrame(i):e()}))})}function ue(t,n,e,a,i=null){const r=t+jt,o=n+Xt,c=mt.width,l=mt.height,f=Math.round(Math.max(0,r)),s=Math.round(Math.max(0,o)),u=Math.round(Math.min(r+Mt.width,c)-f),w=Math.round(Math.min(o+Mt.height,l)-s);if(u<=0||w<=0)return;const h=Math.round(f-r),d=Math.round(s-o);null!=i&&we(i,Math.round(e+jt),Math.round(a+Xt)),yt.drawImage(Mt,h,d,u,w,f,s,u,w),de(f,s,u,w)}function we(t,n,e){yt.drawImage(t,n,e,Yt,Yt),de(n,e,Yt,Yt)}let he=null;function de(t,n,e,a){if(he){const i=Math.min(he.x,t),r=Math.min(he.y,n),o=Math.max(he.x+he.w,t+e),c=Math.max(he.y+he.h,n+a);he={x:i,y:r,w:o-i,h:c-r}}else he={x:t,y:n,w:e,h:a}}function pe(t,n,e,a){yt.clearRect(he.x,he.y,he.w,he.h),he=null}function ge(t,n,e,a){const i=1-a;return i*i*t+2*i*a*n+a*a*e}const me=0,ye=1,Me=2,ve=3,be=4;let xe,ke=!1,Ae=!1,Ie={classic:{},default:{}};async function _e(t,n,e){const a=await fetch(e),i=await a.arrayBuffer();Ie[t][n]=await xe.decodeAudioData(i)}function Ce(t,n=null){if(!ke||!Ae||!Re)return;if(1===Wt)return;const e=Ie[0===Wt?"classic":"default"][t]||Ie.default[t];if(!e)return;const a=xe.createBufferSource(),i=xe.createGain();let r=1,o=Ne(Ee);t===ye&&n>0&&(r=1e3*e.duration/n),a.buffer=e,a.playbackRate.value=r,i.gain.value=o,a.connect(i).connect(xe.destination),a.start()}function Le(){if(ke)return;xe=new(window.AudioContext||window.webkitAudioContext),"suspended"===xe.state&&xe.resume();const t=xe.createBufferSource();t.buffer=xe.createBuffer(1,1,xe.sampleRate),t.connect(xe.destination),t.start(0),ke=!0,async function(){await Promise.all([_e("classic",me,"mPck_40.wav"),_e("classic",ye,"mMov_320.wav"),_e("classic",Me,"mFix_72.wav"),_e("classic",ve,"mCap_320.wav"),_e("classic",be,"mHit_20.wav"),_e("default",me,"cPck_20.wav"),_e("default",ye,"cMov_300.wav"),_e("default",Me,"cFix_60.wav"),_e("default",ve,"cCap_120.wav"),_e("default",be,"cHit_60.wav")]),Ae=!0}()}let Re=!1,Se=0,Ee=.5;const Be=["speaker0.png","speaker1.png","speaker2.png"],De=[0,.3,.5];async function Pe(){ke||await Le(),Se=(Se+1)%3,Re=0!==Se,Ee=De[Se],_t.src=Be[Se]}function Ne(t,n=.25){return t*(1+(2*Math.random()-1)*n)}let We=!1,He=-1,Te=4,Ue=0,Fe=0,Ye=0,je=0,Xe=null,ze=null,Je=!1;async function qe(){W||2!==a&&(await O(),a=0)}let Ze=[],$e=-1;function Ge(t){for(let n=0;n<j[0];n++)if(ea(F[n])===t)return!0;return!1}function Ke(t){if(!Ht)return!1;for(let n=0;n<j[0];n++)if(ea(F[n])===Tt&&aa(F[n])===t)return!0;return!1}function Oe(t){o+=function(t){const n=I[ea(t)],e=I[aa(t)],a=ra(t);let i="-";if(524288&a)return". ";131072&a&&(i="x");return n+i+e+" "}(t)}function Qe(t,n){const e=ht.getBoundingClientRect(),a=ht.width/e.width,i=ht.height/e.height,r=Math.floor((t-e.left)*a/Yt),o=Math.floor((n-e.top)*i/Yt);return r<0||r>7||o<0||o>7?-1:8*o+r}function Ve(){We&&(ta(),Cn(),xn())}function ta(){We=!1,He=-1,Te=4}function na(t,n){if($e>=0)return $e;let e=-1,a=1.1*Yt*(1.1*Yt);for(const i of Ze){const r=t-((7&i)*Yt+Yt/2),o=n-((i>>3)*Yt+Yt/2),c=r*r+o*o;c<a&&(e=i,a=c)}return e}function ea(t){return 255&t}function aa(t){return t>>8&255}function ia(t){return t<<8}function ra(t){return 16711680&t}function oa(t){return 5&t}function ca(t){return 7&t}function la(t){return t>>3}function fa(t){return 2&t?196608:131072}const sa=!0;function ua(t){let n=_>0?z[_-1]:R,e=!1;if(j[_]=Y[_],131072&n&&0==(262144&n)&&(Li(),e=wa(_>0?aa(z[_-1]):P),Li(),e))return da(0,0,524288),void(Y[_+1]=j[_]);if(e=!1,524288&n)ha(_>0?aa(z[_-2]):P),e=!0;else for(let t=0;t<32;t++){const n=A[t],a=m[n];a>=4||(5&a)!=S||ha(n)&&(e=!0)}if(!e&&t===sa)for(let t=0;t<32;t++){const n=A[t],e=m[n];if(!(e>=4||(5&e)!=S))if(0!==e)if(1!==e)if(2!==e&&3!==e);else for(let t=0;t<4;t++)for(let e=n;(e=b[x[e]+k[t]],-1!==e)&&4===m[e];)da(n,e,0);else{const t=7&n;7!==t&&4===m[n+9]&&da(n,n+9,0),0!==t&&4===m[n+7]&&da(n,n+7,0)}else{const t=7&n;0!==t&&4===m[n-9]&&da(n,n-9,0),7!==t&&4===m[n-7]&&da(n,n-7,0)}}Y[_+1]=j[_]}function wa(t){const n=m[t];if(0===n){if(t<=15)return!1;const n=7&t;if(n>1&&1==(5&m[t-9])&&4===m[t-18])return!0;if(n<6&&1==(5&m[t-7])&&4===m[t-14])return!0}if(1===n){if(t>=48)return!1;const n=7&t;if(n<6&&0==(5&m[t+9])&&4===m[t+18])return!0;if(n>1&&0==(5&m[t+7])&&4===m[t+14])return!0}if(2===n||3===n)for(let n=0;n<4;n++)for(let e=t;e=b[x[e]+k[n]],-1!==e;)if(4!==m[e]){if((5&m[e])===E){let t=b[x[e]+k[n]];if(-1===t)break;if(4===m[t])return!0}break}return!1}function ha(t){const n=m[t];let e=!1;if(0===n){if(t>15){const n=7&t;n>1&&1==(5&m[t-9])&&4===m[t-18]&&(da(t,t-18,fa(m[t-9])),e=!0),n<6&&1==(5&m[t-7])&&4===m[t-14]&&(da(t,t-14,fa(m[t-7])),e=!0)}return e}if(1===n){if(t<48){const n=7&t;n<6&&0==(5&m[t+9])&&4===m[t+18]&&(da(t,t+18,fa(m[t+9])),e=!0),n>1&&0==(5&m[t+7])&&4===m[t+14]&&(da(t,t+14,fa(m[t+7])),e=!0)}return e}if(2===n||3===n){for(let n=0;n<4;n++)for(let a=t;a=b[x[a]+k[n]],-1!==a;)if(4!==m[a]){if((5&m[a])===E){let i=b[x[a]+k[n]];if(-1===i)break;4===m[i]&&(da(t,i,fa(m[a])),e=!0)}break}return e}return e}function da(t,n,e){let a=j[_];0===m[t]&&n<=7&&(e|=262144),1===m[t]&&n>=56&&(e|=262144),F[a]=t|ia(n)|e,X[a]=((t,n)=>q[Z(t,n)])(n,t),131072&e&&(X[a]+=H),196608&e&&(X[a]+=T),262144&e&&(X[a]+=T),j[_]++}function pa(){const n=0===S;let e=0,a=0;if(0==(s|w))return n?-xa+_:xa-_;if(0==(u|h))return n?xa-_:-xa+_;const i=B<35?v:M;for(let t=0;t<32;t++){const n=A[t],r=m[n];4!==r&&(0===r?e+=i[n]:1===r&&(a+=i[63-n]))}if(d<=4){if(at(),1010==p)return 0;let e=0;for(let t=0;t<32;t++){const n=A[t],a=m[n];4!==a&&(0===a?e+=la(n)+5:1===a&&(e+=la(63-n)+5))}e+=6*(4-s-u),0==(s|u)&&(e+=10);const a=function(t){0;pi++;const n=Number(0xffffffffn&t),e=Number(t>>32n);let a=2097151&n;const i=di[a];if(0===i)return 0;if(wi[a]===n&&hi[a]===e)return gi++,i;const r=1|e;a=a+r&2097151;const o=di[a];if(0===o)return 0;if(wi[a]===n&&hi[a]===e)return gi++,o;for(let t=2;t<=mi;t++){a=a+r&2097151;const t=di[a];if(0===t)return 0;if(wi[a]===n&&hi[a]===e)return gi++,t}return 0}(yi());let i=0;if(0===t||t>=2){const a=s+w-(u+h);let r=0===t?-1:Math.sign(n?a:-a);0===r&&(r=-1),i=r*e}if(0!==a){if(gi++,a===ci)return n?1e3-e-_:-1e3+e+_;if(a===li)return n?-1e3+e+_:1e3-e-_;if(a===oi)return n?i:-i}const r=ki(p);if(r===ci)return n?1e3-e-_:-1e3+e+_;if(r===li)return n?-1e3+e+_:1e3-e-_;if(r===oi)return n?i:-i}return e+=s*H+w*T,a+=u*H+h*U,e+=2*(s+w),a+=2*(u+h),0===m[8]&&1===m[1]&&(a+=17),1===m[55]&&0===m[62]&&(e+=17),B<35&&(1===m[5]&&1===m[3]&&1===m[21]&&1===m[19]&&(a+=5,1!==m[14]&&1!==m[12]&&1!==m[10]||(a+=8),1===m[17]&&1===m[1]&&(a+=8),1===m[28]&&(a+=5)),0==m[17]&&(4==m[1]&&4==m[8]?e+=17:4==m[1]&&4==m[3]?e+=16:4==m[3]&&(e+=8)),0==m[19]&&(4==m[3]&&4==m[1]||4==m[3]&&4==m[5]?e+=17:(4==m[3]&&1==m[1]&&1==m[5]||4==m[1]&&1==m[3]&&1==m[8]||1==m[1]&&1==m[3])&&(e+=8)),0==m[21]&&(4==m[5]&&4==m[3]||4==m[5]&&4==m[7]?e+=17:(4==m[5]&&1==m[3]&&1==m[7]||4==m[3]&&1==m[5]&&1==m[7])&&(e+=8)),0==m[23]&&4==m[5]&&4==m[7]&&(e+=15),0==m[24]&&4==m[1]&&4==m[3]&&4==m[10]&&1==m[17]&&(e+=17),0==m[62]&&1==m[55]&&(e+=15)),n?e-a:a-e}let ga=0,ma=0,ya=0;function Ma(){N=!1;const t=Y[_],n=j[_],e=$[0][_];for(let a=t;a<n;a++)if(F[a]===e)return N=!0,void(X[a]+=xa)}function va(t){let n=t,e=X[t];for(let a=t+1,i=j[_];a<i;a++)X[a]>e&&(e=X[n=a]);let a=F[t];F[t]=F[n],F[n]=a,a=X[t],X[t]=X[n],X[n]=a}function ba(t){const n=$[_],e=$[_+1],a=G[_+1];n[_]=F[t];for(let t=_+1;t<a;t++)n[t]=e[t];G[_]=a}const xa=1e4;function ka(t,n,e){if(0===e)return function t(n,e){G[_]=_;let a=pa();if(a>=e)return a;a>n&&(n=a);if(ua(!1),j[_]===Y[_])return a;N&&Ma();for(let a=Y[_];a<j[_];a++){va(a),Aa(F[a]);let i=-t(-e,-n);if(Ia(),i>=e)return i;i>n&&(n=i,ba(a))}return n}(t,n);const a=function(){0;const t=Xa;let n=0n;for(let e=0;e<32;e++){const a=A[e],i=m[a],r=t[e];i>=4||i<0||(n^=r[i])}1===S&&(n^=za);return n}(),i=function(t,n,e,a){0;Ka++;const i=Number(0xffffffffn&t)>>>0,r=Number(t>>32n&0xffffffffn)>>>0,o=4194303&i;if(Va[o]!==i||ti[o]!==r)return{hit:!1,bestMove:0};const c=ni[o],l=ei[o],f=ii[o],s=function(t,n){return t>9e3?t-n:t<-9e3?t+n:t}(ai[o],_);if(c>=n){if(Ga++,l===qa)return{hit:!0,score:s,bestMove:f};if(l===Za&&s<=e)return{hit:!0,score:s,bestMove:f};if(l===$a&&s>=a)return{hit:!0,score:s,bestMove:f}}return{hit:!1,score:0,bestMove:f}}(a,e,t,n);if(i.bestMove&&0===_&&($[0][0]=i.bestMove),i.hit)return i.score;if(G[_]=_,ua(sa),j[_]==Y[_]){const t=-1e4+_;return ri(a,e,qa,t,0),t}j[_]-Y[_]==1&&s>1&&u>1&&e++,N&&Ma();let r=t,o=0,c=-1e4;for(let i=Y[_];i<j[_];i++){va(i),Aa(F[i]);let r=-ka(-n,-t,e-1);if(Ia(),r>c&&(c=r,o=F[i]),r>=n)return ri(a,e,$a,r,F[i]),r;r>t&&(t=r,l=aa(F[i]),f=ea(F[i]),w=e,q[Z(l,f)]=q[Z(l,f)]+w,ba(i))}var l,f,w;return ri(a,e,c>r?qa:Za,c,o),c}function Aa(t){const n=ea(t),e=aa(t);if(z[_]=t,524288&t)return _++,_>C&&(C=_),Li(),!0;if(131072&t){let t=n>e?ca(n)>ca(e)?e+9:e+7:ca(n)>ca(e)?e-7:e-9;switch(J[_]=t,m[t]){case 0:s--;break;case 1:u--;break;case 2:w--;break;case 3:h--}d--,m[t]=4}else J[_]=-1;if(262144&t)switch(m[n]){case 0:m[e]=2,w++,s--;break;case 1:m[e]=3,h++,u--}else m[e]=m[n];return m[n]=4,_++,Li(),!0}function Ia(){Li(),_--;const t=z[_],n=ea(t),e=aa(t);if(!(524288&t)){if(262144&t)switch(m[e]){case 2:m[n]=0,w--,s++;break;case 3:m[n]=1,h--,u++}else m[n]=m[e];if(131072&t){let n=J[_];switch(m[n]=(65536&t?2:0)|E,m[n]){case 0:s++;break;case 1:u++;break;case 2:w++;break;case 3:h++}d++}m[e]=4}}let _a=0,Ca=0,La=-9999;async function Ra(){const t=performance.now();_=0,C=0,q.fill(0);let n=0,a=1,i=0;const r=Math.min(3,Math.max(0,16-d>>1));for(;a>=10&&await Sa(a,n,i),_a=Ca,N=!0,n=ka(-1e4,xa,a),Ca=$[0][0],La=n,i=performance.now()-t,!(i>=5e3);){if(a>=e&&n<-9988)return!1;if(a>=e&&i>=500&&(n<=-300||n>=300||a>=e+r))break;a++}return n>200&&(En(!1),Rn(!0)),Wa=performance.now()-t,Wa<1e3&&(Wa=1e3),Ta-=Math.floor(Wa/1e3),Ta<0&&(Ta=0),Ga=0,Ka=0,gi=0,pi=0,ga=0,ma=0,ya=0,!0}async function Sa(t,n,e){await Ea(100)}async function Ea(t=60){await new Promise(n=>setTimeout(n,t))}function Ba(){let t=0;if(L)switch(B){case 1:t=21|ia(28);break;case 3:t=7|ia(14);break;default:t=0}else switch(B){case 1:t=14|ia(21);break;case 3:t=7|ia(14);break;default:t=0}return t}const Da="https://chnp.co.th/makhos/visit.php?";function Pa(i){const s=i>0?"W":i<0?"L":"D";Math.round((performance.now()-r)/1e3);c+=t+s+" ";let u=Da+"level="+t+"&result="+encodeURIComponent(c);t>0&&"W"===s&&(u+="&moves="+encodeURIComponent(o)),fetch(u);const w=i>0?"คุณชนะ":i<0?"คุณแพ้":"เสมอกัน";Ln(w+"!, เริ่มเกมใหม่"),nt(w),function(e){n=t,e>0?(l++,f=0):e<0?(l=0,f++):(l=0,f=0);e>0&&0===n?(t=1,l=f=0):(2===l&&(t++,l=0),2===f&&(t--,f=0));t=Math.max(0,Math.min(2,t))}(i),e=t-1+10,t<=0&&(e=10),a=3,ja()}function Na(){return at(),1010==p&&(4===m[7]||4===m[48])||!(D<6)&&(D>25||1111==p)}let Wa=0,Ha=180,Ta=180,Ua=null;function Fa(t){const n=t%60;return Math.floor(t/60)+":"+(n<10?"0"+n:n)}function Ya(){Rt.textContent=Fa(Ta),St.textContent=Fa(Ha),Ta<=0&&(Rt.style.color="#fd0"),Ha<=0&&(St.style.color="#fd0")}function ja(){Rt.style.color="#eee",St.style.color="#aaa",Ua&&clearInterval(Ua),Ua=null,Ya()}let Xa=null,za=0n;function Ja(t){return 6364136223846793005n*BigInt(t)+1n&(1n<<64n)-1n}const qa=0,Za=1,$a=2;let Ga=0,Ka=0,Oa=0,Qa=0;const Va=new Uint32Array(4194304),ti=new Uint32Array(4194304),ni=new Int16Array(4194304),ei=new Int8Array(4194304),ai=new Int32Array(4194304),ii=new Int32Array(4194304);function ri(t,n,e,a,i){if(0===n)return;Oa++;const r=Number(0xffffffffn&t)>>>0,o=Number(t>>32n&0xffffffffn)>>>0,c=4194303&r;if(a=function(t,n){return t>9e3?t+n:t<-9e3?t-n:t}(a,_),0===ti[c]&&0===Va[c])return Va[c]=r,ti[c]=o,ni[c]=n>0?n:1,ei[c]=e,ai[c]=a,void(ii[c]=0|i);const l=Va[c],f=ti[c],s=ni[c],u=ei[c];if(f!==o||l!==r)return Va[c]=r,ti[c]=o,ni[c]=n,ei[c]=e,ai[c]=a,void(ii[c]=0|i);if(Qa++,f===o&&l===r){if(u===qa&&e!==qa)return;if(n<s&&e!==qa)return;if(e===qa&&u===qa&&n<s)return;return ni[c]=n,ei[c]=e,ai[c]=a,void(ii[c]=0|i)}}const oi=1,ci=2,li=3;let fi=0;const si=new Map,ui=(1n<<63n)-1n,wi=new Uint32Array(1<<21),hi=new Uint32Array(1<<21),di=new Uint8Array(1<<21);let pi=0,gi=0,mi=0;function yi(){const t=0===S,n=Xa;let e=0n;for(let a=0;a<32;a++){const i=A[a],r=n[a];let o=m[i];o>=4||o<0||(t||4===o||(o^=1),e^=r[o])}return e&ui}function Mi(t,n){const e=Number(0xffffffffn&t),a=Number(t>>32n);let i=2097151&e;const r=1|a;for(let t=0;t<1<<21;t++){if(0===di[i])return wi[i]=e,hi[i]=a,di[i]=n,t>mi&&(mi=t),!0;if(wi[i]===e&&hi[i]===a)return!1;i=i+r&2097151}return!1}function vi(t){let n="",e=0;for(;e<t.length;){let a=t[e];if(a>="0"&&a<="9"){let a=e+1;a<t.length&&t[a]>="0"&&t[a]<="9"&&a++;const i=parseInt(t.slice(e,a),10);n+="y".repeat(i),e=a}else n+=a,e++}return n}function bi(t){const n=[0,1,2,3,4];for(let t=0;t<32;t++)m[A[t]]=4;let e=0;for(let a=0;a<16;a++){const i=t.charCodeAt(a)-97;let r=Math.floor(i/5),o=i%5;m[A[e++]]=n[r],m[A[e++]]=n[o]}}const xi=new Map([[1001,2],[110,3],[101,1],[1010,1],[2010,2],[1020,3],[1110,2],[1011,3],[210,2],[1002,3],[2001,2],[120,3],[1101,2],[111,3],[201,2],[102,3],[2020,1],[2011,2],[2002,2],[220,3],[211,3],[202,1],[1120,3],[1111,1],[1102,2],[2110,2],[2101,2],[1021,3],[121,3],[1210,2],[1201,2],[1012,3],[112,3],[3010,2],[3001,2],[1030,3],[130,3],[310,2],[301,2],[1003,3],[103,3]]);function ki(t){return xi.get(t)??0}function Ai(){let t=0,n=0,e=0,a=0;for(let i=0;i<32;i++){const r=m[A[i]];2===r?t++:0===r?n++:3===r?e++:1===r&&a++}return 1e3*t+100*n+10*e+a}const Ii=new Map;let _i=0;function Ci(){const t=function(){const t=0===S,n=t?[4n,5n,6n,7n]:[5n,4n,7n,6n];let e=0n;if(t)for(let t=0;t<32;t++){const a=m[A[t]];e=e*(a>=4?2n:8n)|(a>=4?0n:n[a])}else for(let t=31;t>=0;t--){const a=m[A[t]];e=e*(a>=4?2n:8n)|(a>=4?0n:n[a])}return e}(),n=Ii.get(t);if(!n)return null;let e=n[Math.floor(Math.random()*n.length)];return e=ra(e)|ia(63-aa(e))|63-ea(e),e}function Li(){S=0===S?1:0,E=0===S?1:0}window.init=function(){!function(){F.fill(0),X.fill(0),Y.fill(0),j.fill(0),z.fill(0),J.fill(0),G.fill(0),q.fill(0);for(let t=0;t<64;t++)$[t]=new Array(64).fill(0);for(let t=0;t<32;t++)I[A[t]]=t+1;ft=Gt("boardWrapper"),st=Gt("extendWrapper"),ut=Gt("topBar"),wt=Gt("bottomBar"),ht=Gt("boardCanvas"),dt=ht.getContext("2d"),pt=Gt("pieceCanvas"),gt=pt.getContext("2d"),mt=Gt("animeCanvas"),yt=mt.getContext("2d"),Mt=Dt.createElement("canvas"),vt=Mt.getContext("2d"),bt=Gt("message"),Bt=Gt("topCenter"),xt=Gt("version"),Lt=Gt("newgame"),At=Gt("styleSwitch"),It=Gt("styleComp"),_t=Gt("soundSwitch"),Ct=Gt("cellNumSwitch"),kt=Gt("footer"),Rt=Gt("compTime"),St=Gt("playerTime"),Et=Gt("overlayText"),Rn(!1),En(!1),yt.imageSmoothingEnabled=!1,vt.imageSmoothingEnabled=!1,document.addEventListener("touchend",t=>{const n=Date.now();n-$t<=300&&t.preventDefault(),$t=n},{passive:!1}),document.addEventListener("touchstart",t=>{t.touches.length>1&&t.preventDefault()},{passive:!1}),document.addEventListener("gesturestart",t=>t.preventDefault()),function(){let t=124987n;Xa=[];for(let n=0;n<32;n++){Xa[n]=[];for(let e=0;e<10;e++)t=Ja(t),Xa[n][e]=t}t=Ja(t),za=t}()}(),function(){nt("Loading...");let t=0,n=0;for(let n=0;n<lt;n++)t+=ot[n].length;for(let e=0;e<lt;e++){Nt[e]=[];for(let a=0;a<ot[e].length;a++){const i=Nt[e][a]=new Image;i.onload=()=>{++n===t&&(sn=!0,un())},i.src=ot[e][a]}}}(),async function(t="DB0508.zip",n="DB0508.txt"){try{Ii.clear(),_i=0;const e=await fetch(t);if(!e.ok)throw new Error("HTTP "+e.status);const a=await e.blob(),i=(await JSZip.loadAsync(a)).file(n);if(!i)throw new Error(`File ${n} not found`);const r=(await i.async("text")).split("\n").map(t=>t.trim()).filter(t=>t.length>=21);for(const t of r){const n=t.substring(0,16),e=t.substring(16,21),a=BigInt("0x"+n),i=Number("0x"+e);Ii.has(a)||Ii.set(a,[]),Ii.get(a).push(i),_i++}}catch(t){}}(),async function(t="background2.jpg",n="description2.txt"){try{0;const e=await fetch(t);if(!e.ok)throw new Error("HTTP "+e.status);const a=await e.blob(),i=(await JSZip.loadAsync(a)).file(n);if(!i)throw new Error(`File ${n} not found`);const r=await i.async("text");wi.fill(0),hi.fill(0),di.fill(0),S=0;let o=0,c=0;const l=r.split("\n").map(t=>t.trim()).filter(t=>t&&!t.startsWith("#"));for(const t of l){const n={".":oi,"+":ci,"-":li}[t[t.length-1]]||0,e=vi(t.substring(0,t.length-1));if(16!==e.length)continue;bi(e);const a=yi(),i=Ai();si.has(i)||si.set(i,{win:0,draw:0,loss:0,total:0,def:ki(i)});const r=si.get(i);n===oi?r.draw++:n===ci?r.win++:n===li&&r.loss++,r.total++,Mi(a,n)?o++:c++}for(const[t,n]of si.entries()){let t=!1;n.def===ci&&n.win>0&&(t=!0),n.def===oi&&n.draw>0&&(t=!0),n.def===li&&n.loss>0&&(t=!0)}V(),S=0,fi=o}catch(t){}}(),K()}