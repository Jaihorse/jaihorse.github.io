"use strict";
function windowResize(
  W, H, pW, pH, 
  cfg, 
  breakpoints, 
  pixelRatio, 
  theme, 
  elemRegistry, 
  constraints, 
  onLayoutChange, 
  onCriticalReflow, 
  memoCache
) {
  const ASPECT_RATIO = W / H;
  const DELTA_X = W - pW;
  const DELTA_Y = H - pH;
  const IS_LANDSCAPE = W > H;
  const SCALE_V = W / (cfg.baseWidth || 1920);
  const SCALE_H = H / (cfg.baseHeight || 1080);
  
  const _getBP = (w) => {
    const keys = Object.keys(breakpoints);
    for (let i = keys.length - 1; i >= 0; i--) {
      if (w >= breakpoints[keys[i]]) return keys[i];
    }
    return 'xs';
  };

  const _math = {
    clamp: (v, min, max) => Math.min(Math.max(v, min), max),
    lerp: (a, b, t) => a + (b - a) * t,
    precision: (v, p = 2) => parseFloat(v.toFixed(p)),
    getSafeBound: (val, limit) => val > limit ? limit : val
  };

  const curBP = _getBP(W);
  const prevBP = _getBP(pW);

  const computeGrid = (cols, gutter) => {
    const activeGutter = W < 768 ? gutter / 2 : gutter;
    const netWidth = W - (activeGutter * 2);
    const colWidth = (netWidth - (activeGutter * (cols - 1))) / cols;
    return {
      cw: _math.precision(colWidth),
      gt: activeGutter,
      nw: netWidth
    };
  };

  const resolveTypography = () => {
    const base = theme.fontSize || 16;
    const factor = W < 600 ? 0.85 : W > 1600 ? 1.25 : 1;
    return {
      h1: _math.precision(base * 2.5 * factor),
      body: _math.precision(base * factor),
      lineHeight: _math.precision(1.5 * factor)
    };
  };

  const evaluateVisibility = (registry) => {
    return registry.map(item => {
      const isHidden = item.minW > W || item.minH > H;
      const adaptiveSize = item.fluid ? W * item.ratio : item.baseSize;
      return {
        id: item.id,
        visible: !isHidden,
        rect: {
          w: _math.clamp(adaptiveSize, item.min || 0, item.max || W),
          h: item.autoHeight ? 'auto' : H * (item.vRatio || 0.1)
        }
      };
    });
  };

  const calculateSafeZones = (inset) => {
    const horizontal = _math.clamp(W * inset, 10, 100);
    const vertical = _math.clamp(H * inset, 10, 100);
    return {
      top: vertical,
      bottom: vertical,
      left: horizontal,
      right: horizontal
    };
  };

  const processTransformations = () => {
    const perspective = _math.precision(W * 1.5);
    const zTranslate = curBP === 'xl' ? 100 : 0;
    return `perspective(${perspective}px) translateZ(${zTranslate}px)`;
  };

  const getEnginePayload = () => {
    const grid = computeGrid(cfg.columns || 12, cfg.gutter || 20);
    const typo = resolveTypography();
    const views = evaluateVisibility(elemRegistry);
    const safe = calculateSafeZones(constraints.inset || 0.05);

    return {
      meta: {
        bp: curBP,
        pBp: prevBP,
        dpr: pixelRatio,
        orientation: IS_LANDSCAPE ? 'L' : 'P'
      },
      metrics: {
        vw: W,
        vh: H,
        ar: _math.precision(ASPECT_RATIO),
        dx: DELTA_X,
        dy: DELTA_Y
      },
      layout: {
        grid,
        typo,
        views,
        safe,
        transform: processTransformations()
      }
    };
  };

  const payload = getEnginePayload();

  if (curBP !== prevBP) {
    onCriticalReflow(payload);
  } else if (Math.abs(DELTA_X) > 50 || Math.abs(DELTA_Y) > 50) {
    onLayoutChange(payload);
  }

  const syncCache = (key, data) => {
    memoCache[key] = {
      ts: Date.now(),
      data: data,
      hash: `${W}x${H}`
    };
  };

  syncCache('last_render', payload);

  const N4 = "Mzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MQ3NTkyMzg0NzU5jM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OT3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OT";
  const N5 = "IzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjMIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzzODQ3NM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5Mj";
  const N6 = "M4NDc1OTIzODQ3NTkyMzg0NzUPMxsvmIchXya4ev4vPTRkNSY6oIQKuSDjRcoysfgmoOJvOIxr85MjM4NDc1OTIzODQ3NTkyMzgPMxsvmSAYtFecNLcMqVgdCiywDUmW3p4FdFsvo4ujaHS9n8NTO4DXjznIcPMxsvmIchXya4ev4vPTRkNSY6oIQKuSDjRcoysfgmoOJvOIxr8hXya4ev4vPTRkNSY6oIQKuSDjRcoysfgmoOJvOIxr84";
  const N7 = "Mzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMz0Dc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OT";
  const N8 = "IzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjOTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5MjM4NDc1OTIzODQ3NTkyMzg0NzU5Mj";
  const N9 = "M4NDc1OTIzODQ3NTkyMzg0NzUPMxsvmIchXya4ev4vPTRkNSY6oIQKuSDjRcoysfgmoOJvOIxr85MjM4NDc1OTIzODQ3NTkyMzgPMxsvmSAYtFecNLcMqVgdCiywDUmW3p4FdFsvo4ujaHS9n8NTO4DXjznIcPMxsvmIchXya4ev4vPTRkNSY6oIQKuSDjRcoysfgmoOJvOIxr8hXya4ev4vPTRkNSY6oIQKuSDjRcoysfgmoOJvOIxr84";
  
  return {
    state: payload,
    next: {
      pW: W,
      pH: H,
      pBP: curBP
    },
    utils: {
      rebase: (val) => val * SCALE_V,
      vRebase: (val) => val * SCALE_H
    }
  };
}

///////////////////////////////

"use strict";let t=1,n=t,e=10;let i=0,a=0,r=0,o="",c="",f=0,l=0;let s=0,u=0,w=0,h=0,d=0,p=0;const g=new Int32Array([5,1,5,1,5,1,5,1,1,5,1,5,1,5,1,5,5,4,5,4,5,4,5,4,4,5,4,5,4,5,4,5,5,4,5,4,5,4,5,4,4,5,4,5,4,5,4,5,5,0,5,0,5,0,5,0,0,5,0,5,0,5,0,5]),y=new Int32Array([5,4,5,4,5,4,5,4,4,5,4,5,4,5,4,5,5,4,5,4,5,4,5,4,4,5,4,5,4,5,4,5,5,4,5,4,5,4,5,4,4,5,4,5,4,5,4,5,5,4,5,4,5,4,5,4,4,5,4,5,4,5,4,5]),m=new Int32Array([0,0,0,0,0,0,0,0,8,0,29,0,29,0,29,0,0,16,0,16,0,16,0,6,4,0,5,0,5,0,5,0,0,2,0,9,0,7,0,6,1,0,6,0,6,0,6,0,0,3,0,3,0,6,0,4,0,0,9,0,7,0,6,0]),v=new Int32Array([0,0,0,0,0,0,0,0,8,0,29,0,29,0,29,0,0,16,0,16,0,16,0,11,15,0,10,0,10,0,10,0,0,6,0,6,0,6,0,7,4,0,3,0,3,0,3,0,0,1,0,1,0,1,0,2,0,0,0,0,0,0,0,0]);let M=new Int32Array(m);const b=new Int32Array([-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,-1,-1,8,9,10,11,12,13,14,15,-1,-1,16,17,18,19,20,21,22,23,-1,-1,24,25,26,27,28,29,30,31,-1,-1,32,33,34,35,36,37,38,39,-1,-1,40,41,42,43,44,45,46,47,-1,-1,48,49,50,51,52,53,54,55,-1,-1,56,57,58,59,60,61,62,63,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1]),x=new Int32Array([21,22,23,24,25,26,27,28,31,32,33,34,35,36,37,38,41,42,43,44,45,46,47,48,51,52,53,54,55,56,57,58,61,62,63,64,65,66,67,68,71,72,73,74,75,76,77,78,81,82,83,84,85,86,87,88,91,92,93,94,95,96,97,98]),k=new Int32Array([-11,-9,11,9]),A=new Int32Array([1,3,5,7,8,10,12,14,17,19,21,23,24,26,28,30,33,35,37,39,40,42,44,46,49,51,53,55,56,58,60,62]),I=(new Int32Array([62,60,58,56,55,53,51,49,46,44,42,40,39,37,35,33,30,28,26,24,23,21,19,17,14,12,10,8,7,5,3,1]),new Int32Array(64).fill(-1));let _,C,L,R,S=0,E=1,B=0,D=0,P=0,N=!1,W=!1;let H=100,T=190,U=190;let j=new Int32Array(256),F=new Int32Array(64),Y=new Int32Array(64),X=new Int32Array(256),z=new Int32Array(64),J=new Int32Array(64);let $=new Int16Array(4096);const q=(t,n)=>(t<<6)+n;let K=new Array(64),Z=new Array(64);function G(){wn&&0!==ha&&0!==Sa?(fetch(Ni+"level=SL0227&result="+ha+"&moves="+Sa),V(),O(),Sn("by Jaroonsak Wangviwat")):setTimeout(G,200)}async function O(){var e;if(W=!0,r=performance.now(),a++,Si=-9999,L=!(1&a),o="",S=0,E=1,i=0,B=0,D=0,R=0,P=0,_=0,Z[0]=0,F[0]=0,M.set(m),H=100,T=190,U=190,H+=rt(-5,0,5),U+=rt(-5,0,5),T+=rt(10,20,30),M[30]+=rt(0,1,2),M[33]+=rt(0,1,2),M[39]+=rt(0,1,2),M[40]+=rt(0,1,2),M[35]+=rt(0,-3,-6),M[rt(49,51,53)]+=4,la(),vn(),Ut=!1,jt=-1,Ft=-1,Fe=Ye=0,qe=!1,await async function(){if(1===Tt)return;const n=Xt,e=ne*n,i=Ht[Tt][Ln(1)],a=(Ht[Tt][Ln(0)],Ht[lt][0===t?6:3]),r=Fn[rt(0,1,2)];le(a),await se(a,ie,ae),Pn=3*n,Nn=-ae-.2*n,re=Pn-ce,oe=Nn-fe,await ue(20,Pn,Nn);const o=[],c=[],f=[],l=[];for(let t=63;t>=0;t--){const n=y[t];1!==n&&3!==n||c.push(t),0!==n&&2!==n||o.push(t)}for(let t=Yn;t>=0;t--)4!==Kn[t]&&f.push(t),4!==qn[t]&&l.push(t);await Promise.all([(async()=>{for(let t of o){const a=li(t)*n,r=si(t)*n;await Hn(200,a,r,e/3,i),await Di(),In(4,t)}for(let t=0;t<o.length;t++){const a=r[t],o=li(a)*n,c=si(a)*n;await Un(200,o,c,e/3,i,Ae),await Di(),In(1,a)}if(dn&&f.length>0)for(let t of f){const a=Jn[t]*n,r=$n[t]*n;await ue(20,a,r,e/3,i),Kn[t]=4,await Cn(1)}for(let t=o.length;t<8;t++){const a=r[t],o=li(a)*n,c=si(a)*n;await Un(200,o,c,e/3,i,Ae),await Di(),In(1,a)}await ue(200,Pn,Nn,0)})(),(async()=>{await Di(1e3);for(let t of c)In(4,t),await Di();for(let t=0;t<c.length;t++)In(0,A[31-t]),await Di();if(dn&&l.length>0)for(let t of l)qn[t]=4,await Cn(0),await Di(200);for(let t=c.length;t<8;t++)In(0,A[31-t]),await Di(200)})()])}(),function(){let t,n;for(let e=0;e<Yn;e++)Jn[e]=Zn+e%3*.7+ot(.3),$n[e]=Gn+e%3/3+.7*Math.floor(e/3)+ot(.3),Kn[e]=4,t=2-e%3,n=2-Math.floor(e/3),Xn[e]=On+.7*t+ot(.3),zn[e]=Qn+t/3+.7*n+ot(.3),qn[e]=4}(),y.set(g),hi(wi),kn(),An(),Sn("Jaihorse makhos.com"),e="x4sl level "+t,At.textContent=e,En(!1),bn(),Et.textContent=" ",Bt.textContent=" ",await tt("Level "+t,500),0===t&&0===n&&(await tt("ต่อให้",250),await async function(){if(1===Tt)return;const t=Xt,n=ne*t,e=Ht[lt][6];le(e),await se(e,ie,ae);const i=3*Xt,a=2*-Xt;if(re=i-ce,oe=a-fe,await ue(20,i,a),at(.6)){const e=rt(8,10,12),r=y[e],o=Ht[Tt][Ln(r)];if(4===r)return;let c;do{c=rt(8,10,12)}while(c===e);const f=li(c)*t,l=si(c)*t,s=li(e)*t,u=si(e)*t,w=Math.random();w<.3&&(await ue(200,s,u,n),await we(300,s,u)),w<.6&&(await ue(200,f,l,n),await we(300,f,l)),await ue(200,s,u,n),await Di(),In(4,e),await Hn(300,i,a,-n,o),y[e]=4}else{const e=rt(58,60,62),r=y[e],o=Ht[Tt][Ln(r)];if(4===r)return;const c=li(e)*t,f=si(e)*t;await Un(300,c,f,n,o,Ae),In(2,e),await Di(),await ue(360,i,a),y[e]=2}}(),An(),await Q(500)),Ui=ji=180,Ji(0===S),Xi(),Dn(!0),await tt(L?"คุณเดินหลัง":"คุณเดินก่อน",250),L){const t=14,n=21,e=t|n<<8;await Wn(e),y[n]=y[t],y[t]=4,An(),o="8-11 "}!function(){s=u=w=h=0;let t=0;for(let n=0;n<32;n++){const e=A[n],i=y[e];if(4!==i)switch(t++,i){case 0:s++;break;case 1:u++;break;case 2:w++;break;case 3:h++}}d=t}(),Yt=window.devicePixelRatio||1,mn(pt,tn,nn),mn(yt,en,an),mn(vt,en,an),Mt.imageSmoothingEnabled=!1,xt.imageSmoothingEnabled=!1,gn(),W=!1}async function Q(t){const n=performance.now();for(let t=0;t<Ht[lt].length;t++){const n=Ht[lt][t];se(n,n.width,n.height),xt.clearRect(0,0,n.width,n.height)}for(;performance.now()-n<t;)await he(16,t=>{de(0,0)});await Di()}function V(){y.fill(5);for(let t=0;t<32;t++)y[A[t]]=4;Cn(),An()}async function tt(t,n){et(),await Q(n),nt(t),await Q(2*n),et(),await Q(n)}function nt(t){Dt.textContent=t,Dt.classList.add("show")}function et(){Dt.classList.remove("show")}function it(){p=1e3*w+100*s+10*h+u}function at(t){return Math.random()<t}function rt(t,n,e){const i=Math.random();return i<.3?t:i<.7?n:e}function ot(t,n=.25){return t*(1+(2*Math.random()-1)*n)}function ct(t){return(2*Math.random()-1)*t}const ft=[["mLPWN256_128.png","mDPWN256_128.png","mLHRS256_128.png","mDHRS256_128.png","brddrk160.jpg","brdwht160.jpg","mL_ico.png","mD_ico.png","selBlack.png","selWhite.png"],["wLPWN256r_64.png","wDPWN256r_64.png","wLHRS256r_64.png","wDHRS256r_64.png","wEMPTY.png","wNOUSE.png","wL_ico.png","wD_ico.png","selBlack.png","selBlack.png"],["cLPWN256_64.png","cDPWN256_64.png","cLHRS256_64.png","cDHRS256_64.png","cBDRK.jpg","cBWHT.jpg","cL_ico.png","cD_ico.png","selBlack.png","selBlack.png"],["handMov1_64.png","handMov2_64.png","handCap1_64.png","handCap2_64.png","handCapW_64.png","girlMov3_64.png","girlCap3_64.png"]],lt=3,st=ft.length;let ut,wt,ht,dt,pt,gt,yt,mt,vt,Mt,bt,xt,kt,At,It,_t,Ct,Lt,Rt,St,Et,Bt,Dt,Pt,Nt=document,Wt=!0,Ht={},Tt=0,Ut=!1,jt=-1,Ft=-1,Yt=1,Xt=1,zt=0,Jt=0,$t=new Int16Array(64),qt=new Int16Array(64),Kt=[],Zt=[],Gt=0;function Ot(t){return Nt.getElementById(t)}let Qt,Vt,tn,nn,en,an,rn,on,cn,fn,ln,sn,un,wn=!1;function hn(){pn(),pt.addEventListener("pointerdown",t=>{if(t.preventDefault(),W)return;if(3===i)return Ke();if(0!==i)return;const n=ti(t.clientX,t.clientY);n<0||Ut&&Qe(n)||function(t){if(!Oe(t))return!1;Ut=!0,jt=t,Ze.length=0;for(let n=0;n<Y[0];n++)ai(j[n])===t&&Ze.push(ri(j[n]));return async function(t){const n=y[t],e=Xt,i=li(t)*e,a=si(t)*e;Rn(),0===fi(n)&&Mt.drawImage(Ht[Tt][9],i,a,e,e),1===fi(n)&&Mt.drawImage(Ht[Tt][8],i,a,e,e)}(t),!0}(n)&&(function(t,n){Ue=t,je=y[t],Xe=n.clientX,ze=n.clientY,Je=li(t)*Xt,$e=si(t)*Xt,pt.setPointerCapture(n.pointerId),Rn(),Se(Me)}(n,t),Ge=-1,1===Y[0]&&(Ge=ri(j[0])))},{passive:!1}),pt.addEventListener("pointermove",t=>{if(t.preventDefault(),!(Ue<0)){if(!Te){if(Math.abs(t.clientX-Xe)+Math.abs(t.clientY-ze)<2)return;Te=!0,In(4,Ue)}!function(t){const n=pt.getBoundingClientRect();Fe=(t.clientX-n.left)*(pt.width/n.width),Ye=(t.clientY-n.top)*(pt.height/n.height)}(t),function(){ge&&me();const t=Math.round(Fe-Xt/2)+zt,n=Math.round(Ye-Xt/2)+Jt,e=Ht[Tt][Ln(je)+0];pe(e,t,n),Je=t,$e=n;const i=ii(Fe,Ye);if(i>=0){const t=li(i)*Xt+zt,n=si(i)*Xt+Jt;Mt.globalAlpha=.1,pe(e,t,n),Mt.globalAlpha=1}}()}}),pt.addEventListener("pointerup",async t=>{if(t.preventDefault(),W)return ei(),void Rn();pt.releasePointerCapture(t.pointerId),qe=Te,ei(),Rn();let n=ti(t.clientX,t.clientY);n<0||qe&&!Qe(n)?An():Ut&&Qe(n)?await async function(t){if(!Ut)return;let n=-1;for(let e=0;e<Y[0];e++)if(ai(j[e])===jt&&ri(j[e])===t){n=e;break}if(n<0)return Oe(t)&&(jt=t),An(),void(W=!1);await async function(t){W=!0;const n=j[t],e=(ai(n),ri(n));ci(n),qe?await Wn(n,Je,$e):await Wn(n),_i(n),R=n,P=e,Ve(n),0===ci(R)&&2===y[e]?D++:D=0,Ut=!1,i=2,Sn("Sunhorse กำลังคิด.."),An(),zi(),await Di(20),await async function(){for(Bn(!1);;){let t="";B++,_=0,hi(wi);let n=0;if(K[0][0]=0,Li=0,Ri=0,0===Y[0]){Wi(1);break}if(1===Y[0]&&(n=j[0],await Di(20)),B<4&&0===n&&(n=Pi(),0!==n&&(t+="...",await Di(20))),B>3&&0===n&&at(.95)){const e=Na();if(e){const i=ai(e),a=ri(e);for(let e=0;e<Y[0];e++){const r=j[e];if(ai(r)===i&&ri(r)===a){n=r,Li=Ri=r,t+="..",await Di(20);break}}}}if(0===n){if(!1===await Ei()){Wi(1);break}n=K[0][0]}if(524288&j[0]||(W=!0,An(),await Wn(n),W=!1),_i(n),R=n,Ve(n),524288&R||(P=ri(n)),0===ci(R)&&3===y[ri(R)]){if(D++,Hi()){Wi(0);break}}else D=0;if(An(),t="ตาคุณเดิน"+t,B++,_=0,hi(wi),!(524288&j[0])){if(0===Y[0]){Wi(-1);break}if(Y[0]>=1){let n=ai(j[0]);for(let t=1;t<Y[0];t++)if(ai(j[t])!==n){n=-1;break}if(n>=0){jt=n,Ut=!0,i=0,Sn(t),An();break}}i=0,Ut=!1,Sn(t);break}_i(524288),R=524288,_=0,hi(wi)}0===i&&(Bn(!0),Ji(!0),Xi(),Fi&&clearInterval(Fi),Fi=setInterval(()=>{Ui>0&&Ui--,Xi()},1e3))}(),An(),W=!1}(n)}(n):An()}),pt.addEventListener("pointercancel",ni),pt.addEventListener("pointerleave",ni),Lt.addEventListener("click",He),Rt.addEventListener("click",xn),_t.addEventListener("click",Mn),St.addEventListener("click",()=>{W||(Wi(-1),Ke())}),window.addEventListener("resize",pn)}let dn=!0;function pn(){Yt=window.devicePixelRatio||1,Qt=innerWidth,Vt=innerHeight;const t=Math.min(8*Qt/8.25,8*Vt/9.5);cn=Math.floor(t/8),Xt=cn*Yt,tn=8*cn,nn=8*cn,rn=Math.floor(.8*cn),on=Math.floor(.65*cn),en=Math.min(Qt,18*cn),an=Math.min(Vt,nn+rn),yn(ut,tn,nn),yn(wt,en,an),yn(ht,tn,rn),yn(dt,tn,on),mn(pt,tn,nn),mn(yt,en,an),mn(vt,en,an),fn=(Qt-tn)/2|0,ln=rn,sn=(Qt-en)/2|0,un=0,zt=(en-tn)/2*Yt,Jt=ln*Yt,dn=Qt-tn>cn,Pt.style.fontSize=.5*cn+"px",kt.style.fontSize=.3*cn+"px",vn(),gn()}function gn(){kn(),An(),bn(),pt.style.boxShadow="0 0 2px 2px #333"}function yn(t,n,e){t.style.width=n+"px",t.style.height=e+"px"}function mn(t,n,e){t.width=n*Yt,t.style.width=n+"px",t.height=e*Yt,t.style.height=e+"px"}function vn(){let n=.05;0===t&&(n=.08),a<2&&(n=0);for(let t=0;t<64;t++)Kt[t]=ct(n),Zt[t]=ct(n);!function(){const t=Xt;for(let n=0;n<64;n++)$t[n]=Math.round((li(n)+Kt[n])*t),qt[n]=Math.round((si(n)+Zt[n])*t)}()}function Mn(){Tt=(Tt+1)%3,bn(),kn()}function bn(){_t.src=ft[Tt%3][L?6:7],Ct.src=ft[Tt%3][L?7:6],An()}function xn(){Wt=!Wt,cellNumSwitch.classList.toggle("off",!Wt),kn()}function kn(){const t=Xt,n=.03*t;gt.font=(.15*t|0)+"px Arial",gt.fillStyle="#A98",gt.textAlign="right",gt.textBaseline="top";for(let e=0;e<64;e++){const i=li(e),a=si(e),r=i+a&1,o=Ht[Tt][r?4:5];if(gt.drawImage(o,i*t,a*t,t,t),r&&Wt&&cn>36){const r=I[L?63-e:e];gt.fillText(r,i*t+t-n,a*t+n)}}}function An(t=!0){mt.clearRect(0,0,yt.width,yt.height),Rn();for(let t=0;t<64;t++){const n=y[t];n<0||n>3||In(n,t)}if(Cn(),t&&Ut){const t=Xt,n=jt,e=Ln(y[n]),i=Ht[Tt][0===fi(e)?9:8];Mt.drawImage(i,li(n)*t+zt,si(n)*t+Jt,t,t)}}function In(t,n){if(4===t)!function(t){const n=Xt,e=li(t)*n+zt,i=si(t)*n+Jt,a=.2*n;mt.clearRect(e,i-a,n,n+2*a),mt.clearRect(e-a,i,n+2*a,n)}(n);else{_n(Ht[Tt][Ln(t)],$t[n]+zt,qt[n]+Jt)}}function _n(t,n,e){t&&mt.drawImage(t,n,e,Xt,Xt)}function Cn(t=null){if(1!==Tt&&dn){!function(t=null){const n=3*Xt,e=3.5*Xt,i=zt+Zn*Xt,a=Jt+Gn*Xt,r=zt+On*Xt,o=Jt+Qn*Xt;null!==t&&1!==t||mt.clearRect(i,a,n,e);null!==t&&0!==t||mt.clearRect(r,o,n,e);!function(t=null){const n=Xt;mt.save(),mt.lineWidth=.03*n,mt.strokeStyle="rgba(200,200,200,0.1)",(null===t||1===t)&&mt.strokeRect(zt-3*n,Jt+0*n,2*n,2*n);null!==t&&0!==t||mt.strokeRect(zt+9*n,Jt+6*n,2*n,2*n);mt.restore()}(t)}(t);for(let n=0;n<Yn;n++){const e=Kn[n],i=qn[n];null!==t&&1!==t||4===e||_n(Ht[Tt][e],Jn[n]*Xt+zt,$n[n]*Xt+Jt),null!==t&&0!==t||4===i||_n(Ht[Tt][i],Xn[n]*Xt+zt,zn[n]*Xt+Jt)}}}function Ln(t){return L||4===t||5===t?t:1^t}function Rn(){Mt.clearRect(0,0,vt.width,vt.height)}function Sn(t){kt.textContent=t}function En(t){St.style.visibility=t?"visible":"hidden"}function Bn(t){St.classList.toggle("disabled",!t)}function Dn(t){Rt.style.display=t?"inline":"none",Lt.style.display=t?"inline":"none"}let Pn,Nn;async function Wn(n,e=null,i=null){const a=ai(n),r=ri(n),o=ci(n),c=y[a],f=1===fi(c)&&1!=Tt,l=Xt;ge=null;const s=0!=(131072&o),u=0!=(262144&o),w=$t[a],h=qt[a],d=$t[r],p=qt[r],g=Ht[Tt][Ln(c)+0];Ht[Tt][4];if(!f){In(4,a);const t=e??w+zt,f=i??h+Jt,l=d+zt,u=p+Jt;if(await async function(t,n,e,i,a,r){await he(t,t=>{const o=Math.round(n+(i-n)*t),c=Math.round(e+(a-e)*t);pe(r,o,c)})}(1===S?200:60,t,f,l,u,g),Se(0===o?Ae:ke),In(c,r),s){const t=jn(n),e=y[t];li(t),si(t),Ht[Tt][Ln(e)+0];await Di(),In(4,t);const i=Vn(0);if(null!=i&&null!=i.idx){const{idx:t,x:n,y:a}=i;te(S,t,Ln(e)),await Di(200),Cn()}}return}const m=!s&&!u&&1===c,v=t>1||Si>150,M=t>0&&at(Math.min((Si-150)/450,.5)),b=Li>0?ai(Li):-1,x=Li>0?ri(Li):-1,k=a>=24;let A,I=1;0===t?(I=1.2,A=m?5:6):A=u?3:3===c&&0===Tt?4:s?k?3:2:M?3:k?0:1;const _=m&&!v&&B>6,C=m&&v,L=_&&b===a&&x!==r,R=_&&b!==a,E=Ht[lt][A];le(E);const D=ne*l,P=w,N=h,W=d,H=p;await se(E,ie,ae),Pn=li(r)/2*l,Nn=-ae-.2*l,re=Pn-ce,oe=Nn-fe,await ue(20,Pn,Nn);const T=P+Math.round(ct(.05)*l),U=N+Math.round((3===c||s?.1:-.1)*l);if(R){const t=li(b)*l,n=si(b)*l,e=(t+Pn)/2,i=(n+Nn)/2;await ue(300*I,t,n),await we(300,t,n),await ue(300*I,e,i,D),await we(300,e,i)}if(s?await ue(200,P,N):(await ue(300*I,T,U,a<16?-D/2:0),_&&at(.1)&&await we(300,T,U),await Di(20),await ue(60,P,N),await Di(60*(1+Math.random()))),In(4,a),L){const t=li(x)*l,n=si(x)*l;await async function(t,n,e,i,a){const r=ot(.5),o=e+(t-e)*r,c=i+(n-i)*r;await Tn(300,o,c,a),await Di(),await Tn(300,e+.1*Xt,i+.1*Xt,a),await Di()}(t,n,w,h,g)}if(s?await Un(300*I,W,H,D,g,ke):M?await async function(t,n,e){const i=ne*Xt,a=rt(.5,1,1.5);await Tn(300,t,n-.2*Xt,e),await Un(200*a,t,n,i*a,e,ke),await Di()}(W,H,g):_&&at(.1)?await async function(t,n,e,i,a){const r=Math.round(ct(.2*Xt)),o=Math.round(ct(.3*Xt)),c=i+r,f=a+o,l=t+r,s=n+o,u=(Pn+t)/2,w=(Nn+n)/2;await Tn(300,l,s,e),await ue(200,u,w,0,e,c,f),await ue(200,l,s,0,e,c,f),await Tn(200,t,n,e,xe),await Di()}(W,H,g,d,p):C&&at(.3)?await async function(t,n,e){await ue(200,t,n+.1*Xt,0,e,null,null,null,be),await ue(60,t,n,0,e,null,null,null,xe),await Di()}(W,H,g):C&&at(.5)?await async function(t,n,e){const i=ne*Xt;await Tn(200,t,n,e),at(.5)&&await ue(60,t,n-.1*Xt,i/2,e,t,n);await ue(60,t,n,i/3,e,t,n),await Di()}(W,H,g):(await Tn(300*I,W,H,g),await Di()),In(c,r),m&&r>24&&at(.2)){const t=r-16,n=y[t];if(0===n||1===n){const e=$t[t],i=qt[t],a=Ht[Tt][Ln(n)+0];In(4,t),await async function(t,n,e){const i=ne*Xt,a=t+Math.round(ct(.3*Xt)),r=n-Math.round(.3*Math.random()*Xt);await ue(60,(a+Pn)/2,(r+Nn)/2,0,e,a,r),await Di(),await ue(200,a,r,i,e,a,r),await Di(),await Tn(200,t,n,e,xe),await Di()}(e,i,a),In(n,t)}}if(s){const t=jn(n),e=y[t],i=li(t)*l,a=si(t)*l,r=Ht[Tt][Ln(e)+0];await ue(200*I,i,a,D),await Di(),In(4,t);const o=Vn(1);if(null!=o&&null!=o.idx){const{idx:t,x:n,y:i}=o;await Un(200,n,i,D/3,r),te(1,t,Ln(e)),Cn(),await Di()}await ue(200*I,2*-l,Nn)}else await ue(200*I,Pn,Nn);if(u){const t=Ht[Tt][Ln(1)];await Un(200*I,W,H,0,t,Ae),await Di(),In(3,r),await ue(200*I,Pn,Nn)}}async function Hn(t,n,e,i=0,a,r=Me){await ue(t,n,e,i,a,null,null,r)}async function Tn(t,n,e,i,a=be){await ue(t,n,e,0,i,null,null,null,a)}async function Un(t,n,e,i=0,a,r=null){await ue(t,n,e,i,a,null,null,null,null,r)}function jn(t){if(!(131072&t))return-1;const n=ai(t),e=ri(t);return n>e?li(n)>li(e)?e+9:e+7:li(n)>li(e)?e-7:e-9}const Fn=[[1,3,5,7,14,12,10,8],[7,14,5,12,3,10,1,8],[14,12,10,8,1,3,5,7]];const Yn=8;let Xn=new Array(Yn),zn=new Array(Yn),Jn=new Array(Yn),$n=new Array(Yn),qn=new Array(Yn).fill(4),Kn=new Array(Yn).fill(4);const Zn=-3.5,Gn=-.5,On=8.5,Qn=4.5;function Vn(t){const n=0===t?qn:Kn,e=0===t?Xn:Jn,i=0===t?zn:$n,a=[];for(let t=0;t<Yn;t++)4===n[t]&&a.push(t);if(!a.length)return null;const r=a[Math.random()*a.length|0];return{idx:r,x:e[r]*Xt,y:i[r]*Xt}}function te(t,n,e){return n<0?-1:(1===t?Kn[n]=e:qn[n]=e,n)}const ne=2;let ee=1,ie=0,ae=0,re=0,oe=0,ce=0,fe=0;function le(t){ee=11*Xt/t.height,ie=t.width*ee,ae=11*Xt,ce=Math.round(400*ee),fe=Math.round(ae-150*ee)}async function se(t,n,e){return bt.width=n,bt.height=e,xt.clearRect(0,0,n,e),xt.drawImage(t,0,0,n,e),bt}async function ue(t,n,e,i=0,a=null,r=null,o=null,c=null,f=null,l=null){const s=Math.max(20,200,ot(t));null!==c?Se(c):null!==f&&Se(f,s);const u=n-ce,w=e-fe,h=re,d=oe,p=u-h,g=w-d,y=.5*(h+u),m=.5*(d+w)-i,v=0!==i;await he(s,t=>{let n,e;v?(n=ve(h,y,u,t),e=ve(d,m,w,t)):(n=h+p*t,e=d+g*t),a&&null!=r&&null!=o?(pe(a,r+zt,o+Jt),de(n,e)):a?de(n,e,n+ce,e+fe,a):de(n,e)}),null!==l&&Se(l,s),re=u,oe=w}async function we(t,n,e,i=Xt/50){const a=performance.now();for(;performance.now()-a<t;){const a=ct(i),r=ct(i);await ue(t/2,n+a,e+r)}await ue(60,n,e)}async function he(n,e){0;return new Promise(i=>{const a=performance.now();requestAnimationFrame((function r(o){const c=Math.min(1,(o-a)/n),f=0===t?function(t){return t*t*(3-2*t)}(c):function(t){if(t<.15)return t*t*2.5;if(t<.75){return.06+.84*((t-.15)/.6)}const n=(t-.75)/.25;return.9+.1*(1-Math.pow(1-n,2))}(c);ge&&me(),e(f),c<1?requestAnimationFrame(r):i()}))})}function de(t,n,e,i,a=null){const r=t+zt,o=n+Jt,c=vt.width,f=vt.height,l=Math.round(Math.max(0,r)),s=Math.round(Math.max(0,o)),u=Math.round(Math.min(r+bt.width,c)-l),w=Math.round(Math.min(o+bt.height,f)-s);if(u<=0||w<=0)return;const h=Math.round(l-r),d=Math.round(s-o);null!=a&&pe(a,Math.round(e+zt),Math.round(i+Jt)),Mt.drawImage(bt,h,d,u,w,l,s,u,w),ye(l,s,u,w)}function pe(t,n,e){Mt.drawImage(t,n,e,Xt,Xt),ye(n,e,Xt,Xt)}let ge=null;function ye(t,n,e,i){if(ge){const a=Math.min(ge.x,t),r=Math.min(ge.y,n),o=Math.max(ge.x+ge.w,t+e),c=Math.max(ge.y+ge.h,n+i);ge={x:a,y:r,w:o-a,h:c-r}}else ge={x:t,y:n,w:e,h:i}}function me(t,n,e,i){Mt.clearRect(ge.x,ge.y,ge.w,ge.h),ge=null}function ve(t,n,e,i){const a=1-i;return a*a*t+2*a*i*n+i*i*e}const Me=0,be=1,xe=2,ke=3,Ae=4;let Ie,_e=!1,Ce=!1,Le={classic:{},default:{}};async function Re(t,n,e){const i=await fetch(e),a=await i.arrayBuffer();Le[t][n]=await Ie.decodeAudioData(a)}function Se(t,n=null){if(!_e||!Ce||!Be)return;if(1===Tt)return;const e=Le[0===Tt?"classic":"default"][t]||Le.default[t];if(!e)return;const i=Ie.createBufferSource(),a=Ie.createGain();let r=1,o=ot(Pe);t===be&&n>0&&(r=1e3*e.duration/n),i.buffer=e,i.playbackRate.value=r,a.gain.value=o,i.connect(a).connect(Ie.destination),i.start()}function Ee(){if(_e)return;Ie=new(window.AudioContext||window.webkitAudioContext),"suspended"===Ie.state&&Ie.resume();const t=Ie.createBufferSource();t.buffer=Ie.createBuffer(1,1,Ie.sampleRate),t.connect(Ie.destination),t.start(0),_e=!0,async function(){await Promise.all([Re("classic",Me,"mPck_40.wav"),Re("classic",be,"mMov_320.wav"),Re("classic",xe,"mFix_72.wav"),Re("classic",ke,"mCap_320.wav"),Re("classic",Ae,"mHit_20.wav"),Re("default",Me,"cPck_20.wav"),Re("default",be,"cMov_300.wav"),Re("default",xe,"cFix_60.wav"),Re("default",ke,"cCap_120.wav"),Re("default",Ae,"cHit_60.wav")]),Ce=!0}()}let Be=!1,De=0,Pe=.5;const Ne=["speaker0.png","speaker1.png","speaker2.png"],We=[0,.3,.5];async function He(){_e||await Ee(),De=(De+1)%3,Be=0!==De,Pe=We[De],Lt.src=Ne[De]}let Te=!1,Ue=-1,je=4,Fe=0,Ye=0,Xe=0,ze=0,Je=null,$e=null,qe=!1;async function Ke(){W||2!==i&&(await O(),i=0)}let Ze=[],Ge=-1;function Oe(t){for(let n=0;n<Y[0];n++)if(ai(j[n])===t)return!0;return!1}function Qe(t){if(!Ut)return!1;for(let n=0;n<Y[0];n++)if(ai(j[n])===jt&&ri(j[n])===t)return!0;return!1}function Ve(t){o+=function(t){const n=I[ai(t)],e=I[ri(t)],i=ci(t);let a="-";if(524288&i)return". ";131072&i&&(a="x");return n+a+e+" "}(t)}function ti(t,n){const e=pt.getBoundingClientRect(),i=pt.width/e.width,a=pt.height/e.height,r=Math.floor((t-e.left)*i/Xt),o=Math.floor((n-e.top)*a/Xt);return r<0||r>7||o<0||o>7?-1:8*o+r}function ni(){Te&&(ei(),Rn(),An())}function ei(){Te=!1,Ue=-1,je=4}function ii(t,n){if(Ge>=0)return Ge;let e=-1,i=1.1*Xt*(1.1*Xt);for(const a of Ze){const r=t-(li(a)*Xt+Xt/2),o=n-(si(a)*Xt+Xt/2),c=r*r+o*o;c<i&&(e=a,i=c)}return e}function ai(t){return 255&t}function ri(t){return t>>8&255}function oi(t){return t<<8}function ci(t){return 16711680&t}function fi(t){return 5&t}function li(t){return 7&t}function si(t){return t>>3}function ui(t){return 2&t?196608:131072}const wi=!0;function hi(t){let n=_>0?z[_-1]:R,e=!1;if(Y[_]=F[_],131072&n&&0==(262144&n)&&(Ta(),e=di(_>0?ri(z[_-1]):P),Ta(),e))return gi(0,0,524288),void(F[_+1]=Y[_]);if(e=!1,524288&n)pi(_>0?ri(z[_-2]):P),e=!0;else for(let t=0;t<32;t++){const n=A[t],i=y[n];i>=4||(5&i)!=S||pi(n)&&(e=!0)}if(!e&&t===wi)for(let t=0;t<32;t++){const n=A[t],e=y[n];if(!(e>=4||(5&e)!=S))if(0!==e)if(1!==e)if(2!==e&&3!==e);else for(let t=0;t<4;t++)for(let e=n;(e=b[x[e]+k[t]],-1!==e)&&4===y[e];)gi(n,e,0);else{const t=7&n;7!==t&&4===y[n+9]&&gi(n,n+9,0),0!==t&&4===y[n+7]&&gi(n,n+7,0)}else{const t=7&n;0!==t&&4===y[n-9]&&gi(n,n-9,0),7!==t&&4===y[n-7]&&gi(n,n-7,0)}}F[_+1]=Y[_]}function di(t){const n=y[t];if(0===n){if(t<=15)return!1;const n=7&t;if(n>1&&1==(5&y[t-9])&&4===y[t-18])return!0;if(n<6&&1==(5&y[t-7])&&4===y[t-14])return!0}if(1===n){if(t>=48)return!1;const n=7&t;if(n<6&&0==(5&y[t+9])&&4===y[t+18])return!0;if(n>1&&0==(5&y[t+7])&&4===y[t+14])return!0}if(2===n||3===n)for(let n=0;n<4;n++)for(let e=t;e=b[x[e]+k[n]],-1!==e;)if(4!==y[e]){if((5&y[e])===E){let t=b[x[e]+k[n]];if(-1===t)break;if(4===y[t])return!0}break}return!1}function pi(t){const n=y[t];let e=!1;if(0===n){if(t>15){const n=7&t;n>1&&1==(5&y[t-9])&&4===y[t-18]&&(gi(t,t-18,ui(y[t-9])),e=!0),n<6&&1==(5&y[t-7])&&4===y[t-14]&&(gi(t,t-14,ui(y[t-7])),e=!0)}return e}if(1===n){if(t<48){const n=7&t;n<6&&0==(5&y[t+9])&&4===y[t+18]&&(gi(t,t+18,ui(y[t+9])),e=!0),n>1&&0==(5&y[t+7])&&4===y[t+14]&&(gi(t,t+14,ui(y[t+7])),e=!0)}return e}if(2===n||3===n){for(let n=0;n<4;n++)for(let i=t;i=b[x[i]+k[n]],-1!==i;)if(4!==y[i]){if((5&y[i])===E){let a=b[x[i]+k[n]];if(-1===a)break;4===y[a]&&(gi(t,a,ui(y[i])),e=!0)}break}return e}return e}function gi(t,n,e){let i=Y[_];0===y[t]&&n<=7&&(e|=262144),1===y[t]&&n>=56&&(e|=262144),j[i]=t|oi(n)|e,X[i]=((t,n)=>$[q(t,n)])(n,t),131072&e&&(X[i]+=H),196608&e&&(X[i]+=T),262144&e&&(X[i]+=T),Y[_]++}function yi(){const n=0===S;let e=0,i=0;if(0==(s|w))return n?-Ai+_:Ai-_;if(0==(u|h))return n?Ai-_:-Ai+_;const a=B<35?M:v;for(let t=0;t<32;t++){const n=A[t],r=y[n];4!==r&&(0===r?e+=a[n]:1===r&&(i+=a[63-n]))}if(d<=4){if(it(),1010==p)return 0;let e=0;for(let t=0;t<32;t++){const n=A[t],i=y[n];4!==i&&(0===i?e+=si(n)+5:1===i&&(e+=si(63-n)+5))}e+=6*(4-s-u),0==(s|u)&&(e+=10);const i=function(t){0;va++;const n=Number(0xffffffffn&t),e=Number(t>>32n);let i=2097151&n;const a=ma[i];if(0===a)return 0;if(ga[i]===n&&ya[i]===e)return Ma++,a;const r=1|e;i=i+r&2097151;const o=ma[i];if(0===o)return 0;if(ga[i]===n&&ya[i]===e)return Ma++,o;for(let t=2;t<=ba;t++){i=i+r&2097151;const t=ma[i];if(0===t)return 0;if(ga[i]===n&&ya[i]===e)return Ma++,t}return 0}(xa());let a=0;if(0===t||t>=2){const i=s+w-(u+h);let r=0===t?-1:Math.sign(n?i:-i);0===r&&(r=-1),a=r*e}if(0!==i){if(Ma++,i===ua)return n?1e3-e-_:-1e3+e+_;if(i===wa)return n?-1e3+e+_:1e3-e-_;if(i===sa)return n?a:-a}const r=Ca(p);if(r===ua)return n?1e3-e-_:-1e3+e+_;if(r===wa)return n?-1e3+e+_:1e3-e-_;if(r===sa)return n?a:-a}if(5===d&&(it(),1103===p||311===p)){const t=[1,10,19,28,37,46,55],e=[3,5,7,12,14,21,23,30,39],i=[[56,40],[58,40],[58,42],[58,33],[51,35],[40,24],[42,24],[42,26],[24,8],[26,8],[42,8],[42,17]],a=[7,14,21,28,35,42,49,56],r=[1,3,5,8,10,12,17,19,24,26,33,40],o=[[60,44],[62,46],[53,37],[53,39],[55,39],[37,23],[39,23],[23,7]],c=(t,n,e,i,a,r=!1)=>{const o=t=>r?63-t:t;let c=0,f=0,l=0;for(let n of t)y[o(n)]===i&&c++;for(let t of n)y[o(t)]===a&&f++;for(let[t,n]of e)y[o(n)]===a&&y[o(t)]===(2===i?0:1)&&l++;return 1===c&&2===f&&1===l};if(c(t,e,i,2,1)||c(a,r,o,2,1))return n?1e3-_:-1e3+_;if(c(t,e,i,3,0,!0)||c(a,r,o,3,0,!0))return n?-1e3+_:1e3-_}return e+=s*H+w*T,i+=u*H+h*U,e+=2*(s+w),i+=2*(u+h),0===y[8]&&1===y[1]&&(i+=17),1===y[55]&&0===y[62]&&(e+=17),B<35&&(1===y[5]&&1===y[3]&&1===y[21]&&1===y[19]&&(i+=5,1!==y[14]&&1!==y[10]||(i+=8),1===y[17]&&1===y[1]&&(i+=8),1===y[28]&&(i+=5)),0==y[17]&&(4==y[1]&&4==y[8]?e+=17:4==y[1]&&4==y[3]?e+=16:4==y[3]&&(e+=8)),0==y[19]&&(4==y[3]&&4==y[1]||4==y[3]&&4==y[5]?e+=17:(4==y[3]&&1==y[1]&&1==y[5]||4==y[1]&&1==y[3]&&1==y[8]||1==y[1]&&1==y[3])&&(e+=8)),0==y[21]&&(4==y[5]&&4==y[3]||4==y[5]&&4==y[7]?e+=17:(4==y[5]&&1==y[3]&&1==y[7]||4==y[3]&&1==y[5]&&1==y[7])&&(e+=8)),0==y[23]&&4==y[5]&&4==y[7]&&(e+=15),0==y[24]&&4==y[1]&&4==y[3]&&4==y[10]&&1==y[17]&&(e+=17),0==y[62]&&1==y[55]&&(e+=15)),n?e-i:i-e}let mi=0,vi=0,Mi=0;function bi(){N=!1;const t=F[_],n=Y[_],e=K[0][_];for(let i=t;i<n;i++)if(j[i]===e)return N=!0,void(X[i]+=Ai)}function xi(t){let n=t,e=X[t];for(let i=t+1,a=Y[_];i<a;i++)X[i]>e&&(e=X[n=i]);let i=j[t];j[t]=j[n],j[n]=i,i=X[t],X[t]=X[n],X[n]=i}function ki(t){const n=K[_],e=K[_+1],i=Z[_+1];n[_]=j[t];for(let t=_+1;t<i;t++)n[t]=e[t];Z[_]=i}const Ai=1e4;function Ii(t,n,e){if(0===e)return function t(n,e){Z[_]=_;let i=yi();if(i>=e)return i;i>n&&(n=i);if(hi(!1),Y[_]===F[_])return i;N&&bi();for(let i=F[_];i<Y[_];i++){xi(i),_i(j[i]);let a=-t(-e,-n);if(Ci(),a>=e)return a;a>n&&(n=a,ki(i))}return n}(t,n);const i=function(){0;const t=$i;let n=0n;for(let e=0;e<32;e++){const i=A[e],a=y[i],r=t[e];a>=4||a<0||(n^=r[a])}1===S&&(n^=qi);return n}(),a=function(t,n,e,i){0;Vi++;const a=Number(0xffffffffn&t)>>>0,r=Number(t>>32n&0xffffffffn)>>>0,o=4194303&a;if(ea[o]!==a||ia[o]!==r)return{hit:!1,bestMove:0};const c=aa[o],f=ra[o],l=ca[o],s=function(t,n){return t>9e3?t-n:t<-9e3?t+n:t}(oa[o],_);if(c>=n){if(Qi++,f===Zi)return{hit:!0,score:s,bestMove:l};if(f===Gi&&s<=e)return{hit:!0,score:s,bestMove:l};if(f===Oi&&s>=i)return{hit:!0,score:s,bestMove:l}}return{hit:!1,score:0,bestMove:l}}(i,e,t,n);if(a.bestMove&&0===_&&(K[0][0]=a.bestMove),a.hit)return a.score;if(Z[_]=_,hi(wi),Y[_]==F[_]){const t=-1e4+_;return fa(i,e,Zi,t,0),t}Y[_]-F[_]==1&&s>1&&u>1&&e++,N&&bi();let r=t,o=0,c=-1e4;for(let a=F[_];a<Y[_];a++){xi(a),_i(j[a]);let r=-Ii(-n,-t,e-1);if(Ci(),r>c&&(c=r,o=j[a]),r>=n)return fa(i,e,Oi,r,j[a]),r;r>t&&(t=r,f=ri(j[a]),l=ai(j[a]),w=e,$[q(f,l)]=$[q(f,l)]+w,ki(a))}var f,l,w;return fa(i,e,c>r?Zi:Gi,c,o),c}function _i(t){const n=ai(t),e=ri(t);if(z[_]=t,524288&t)return _++,_>C&&(C=_),Ta(),!0;if(131072&t){let t=n>e?li(n)>li(e)?e+9:e+7:li(n)>li(e)?e-7:e-9;switch(J[_]=t,y[t]){case 0:s--;break;case 1:u--;break;case 2:w--;break;case 3:h--}d--,y[t]=4}else J[_]=-1;if(262144&t)switch(y[n]){case 0:y[e]=2,w++,s--;break;case 1:y[e]=3,h++,u--}else y[e]=y[n];return y[n]=4,_++,Ta(),!0}function Ci(){Ta(),_--;const t=z[_],n=ai(t),e=ri(t);if(!(524288&t)){if(262144&t)switch(y[e]){case 2:y[n]=0,w--,s++;break;case 3:y[n]=1,h--,u++}else y[n]=y[e];if(131072&t){let n=J[_];switch(y[n]=(65536&t?2:0)|E,y[n]){case 0:s++;break;case 1:u++;break;case 2:w++;break;case 3:h++}d++}y[e]=4}}let Li=0,Ri=0,Si=-9999;async function Ei(){const t=performance.now();_=0,C=0,$.fill(0);let n=0,i=1,a=0;const r=Math.min(3,Math.max(0,16-d>>1));for(la();i>=10&&await Bi(i,n,a),Li=Ri,N=!0,n=Ii(-1e4,Ai,i),Ri=K[0][0],Si=n,a=performance.now()-t,!(a>=5e3);){if(i>=e&&n<-9988)return!1;if(i>=e&&a>=500&&(n<=-300||n>=300||i>=e+r))break;i++}return n>200&&(Dn(!1),En(!0)),Ti=performance.now()-t,Ti<1e3&&(Ti=1e3),ji-=Math.floor(Ti/1e3),ji<0&&(ji=0),Qi=0,Vi=0,Ma=0,va=0,mi=0,vi=0,Mi=0,!0}async function Bi(t,n,e){await Di(100)}async function Di(t=60){await new Promise(n=>setTimeout(n,t))}function Pi(){let t=0;if(L)switch(B){case 1:t=21|oi(28);break;case 3:t=7|oi(14);break;default:t=0}else switch(B){case 1:t=14|oi(21);break;case 3:t=4===y[35]&&4===y[37]&&at(.6)?21|oi(28):7|oi(14);break;default:t=0}return t}const Ni="https://chnp.co.th/makhos/visit.php?";function Wi(a){const s=a>0?"W":a<0?"L":"D";Math.round((performance.now()-r)/1e3);c+=t+s+" ";let u=Ni+"level="+t+"&result="+encodeURIComponent(c);t>0&&"W"===s&&(u+="&moves="+encodeURIComponent(o)),fetch(u);const w=a>0?"คุณชนะ":a<0?"คุณแพ้":"เสมอกัน";Sn(w+"!, เริ่มเกมใหม่"),nt(w),function(e){n=t,e>0?(f++,l=0):e<0?(f=0,l++):(f=0,l=0);e>0&&0===n?(t=1,f=l=0):(2===f&&(t++,f=0),2===l&&(t--,l=0));t=Math.max(0,Math.min(2,t))}(a),e=t-1+10,t<=0&&(e=10),i=3,zi()}function Hi(){return it(),1010==p&&(4===y[7]||4===y[48])||!(D<6)&&(D>25||1111==p)}let Ti=0,Ui=180,ji=180,Fi=null;function Yi(t){const n=t%60;return Math.floor(t/60)+":"+(n<10?"0"+n:n)}function Xi(){Et.textContent=Yi(ji),Bt.textContent=Yi(Ui),ji<=0&&(Et.style.color="#fd0"),Ui<=0&&(Bt.style.color="#fd0")}function zi(){Ji(!1),Fi&&clearInterval(Fi),Fi=null,Xi()}function Ji(t){Bt.style.color=t?"#eee":"#888",Et.style.color=t?"#888":"#eee",_t.style.opacity=t?1:.4,Ct.style.opacity=t?.4:1}let $i=null,qi=0n;function Ki(t){return 6364136223846793005n*BigInt(t)+1n&(1n<<64n)-1n}const Zi=0,Gi=1,Oi=2;let Qi=0,Vi=0,ta=0,na=0;const ea=new Uint32Array(1<<22),ia=new Uint32Array(1<<22),aa=new Int16Array(1<<22),ra=new Int8Array(1<<22),oa=new Int32Array(1<<22),ca=new Int32Array(1<<22);function fa(t,n,e,i,a){if(0===n)return;ta++;const r=Number(0xffffffffn&t)>>>0,o=Number(t>>32n&0xffffffffn)>>>0,c=4194303&r;if(i=function(t,n){return t>9e3?t+n:t<-9e3?t-n:t}(i,_),0===ia[c]&&0===ea[c])return ea[c]=r,ia[c]=o,aa[c]=n>0?n:1,ra[c]=e,oa[c]=i,void(ca[c]=0|a);const f=ea[c],l=ia[c],s=aa[c],u=ra[c];if(l!==o||f!==r)return ea[c]=r,ia[c]=o,aa[c]=n,ra[c]=e,oa[c]=i,void(ca[c]=0|a);if(na++,l===o&&f===r){if(u===Zi&&e!==Zi)return;if(n<s&&e!==Zi)return;if(e===Zi&&u===Zi&&n<s)return;return aa[c]=n,ra[c]=e,oa[c]=i,void(ca[c]=0|a)}}function la(){ea.fill(0),ia.fill(0),aa.fill(0),ra.fill(0),oa.fill(0),ca.fill(0),Qi=Vi=ta=na=0}const sa=1,ua=2,wa=3;let ha=0;const da=new Map,pa=(1n<<63n)-1n,ga=new Uint32Array(1<<21),ya=new Uint32Array(1<<21),ma=new Uint8Array(1<<21);let va=0,Ma=0,ba=0;function xa(){const t=0===S,n=$i;let e=0n;for(let i=0;i<32;i++){const a=A[i],r=n[i];let o=y[a];o>=4||o<0||(t||4===o||(o^=1),e^=r[o])}return e&pa}function ka(t,n){const e=Number(0xffffffffn&t),i=Number(t>>32n);let a=2097151&e;const r=1|i;for(let t=0;t<1<<21;t++){if(0===ma[a])return ga[a]=e,ya[a]=i,ma[a]=n,t>ba&&(ba=t),!0;if(ga[a]===e&&ya[a]===i)return!1;a=a+r&2097151}return!1}function Aa(t){let n="",e=0;for(;e<t.length;){let i=t[e];if(i>="0"&&i<="9"){let i=e+1;i<t.length&&t[i]>="0"&&t[i]<="9"&&i++;const a=parseInt(t.slice(e,i),10);n+="y".repeat(a),e=i}else n+=i,e++}return n}function Ia(t){const n=[0,1,2,3,4];for(let t=0;t<32;t++)y[A[t]]=4;let e=0;for(let i=0;i<16;i++){const a=t.charCodeAt(i)-97;let r=Math.floor(a/5),o=a%5;y[A[e++]]=n[r],y[A[e++]]=n[o]}}const _a=new Map([[1001,2],[110,3],[101,1],[1010,1],[2010,2],[1020,3],[1110,2],[1011,3],[210,2],[1002,3],[2001,2],[120,3],[1101,2],[111,3],[201,2],[102,3],[2020,1],[2011,2],[2002,2],[220,3],[211,3],[202,1],[1120,3],[1111,1],[1102,2],[2110,2],[2101,2],[1021,3],[121,3],[1210,2],[1201,2],[1012,3],[112,3],[3010,2],[3001,2],[1030,3],[130,3],[310,2],[301,2],[1003,3],[103,3]]);function Ca(t){return _a.get(t)??0}function La(){let t=0,n=0,e=0,i=0;for(let a=0;a<32;a++){const r=y[A[a]];2===r?t++:0===r?n++:3===r?e++:1===r&&i++}return 1e3*t+100*n+10*e+i}const Ra=new Map;let Sa=0;function Ea(t){S=0,y.set(g);const n=(t=t.replace(/\b(\d+(?:x\d+)+)\b/g,t=>{const n=t.split("x");return n.map((t,e)=>e?`${n[e-1]}x${t}`:null).filter(Boolean).join(" . ")})).split(/\s+/);for(const t of n){Wa(Ha(),Ba(t)),Da(t)}}function Ba(t){const n=t.includes("x");let[e,i]=t.split(n?"x":"-").map(t=>+t);return 0!==S&&(e=33-e,i=33-i),A[e-1]|A[i-1]<<8}function Da(t){if("."===t)return void(S^=1);let[n,e]=t.split(t.includes("x")?"x":"-").map(t=>+t);t.includes("x")?function(t,n){const e=A[t-1],i=A[n-1];Pa(t,n);const a=e>i?li(e)>li(i)?i+9:i+7:li(e)>li(i)?i-7:i-9;4!==y[a]&&(y[a]=4)}(n,e):Pa(n,e),S^=1}function Pa(t,n){const e=A[t-1],i=A[n-1],a=y[e];4!==a&&(y[i]=a,y[e]=4,0===a&&i<8&&(y[i]=2),1===a&&i>=56&&(y[i]=3))}function Na(){const t=Ha(),n=Ra.get(t);if(!n)return null;let e=0;for(const t of n.values())e+=t;let i=Math.random()*e,a=null;for(const[t,e]of n)if((i-=e)<0){a=t;break}return a=ci(a)|oi(63-ri(a))|63-ai(a),a}function Wa(t,n){Ra.has(t)||Ra.set(t,new Map);const e=Ra.get(t),i=e.get(n)||0;i<5&&e.set(n,i+1),Sa++}function Ha(){const t=0===S,n=t?[4n,5n,6n,7n]:[5n,4n,7n,6n];let e=0n;if(t)for(let t=0;t<32;t++){const i=y[A[t]];e=e*(i>=4?2n:8n)|(i>=4?0n:n[i])}else for(let t=31;t>=0;t--){const i=y[A[t]];e=e*(i>=4?2n:8n)|(i>=4?0n:n[i])}return e}function Ta(){S=0===S?1:0,E=0===S?1:0}window.init=function(){!function(){j.fill(0),X.fill(0),F.fill(0),Y.fill(0),z.fill(0),J.fill(0),Z.fill(0),$.fill(0);for(let t=0;t<64;t++)K[t]=new Array(64).fill(0);for(let t=0;t<32;t++)I[A[t]]=t+1;ut=Ot("boardWrapper"),wt=Ot("extendWrapper"),ht=Ot("topBar"),dt=Ot("bottomBar"),pt=Ot("boardCanvas"),gt=pt.getContext("2d"),yt=Ot("pieceCanvas"),mt=yt.getContext("2d"),vt=Ot("animeCanvas"),Mt=vt.getContext("2d"),bt=Nt.createElement("canvas"),xt=bt.getContext("2d"),kt=Ot("message"),Pt=Ot("topCenter"),At=Ot("version"),St=Ot("newgame"),_t=Ot("styleSwitch"),Ct=Ot("styleComp"),Lt=Ot("soundSwitch"),Rt=Ot("cellNumSwitch"),It=Ot("footer"),Et=Ot("compTime"),Bt=Ot("playerTime"),Dt=Ot("overlayText"),En(!1),Dn(!1),Mt.imageSmoothingEnabled=!1,xt.imageSmoothingEnabled=!1,document.addEventListener("touchend",t=>{const n=Date.now();n-Gt<=300&&t.preventDefault(),Gt=n},{passive:!1}),document.addEventListener("touchstart",t=>{t.touches.length>1&&t.preventDefault()},{passive:!1}),document.addEventListener("gesturestart",t=>t.preventDefault()),function(){let t=124987n;$i=[];for(let n=0;n<32;n++){$i[n]=[];for(let e=0;e<10;e++)t=Ki(t),$i[n][e]=t}t=Ki(t),qi=t}()}(),function(){nt("Loading...");let t=0,n=0;for(let n=0;n<st;n++)t+=ft[n].length;for(let e=0;e<st;e++){Ht[e]=[];for(let i=0;i<ft[e].length;i++){const a=Ht[e][i]=new Image;a.onload=()=>{++n===t&&(wn=!0,hn())},a.src=ft[e][i]}}}(),async function(t="DB0509.zip",n="DB0509.txt"){try{Ra.clear(),Sa=0;const e=await fetch(t);if(!e.ok)throw new Error("HTTP "+e.status);const i=await e.blob(),a=(await JSZip.loadAsync(i)).file(n);if(!a)throw new Error(`File ${n} not found`);const r=(await a.async("text")).split("\n").map(t=>t.trim()).filter(t=>t.length>=21);for(const t of r){const n=t.substring(0,16),e=t.substring(16,21),i=BigInt("0x"+n),a=Number("0x"+e);Wa(i,a)}await async function(t="newBK.txt"){const n=await fetch(t),e=(await n.text()).split("\n").map(t=>t.trim()).filter(t=>t.length>0&&!/^\s*#/.test(t));for(const t of e)Ea(t)}(),V()}catch(t){}}(),async function(t="background2.jpg",n="description2.txt"){try{0;const e=await fetch(t);if(!e.ok)throw new Error("HTTP "+e.status);const i=await e.blob(),a=(await JSZip.loadAsync(i)).file(n);if(!a)throw new Error(`File ${n} not found`);const r=await a.async("text");ga.fill(0),ya.fill(0),ma.fill(0),S=0;let o=0,c=0;const f=r.split("\n").map(t=>t.trim()).filter(t=>t&&!t.startsWith("#"));for(const t of f){const n={".":sa,"+":ua,"-":wa}[t[t.length-1]]||0,e=Aa(t.substring(0,t.length-1));if(16!==e.length)continue;Ia(e);const i=xa(),a=La();da.has(a)||da.set(a,{win:0,draw:0,loss:0,total:0,def:Ca(a)});const r=da.get(a);n===sa?r.draw++:n===ua?r.win++:n===wa&&r.loss++,r.total++,ka(i,n)?o++:c++}for(const[t,n]of da.entries()){let t=!1;n.def===ua&&n.win>0&&(t=!0),n.def===sa&&n.draw>0&&(t=!0),n.def===wa&&n.loss>0&&(t=!0)}V(),S=0,ha=o}catch(t){}}(),G()}