const t=new Int32Array([1,3,5,7,8,10,12,14,17,19,21,23,24,26,28,30,33,35,37,39,40,42,44,46,49,51,53,55,56,58,60,62]),e=new Int32Array(64);for(let n=0;n<32;n++)e[t[n]]=n+1;let n=0,o=new Int32Array(64);const c=document.getElementById("board"),l=c.getContext("2d");c.style.width="480px",c.style.height="480px";const i=new Map;let s=0;!async function(t="DB0508.zip",e="DB0508.txt"){const n=await fetch(t),o=await JSZip.loadAsync(await n.blob()),c=(await o.file(e).async("text")).split("\n").map(t=>t.trim()).filter(t=>t.length>=21);for(const t of c){const e=BigInt("0x"+t.substring(0,16)),n=Number("0x"+t.substring(16,21));i.has(e)||i.set(e,[]),i.get(e).push(n),s++}console.log("Book loaded:",s)}();const r=t=>t>>8&255;function a(){for(let t=0;t<64;t++)o[t]=(t>>3)+(7&t)&1?4:5}function f(){if(!s)return;const e=document.getElementById("bkinfo"),c=(document.getElementById("betterBox"),BigInt(function(){const e=[4n,5n,6n,7n],c=[5n,4n,7n,6n];let l=0n;if(0===n)for(let n=0;n<32;n++){const c=o[t[n]];l=l*(c>=4?2n:8n)|(c>=4?0n:e[c])}else for(let e=31;e>=0;e--){const n=o[t[e]];l=l*(n>=4?2n:8n)|(n>=4?0n:c[n])}return l}())),l=c.toString(16);document.getElementById("boardKey").value=l;const a=i.get(c);if(a){const t=new Map;for(const e of a)t.set(e,(t.get(e)||0)+1);const n=[...t.entries()].sort((t,e)=>e[1]-t[1]);let o="";for(const[t,e]of n){const n=255&t,c=r(t),l=(100*e/a.length).toFixed(1);o+=`${d(n)}-${d(c)} (${l}%)\n`}e.innerText=o,submitBtn.style.display="inline",submitInfo.innerText=""}else e.innerText="ยังไม่มีใครสอน"}function d(t){const o=e[t];return 0===n?o:33-o}function u(){for(let t=0;t<8;t++)for(let n=0;n<8;n++){const c=8*t+n;if(l.fillStyle=5===o[c]?"#4f6b7a":"#2a3b47",l.fillRect(60*n,60*t,60,60),o[c]<=3){const e=60*n+30,i=60*t+30,s=1&o[c];l.fillStyle=s?"#0f1a22":"#b3c2cc",l.beginPath(),l.arc(e,i,21,0,2*Math.PI),l.fill(),o[c]>=2&&(l.strokeStyle=s?"#3a5566":"#7f98a8",l.lineWidth=2,l.beginPath(),l.arc(e,i,14,0,2*Math.PI),l.stroke())}5!==o[c]&&(l.fillStyle="#8fa3b0",l.font="10px monospace",l.textAlign="right",l.textBaseline="top",l.fillText(e[c],60*n+60-3,60*t+3))}!function(){let e="";for(let n=0;n<32;n++){const c=o[t[n]];e+=m[c<=4?c:4]}document.getElementById("boardCode").value=e,document.getElementById("bkinfo").textContent=""}(),f()}const m=["o","x","@","#","."];document.addEventListener("DOMContentLoaded",()=>{!function(t=!0){fetch("https://chnp.co.th/makhos/bettermove.php?code="+encodeURIComponent(boardCode.value)+"&side="+n+"&move="+encodeURIComponent(betterMove.value)).then(t=>t.text()).then(e=>{t&&alert("ส่งข้อมูลเรียบร้อยแล้ว ขอบคุณครับ"),submitInfo.innerText=e,betterMove.value=""})}(!1)});let g=0;document.querySelectorAll('input[name="piece"]').forEach(t=>{t.onchange=()=>{g=Number(t.value)}}),c.onclick=t=>{const e=t.offsetX/60|0,c=8*(t.offsetY/60|0)+e;if(5!==o[c]){if(o[c]<=3){const t=o[c];o[c]=4,function(t){const e=document.getElementsByName("piece");for(let n of e)if(Number(n.value)===t){n.checked=!0;break}g=t}(t)}else o[c]=g,n=1&g?0:1,document.getElementById("sideLight").checked=0===n,document.getElementById("sideDark").checked=1===n;u()}},a(),u()