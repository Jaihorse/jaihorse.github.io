const e=new Int32Array([1,3,5,7,8,10,12,14,17,19,21,23,24,26,28,30,33,35,37,39,40,42,44,46,49,51,53,55,56,58,60,62]),t=new Int32Array(64);for(let n=0;n<32;n++)t[e[n]]=n+1;let n=0,o=new Int32Array(64);const c=document.getElementById("board"),l=c.getContext("2d");c.style.width="480px",c.style.height="480px";const i=new Map;let s=0;!async function(e="DB0508.zip",t="DB0508.txt"){const n=await fetch(e),o=await JSZip.loadAsync(await n.blob()),c=(await o.file(t).async("text")).split("\n").map(e=>e.trim()).filter(e=>e.length>=21);for(const e of c){const t=BigInt("0x"+e.substring(0,16)),n=Number("0x"+e.substring(16,21));i.has(t)||i.set(t,[]),i.get(t).push(n),s++}console.log("Book loaded:",s)}();const r=e=>e>>8&255;function f(){for(let e=0;e<64;e++)o[e]=(e>>3)+(7&e)&1?4:5}function a(){if(!s)return;const t=document.getElementById("bkinfo"),c=(document.getElementById("betterBox"),BigInt(function(){const t=[4n,5n,6n,7n],c=[5n,4n,7n,6n];let l=0n;if(0===n)for(let n=0;n<32;n++){const c=o[e[n]];l=l*(c>=4?2n:8n)|(c>=4?0n:t[c])}else for(let t=31;t>=0;t--){const n=o[e[t]];l=l*(n>=4?2n:8n)|(n>=4?0n:c[n])}return l}())),l=c.toString(16);document.getElementById("boardKey").value=l;const f=i.get(c);if(f){const e=new Map;for(const t of f)e.set(t,(e.get(t)||0)+1);const n=[...e.entries()].sort((e,t)=>t[1]-e[1]);let o="";for(const[e,t]of n){const n=255&e,c=r(e),l=(100*t/f.length).toFixed(1);o+=`${d(n)}-${d(c)} (${l}%)\n`}t.innerText=o,submitBtn.style.display="inline",submitInfo.innerText=""}else t.innerText="ยังไม่มีใครสอน"}function d(e){const o=t[e];return 0===n?o:33-o}function u(){for(let e=0;e<8;e++)for(let n=0;n<8;n++){const c=8*e+n;if(l.fillStyle=5===o[c]?"#4f6b7a":"#2a3b47",l.fillRect(60*n,60*e,60,60),o[c]<=3){const t=60*n+30,i=60*e+30,s=1&o[c];l.fillStyle=s?"#0f1a22":"#b3c2cc",l.beginPath(),l.arc(t,i,21,0,2*Math.PI),l.fill(),o[c]>=2&&(l.strokeStyle=s?"#3a5566":"#7f98a8",l.lineWidth=2,l.beginPath(),l.arc(t,i,14,0,2*Math.PI),l.stroke())}5!==o[c]&&(l.fillStyle="#8fa3b0",l.font="10px monospace",l.textAlign="right",l.textBaseline="top",l.fillText(t[c],60*n+60-3,60*e+3))}!function(){let t="";for(let n=0;n<32;n++){const c=o[e[n]];t+=m[c<=4?c:4]}document.getElementById("boardCode").value=t,document.getElementById("bkinfo").textContent=""}(),a()}const m=["o","x","@","#","."];document.addEventListener("DOMContentLoaded",()=>{!function(e=!0){fetch("bettermove.php?code="+encodeURIComponent(boardCode.value)+"&side="+n+"&move="+encodeURIComponent(betterMove.value)).then(e=>e.text()).then(t=>{e&&alert("ส่งข้อมูลเรียบร้อยแล้ว ขอบคุณครับ"),submitInfo.innerText=t,betterMove.value=""})}(!1)});let g=0;document.querySelectorAll('input[name="piece"]').forEach(e=>{e.onchange=()=>{g=Number(e.value)}}),c.onclick=e=>{const t=e.offsetX/60|0,c=8*(e.offsetY/60|0)+t;if(5!==o[c]){if(o[c]<=3){const e=o[c];o[c]=4,function(e){const t=document.getElementsByName("piece");for(let n of t)if(Number(n.value)===e){n.checked=!0;break}g=e}(e)}else o[c]=g,n=1&g?0:1,document.getElementById("sideLight").checked=0===n,document.getElementById("sideDark").checked=1===n;u()}},f(),u()